;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1802e7e6-aafa-da6e-162b-9bfdef2661ec")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6778582,e=>{e.v({tableContainer:"index-module__BmqzpG__tableContainer"})},8944557,e=>{e.v({container:"index-module__Jk-AeG__container",titleContent:"index-module__Jk-AeG__titleContent"})},4674484,e=>{e.v({emptyAvatar:"protected-git-scopes-module__EVMbda__emptyAvatar",iconOverlay:"protected-git-scopes-module__EVMbda__iconOverlay",iconUnderlay:"protected-git-scopes-module__EVMbda__iconUnderlay",iconWrapper:"protected-git-scopes-module__EVMbda__iconWrapper"})},3338350,e=>{e.v({capitalize:"security-module__B-VM4q__capitalize",circleIcon:"security-module__B-VM4q__circleIcon",hbsbyw:"security-module__B-VM4q__hbsbyw",hwdneq:"security-module__B-VM4q__hwdneq",jfrghs:"security-module__B-VM4q__jfrghs",jfuqpw:"security-module__B-VM4q__jfuqpw",kolchb:"security-module__B-VM4q__kolchb",legdbp:"security-module__B-VM4q__legdbp",minWidth0:"security-module__B-VM4q__minWidth0",smmyof:"security-module__B-VM4q__smmyof"})},1539040,e=>{e.v({capitalize:"directory-sync-module___l4INa__capitalize",circleIcon:"directory-sync-module___l4INa__circleIcon",circleIconSmall:"directory-sync-module___l4INa__circleIconSmall"})},9379957,e=>{"use strict";var t=e.i(8711407),i=e.i(119294),s=e.i(6352514),l=e.i(9598279),n=e.i(7749291),r=e.i(8876434),a=e.i(1176592),o=e.i(7137884),c=e.i(8517043),d=e.i(1232681),u=e.i(2504781),h=e.i(1794286),x=e.i(2064047),m=e.i(8674454),g=e.i(6694387),f=e.i(4991687),p=e.i(8459493),j=e.i(5255926),y=e.i(1906681),b=e.i(455575),v=e.i(57106),S=e.i(4004502),A=e.i(8042625),T=e.i(277234),w=e.i(4244280),I=e.i(5338940),M=e.i(3322724),C=e.i(7812221),k=e.i(588428),N=e.i(1717203),E=e.i(7557283),_=e.i(9544652),P=e.i(9771394),F=e.i(2098824),L=e.i(8465394),R=e.i(185801),D=e.i(6949145),O=e.i(8206804),B=e.i(6214931),$=e.i(2602022),G=e.i(8248823),V=e.i(5063443),z=e.i(3895030),H=e.i(7917902),U=e.i(5819220),q=e.i(979715),W=e.i(1877305);let Y=function(){let{team:e,isLoading:i,mutate:s}=(0,H.useAccount)(),{can:l,isLoading:n}=(0,N.default)(),r=l(E.Action.Update,E.Resource.Team),[u,h]=(0,a.useState)(!!e?.hideIpAddresses),[x,m]=(0,a.useState)(!!e?.hideIpAddressesInLogDrains);(0,a.useEffect)(()=>{h(!!e?.hideIpAddresses),m(!!e?.hideIpAddressesInLogDrains)},[e]);let[g,f]=(0,a.useState)(null),[p,A]=(0,a.useState)(!1),I=(0,b.useToasts)(),M=(0,a.useCallback)(async t=>{if(h(t),!p&&e)try{f(null),A(!0);let i=await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}`,{method:"PATCH",body:{hideIpAddresses:t}});if(i.error)throw Error(i.error.message??"An unexpected error occurred. Please try again later.");s(),I.success({text:"Your team's IP address setting has been updated.",key:"ip-visibility-toggle-success"})}catch(e){f((0,G.errorToString)(e)),h(!t)}finally{A(!1)}},[e,s,p,I,h]),C=(0,a.useCallback)(async t=>{if(m(t),!p&&e)try{f(null),A(!0);let i=await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}`,{method:"PATCH",body:{hideIpAddressesInLogDrains:t}});if(i.error)throw Error(i.error.message??"An unexpected error occurred. Please try again later.");s(),I.success({text:"IP address visibility in your team's Log Drains has been updated.",key:"ip-visibility-log-drains-toggle-success"})}catch(e){f((0,G.errorToString)(e)),m(!t)}finally{A(!1)}},[e,p,I,s,m]),k=(0,_.useDisabled)()||n||!r||i;return(0,t.jsx)("form",{"data-testid":(0,S.tid)("security-page","hide-ip-addresses-form"),children:(0,t.jsxs)(c.Fieldset,{disabled:k,children:[(0,t.jsxs)(o.FieldsetContent,{children:[(0,t.jsxs)("div",{style:{marginBottom:24},children:[(0,t.jsx)(W.FieldsetTitle,{id:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.hideIpAddresses,children:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.hideIpAddresses}),(0,t.jsx)(z.FieldsetSubtitle,{children:"IP addresses may be considered personal information under certain data protection laws. Display or hide IP addresses in the Vercel Dashboard and Log Drains."})]}),(0,t.jsx)(U.Entity,{"data-testid":(0,S.tid)("security-page","ip-visibility-monitoring"),children:(0,t.jsx)(q.EntityField,{children:(0,t.jsx)("label",{htmlFor:"toggle-env-var-policy",style:{cursor:"pointer"},children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsxs)("span",{className:"text-heading-14 text-inherit",children:["IP addresses are currently"," ",u?"hidden":"visible"," in the Vercel Dashboard."]}),(0,t.jsx)("span",{className:"text-copy-14 text-inherit",children:u?(0,t.jsxs)(t.Fragment,{children:["Enabling this setting will show IP addresses in the Vercel Dashboard.",(0,t.jsx)("br",{}),"After enabling, IP addresses may appear in Firewall data, Observability and in Monitoring queries"]}):(0,t.jsxs)(t.Fragment,{children:["Disabling this setting will hide IP addresses the Vercel Dashboard.",(0,t.jsx)("br",{}),"After disabling, IP addresses will no longer appear in Firewall data, Observability and in Monitoring queries."]})})]}),(0,t.jsx)(y.Toggle,{checked:!u,"data-testid":(0,S.tid)("security-page","ip-visibility-monitoring-toggle"),disabled:!r,id:"toggle-env-var-policy",onChange:()=>{M(!u)},size:"large"})]})})})}),(0,t.jsx)(U.Entity,{children:(0,t.jsx)(q.EntityField,{children:(0,t.jsx)("label",{htmlFor:"toggle-env-var-policy",style:{cursor:"pointer"},children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsxs)("span",{className:"text-heading-14 text-inherit",children:["IP addresses are currently"," ",x?"hidden":"visible"," in your Log Drains."]}),(0,t.jsx)("span",{className:"text-copy-14 text-inherit",children:x?(0,t.jsx)(t.Fragment,{children:"Show IP addresses in Log Drains by enabling this setting."}):(0,t.jsx)(t.Fragment,{children:"Hide IP addresses from Log Drains by disabling this setting."})})]}),(0,t.jsx)(y.Toggle,{checked:!x,disabled:!r,onChange:()=>{C(!x)},size:"large"})]})})})})]}),(0,t.jsx)(d.FieldsetFooter,{disabled:!1,highlight:!r,children:(0,t.jsx)(d.FieldsetFooter.Status,{children:g&&g?(0,t.jsx)(V.ErrorText,{children:g}):r?(0,t.jsxs)("span",{children:["For more information, visit our"," ",(0,t.jsx)(v.Link,{external:!0,href:"https://vercel.com/legal/privacy-policy",variant:"highlight",children:"Privacy Notice"})]}):n?(0,t.jsx)(j.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):"You need additional permissions to manage your team's IP address visibility."})})]})})};var J=e.i(5807088),Z=e.i(3500331),K=e.i(3671642),X=e.i(6891161),Q=e.i(8522580),ee=e.i(9792418),et=e.i(6198010),ei=e.i(423255),es=e.i(1875382),el=e.i(8250954),en=e.i(3848869),er=e.i(6607601),ea=e.i(6870754),eo=e.i(1803156),ec=e.i(8139291),ed=e.i(7432042),eu=e.i(1452806),eh=e.i(6673134);let ex=()=>{let[e,t]=(0,a.useState)(!1);return[e,(0,a.useCallback)(()=>t(!0),[]),(0,a.useCallback)(()=>t(!1),[])]};var em=e.i(6778582);function eg(){return null}function ef(e){let{canWriteTable:i,disabled:s,triggerRefetch:l}=e,[n,r]=(0,a.useState)(void 0),{isLoading:o,data:c,mutate:d}=(0,eh.useIPBlocking)({limit:128,offset:n},{refreshInterval:s?0:(0,ed.default)("5m"),isPaused:()=>s});(0,a.useEffect)(()=>{l||d().catch(eg)},[l,d]);let u=(0,a.useMemo)(()=>{let e=(0,eo.default)(c?.result||[],"domain");return Object.keys(e).map(t=>{let i=e[t];return 1===i.length?{...i[0]}:{domain:`${t} (${i.length})`,subRows:i}})},[c?.result]),h=[{Header:"Host",accessor:"domain",ellipsis:!0,expandable:!0},{Header:"IP Address",accessor:"ip",fixedWidth:150,align:"right"},{Header:"Note",accessor:"note",align:"right"},{Header:"Created",accessor:"createdAt",align:"right",fixedWidth:140,Cell:e=>{var i,s;if(!("createdAt"in e.cell.row.original))return null;let l=(i=new Date(e.cell.row.original.createdAt),s={addSuffix:!0,roundingMethod:"floor"},(0,en.formatDistanceStrict)(i,(0,el.constructNow)(i),s));return(0,t.jsx)(t.Fragment,{children:l})}},{Header:"",accessor:"_",fixedWidth:32,disableSortBy:!0,Cell:e=>(0,t.jsx)(ep,{canWriteTable:i,cell:e.cell,refetch:()=>void d().catch(eg)})}];return(0,t.jsx)("div",{className:`flex flex-col items-stretch justify-start gap-3 flex-initial ${em.default.tableContainer}`,children:o&&void 0===n?(0,t.jsx)(j.Skeleton,{width:"100%"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eu.default,{caption:"Your IP Blocking rules.",columns:h,data:u,empty:"Your team has no IP Blocking rules.",fixed:!0,sortable:!0}),u.length>0&&c?.pagination.next?(0,t.jsx)(ea.LoadMoreButton,{loading:o,noGap:!0,onClick:()=>{r(c.pagination.next)}}):null]})})}function ep(e){let{cell:i,canWriteTable:s,refetch:l}=e,[n,r,a]=ex(),o=i.row.original,{trigger:c,isMutating:d}=(0,eh.useUnblockIPBlockRule)(o.id),u=(0,b.useToasts)();return"subRows"in o?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(f.MenuContainer,{children:[(0,t.jsx)(g.MenuButton,{"aria-label":"Menu",shape:"square",size:"small",type:"tertiary",children:(0,t.jsx)(ec.MoreVertical,{})}),(0,t.jsx)(m.Menu,{children:(0,t.jsx)(p.MenuItem,{disabled:!s,onClick:()=>{r()},type:"error",children:"Delete Rule"})})]}),(0,t.jsxs)(X.Modal.Modal,{active:n,onClickOutside:a,children:[(0,t.jsx)(X.Modal.Body,{children:(0,t.jsxs)(X.Modal.Header,{children:[(0,t.jsx)(X.Modal.Title,{children:"Delete Rule"}),(0,t.jsxs)(X.Modal.Subtitle,{children:["You are about to unblock requests from"," ",(0,t.jsx)(er.InlineCode,{children:o.ip})," from making requests to"," ",(0,t.jsx)(er.InlineCode,{children:o.domain}),"."]})]})}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:a,type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{loading:d,onClick:async()=>{try{await c(o.id),a(),u.success(`Successfully deleted IP Block rule from ${o.ip} for ${o.domain}.`),l()}catch{}},children:"Delete Rule"})]})]})]})}var ej=e.i(8944557);function ey(){let e=(0,es.useRouter)(),{value:i}=(0,k.useIPBlockingTeamFlag)(),{can:s,isLoading:l}=(0,N.default)(),[n,r,h]=ex(),{team:x}=(0,H.useAccount)(),m=(0,a.useCallback)(()=>{h()},[h]),[g,f]=(0,a.useState)(""),[p,y]=(0,a.useState)(""),b=ei.default.isIP(g),S=b&&""!==p,[A,T]=(0,a.useState)(!1),[w,I]=(0,a.useState)(void 0),M=s(E.Action.Read,E.Resource.IpBlocking),P=s(E.Action.Read,E.Resource.IpBlocking),F=M||P,R=s(E.Action.All,E.Resource.IpBlocking),{isMutating:D,trigger:O,data:B}=(0,eh.useAddIPBlockRule)({newRule:{ip:g,domain:p}}),$=async()=>{await O({domain:p,ip:g})},G=(0,a.useCallback)(()=>{e.push(`/dashboard/${x?.slug||""}/monitoring?title=Blocked Requests from ${g} on ${p}&visualize=sum%28blocked_requests%29&where=host+%3D+%27${p}%27+and+public_ip+%3D+%27${g}%27&groupBy=host%2Cpublic_ip`)},[p,g,e,x?.slug]);if((0,a.useEffect)(()=>{eb(B)?I(B):void 0!==B&&I(!1)},[B]),!0!==i)return null;let V=x?.billing?.plan==="enterprise",U=l||!F||!V;return(0,t.jsxs)(_.DisabledContext.Provider,{value:U,children:[(0,t.jsx)(L.default,{className:ej.default.container,id:"ip-blocking",children:(0,t.jsxs)(c.Fieldset,{disabled:!V||!M||!R||!F,children:[(0,t.jsxs)(o.FieldsetContent,{children:[(0,t.jsx)(ee.FieldsetTitle,{id:"ip-blocking-title",children:(0,t.jsxs)("div",{className:`flex flex-row items-stretch justify-between flex-initial ${ej.default.titleContent}`,children:[(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:(0,t.jsx)("span",{children:"IP Blocking"})}),(0,t.jsx)("div",{children:(0,t.jsx)(u.Button,{disabled:!R,onClick:r,size:"small",suffix:(0,t.jsx)(et.Plus,{}),type:"secondary",children:"Create New Rule"})})]})}),(0,t.jsx)(z.FieldsetSubtitle,{children:"Configure the IP addresses that Vercel should block requests from. Blocked requests will not contribute to your bill."}),(0,t.jsx)(ef,{canWriteTable:R,disabled:U,triggerRefetch:n})]}),(0,t.jsx)(d.FieldsetFooter,{disabled:!1,highlight:!V||!M||!R||!F,children:l?(0,t.jsx)(j.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):V?F&&R?(0,t.jsxs)("span",{children:["Learn more about ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/security/vercel-waf/ip-blocking",variant:"highlight",children:"IP Blocking"})]}):(0,t.jsx)("span",{children:"You need additional permissions to manage your team's IP Blocking."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["IP Blocking is available on the"," ",(0,t.jsx)(v.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:(0,t.jsx)(v.ButtonLink,{href:C.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]})})]})}),(0,t.jsx)(X.Modal,{active:n,disableFocusTrap:!0,onAnimationDone:()=>{y(""),f(""),T(!1),I(void 0)},onClickOutside:m,children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),$()},children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsxs)(X.Modal.Header,{children:[(0,t.jsx)(X.Modal.Title,{children:"Create New IP Block Rule"}),(0,t.jsx)(X.Modal.Subtitle,{children:"An IP Block Rule will block all requests from an IP Address for a host."})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)(K.Label,{id:"ip-address",value:"IP Address",children:(0,t.jsx)(Z.Input,{autoFocus:!0,disabled:!1===w,error:!b&&A?"Please enter a valid IPv4 address.":void 0,id:"ip-address",onBlur:()=>T(g.length>0),onChange:e=>{f(e.target.value)},pattern:"[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}",placeholder:"127.0.0.1",required:!0,value:g,width:"100%"})}),(0,t.jsx)(K.Label,{id:"host",value:"Host",children:(0,t.jsx)(Z.Input,{disabled:!1===w,id:"host",onBlur:()=>T(p.length>0),onChange:e=>{y(e.target.value)},placeholder:"example.com",required:!0,value:p,width:"100%"})})]}),eb(w)?(0,t.jsx)(Q.Note,{type:"error",children:w.error.message}):null,!1===w?(0,t.jsx)(Q.Note,{label:!1,type:"success",children:"Rule created."}):null]})]}),(0,t.jsxs)(X.Modal.Actions,{children:[!1!==w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Modal.Action,{onClick:m,type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{buttonType:"submit",disabled:!S,loading:D,children:"Create IP Block Rule"})]}),!1===w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Modal.Action,{buttonType:"button",onClick:m,type:"secondary",children:"Close"}),(0,t.jsx)(X.Modal.Action,{buttonType:"button",onClick:G,children:"View in Monitoring"})]})]})]})})]})}let eb=e=>void 0!==e&&!1!==e&&"error"in e;var ev=e.i(6239252),eS=e.i(9334091);let eA={hostname:"",rule:"",note:""};function eT(e){let{rule:i,hostname:s}=e,{team:l}=(0,H.useAccount)(),n=`/dashboard/${l?.slug||""}/monitoring?title=Blocked Requests from ${i} on ${s}&visualize=sum%28blocked_requests%29&where=host+%3D+%27${s}%27+and+public_ip+%3D+%27${i}%27&groupBy=host%2Cpublic_ip`;return(0,t.jsx)(v.ButtonLink,{href:n,children:"View Rule in Monitoring"})}function ew(e){var i;let{active:s,close:l}=e,[n,r]=(0,a.useState)({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:null}),[o,c]=(0,a.useState)({...eA}),{isMutating:d,trigger:u,error:h}=(0,eh.useAddIPBlockRuleV2)(),x=()=>{l(),r({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:null}),c({...eA})},{isValid:m,errorMsg:g}=function(e){if(ei.default.isIP(e))return{isValid:!0,errorMsg:""};if(ei.default.isIPRange(e)){let[t,i]=e.split("/"),s=Number.parseInt(i,10);return t.includes(".")?s<16?{isValid:!1,errorMsg:"IPv4 CIDR cannot have a net mask less than /16"}:{isValid:!0,errorMsg:""}:s<48?{isValid:!1,errorMsg:"IPv6 CIDR cannot have a net mask less than /48"}:{isValid:!0,errorMsg:""}}return{isValid:!1,errorMsg:"Please enter a valid IP address or CIDR."}}(o.rule),f=(i=o.hostname,RegExp("^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(?:\\.(?!-)[A-Za-z0-9-]{1,63}(?<!-))*$").test(i)),p=o.note.length<=500,{showErrors:j,succeeded:y}=n;return(0,t.jsx)(X.Modal,{active:s,disableFocusTrap:!0,onAnimationDone:()=>{c({...eA})},onClickOutside:x,children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),u(o).then(()=>{r({showErrors:{ip:!1,hostname:!1,notes:!1},succeeded:!0})}).catch(()=>{r({showErrors:{ip:!0,hostname:!0,notes:!0},succeeded:!1})})},children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsxs)(X.Modal.Header,{children:[(0,t.jsx)(X.Modal.Title,{children:"Configure New Domain Protection"}),(0,t.jsx)(X.Modal.Subtitle,{children:"Configure the Advanced Firewall for a domain associated with your team's projects."})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)(K.Label,{id:"ip-address",value:"IP Address or CIDR",children:(0,t.jsx)(Z.Input,{autoFocus:!0,disabled:!0===y,error:!m&&j.ip?g:void 0,id:"ip-address",onBlur:()=>r({...n,showErrors:{...n.showErrors,ip:o.rule.length>0}}),onChange:e=>{c({...o,rule:e.target.value})},placeholder:"127.0.0.1/24",required:!0,value:o.rule,width:"100%"})}),(0,t.jsx)(K.Label,{id:"host",value:"Host",children:(0,t.jsx)(Z.Input,{disabled:!0===y,error:!f&&j.hostname?`Hostname is invalid ${o.hostname.startsWith("*")?"(wildcard not supported.)":""}`:void 0,id:"host",onBlur:()=>r({...n,showErrors:{...n.showErrors,hostname:o.hostname.length>0}}),onChange:e=>{c({...o,hostname:e.target.value})},placeholder:"example.com",required:!0,value:o.hostname,width:"100%"})}),(0,t.jsx)(K.Label,{id:"note",value:"Note",children:(0,t.jsx)(eS.Textarea,{error:!p&&j.notes?"Note cannot be longer than 500 characters":void 0,id:"note",onBlur:()=>r({...n,showErrors:{...n.showErrors,notes:o.note.length>0}}),onChange:e=>{c({...o,note:e.target.value})},placeholder:"Add an optional reason for the block rule",rows:3,value:o.note})})]}),h?(0,t.jsx)(Q.Note,{type:"error",children:h.message}):null,y?(0,t.jsx)(Q.Note,{label:!1,type:"success",children:"Rule created."}):null]})]}),(0,t.jsx)(X.Modal.Actions,{children:y?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Modal.Action,{buttonType:"button",onClick:x,type:"secondary",children:"Close"}),(0,t.jsx)(eT,{hostname:o.hostname,rule:o.rule})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Modal.Action,{disabled:d,onClick:x,type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{buttonType:"submit",disabled:!(m&&f),loading:d,children:"Create IP Block Rule"})]})})]})})}function eI(){let{value:e}=(0,k.useIPBlockingTeamFlag)(),{can:i,isLoading:s}=(0,N.default)(),[l,n,r]=ex(),{team:a}=(0,H.useAccount)(),h=i(E.Action.Read,E.Resource.IpBlocking),x=i(E.Action.Read,E.Resource.IpBlocking),m=h||x,g=i(E.Action.All,E.Resource.IpBlocking);if(!0!==e)return null;let f=a?.billing?.plan==="enterprise",p=s||!m||!f;return(0,t.jsxs)(_.DisabledContext.Provider,{value:p,children:[(0,t.jsx)(L.default,{className:ej.default.container,id:"ip-blocking",children:(0,t.jsxs)(c.Fieldset,{disabled:!f||!h||!g||!m,children:[(0,t.jsxs)(o.FieldsetContent,{children:[(0,t.jsx)(ee.FieldsetTitle,{id:"ip-blocking-title",children:(0,t.jsxs)("div",{className:`flex flex-row items-stretch justify-between flex-initial ${ej.default.titleContent}`,children:[(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:(0,t.jsx)("span",{children:(0,t.jsx)(ev.SearchContextHighlighter,{children:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.ipBlocking})})}),(0,t.jsx)("div",{children:(0,t.jsx)(u.Button,{disabled:!g,onClick:n,size:"small",suffix:(0,t.jsx)(et.Plus,{}),type:"secondary",children:"Create New Rule"})})]})}),(0,t.jsx)(z.FieldsetSubtitle,{children:"Configure the IP addresses and CIDRs that Vercel should block requests from. Blocked requests will not contribute to your bill."}),(0,t.jsx)(ef,{canWriteTable:g,disabled:p,triggerRefetch:l})]}),(0,t.jsx)(d.FieldsetFooter,{disabled:!1,highlight:!f||!h||!g||!m,children:s?(0,t.jsx)(j.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}):f?m&&g?(0,t.jsxs)("span",{children:["Learn more about ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/security/vercel-waf/ip-blocking",variant:"highlight",children:"IP Blocking"})]}):(0,t.jsx)("span",{children:"You need additional permissions to manage your team's IP Blocking."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["IP Blocking is available on the"," ",(0,t.jsx)(v.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:(0,t.jsx)(v.ButtonLink,{href:C.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]})})]})}),(0,t.jsx)(ew,{active:l,close:r})]})}function eM(){let{value:e}=(0,k.useCIDRBlockingTeamFlag)();return e?(0,t.jsx)(eI,{}):(0,t.jsx)(ey,{})}var eC=e.i(76079),ek=e.i(3025777),eN=e.i(5468328),eE=e.i(5787344),e_=e.i(5018193),eP=e.i(7722264),eF=e.i(2661670),eL=e.i(7188420),eR=e.i(4674484),eD=e.i(7591419),eO=e.i(9550268),eB=e.i(6881349),e$=e.i(2160483),eG=e.i(8210056),eV=e.i(5614970);function ez(e){let{gitProvider:i,skeleton:s=!1,onGitScopeChange:l,onSwitchGitProvider:n,onAddGitAccountSuccess:r,disabledScopes:o,...c}=e,{data:d,mutate:u}=(0,e$.default)({provider:i}),h=(0,a.useCallback)(e=>{(async()=>{let t=await u(),i=t?.find(t=>t.installationId===e.installationId);r?.(i)})()},[u,r]),{open:x}=(0,eG.default)({onSuccess:h});return(0,t.jsx)(j.Skeleton,{show:s,children:(0,t.jsxs)(eB.Combobox,{className:"select-git-scope",clearable:!1,onChange:function(e){switch(e){case"switch-git-provider":n?.();break;case"add-github-account":x();break;default:{let t=d?.find(t=>t.slug===e);if(!t)break;l?.(t)}}},placeholder:"Select Git Scope",...c,children:[(0,t.jsx)(eB.Combobox.Input,{}),(0,t.jsx)(eB.Combobox.List,{children:(0,t.jsxs)(t.Fragment,{children:[d?.map(e=>(0,t.jsx)(eB.Combobox.Option,{disabled:o?.some(t=>{let{scope:i}=t;return i===e.name}),isMenu:!1,prefix:(0,t.jsx)(eV.default,{gitType:e.provider}),suffix:(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:o?.find(t=>{let{scope:i}=t;return i===e.name})?.reason}),value:String(e.slug),children:e.name},e.slug)),"github"===i?(0,t.jsx)(eB.Combobox.Option,{isMenu:!0,prefix:(0,t.jsx)(et.Plus,{}),value:"add-github-account",children:"Add GitHub Account"}):null,n?(0,t.jsx)(eB.Combobox.Option,{"data-testid":(0,S.tid)("git-scope-combobox","switch-git-provider"),isMenu:!0,prefix:(0,t.jsx)(eO.ListUnordered,{}),value:"switch-git-provider",children:"Switch Git Provider"}):null]})})]})})}function eH(e){let{isOpen:i,setIsOpen:s,onAdd:l,selectedScopes:n}=e,[r,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null),[{localGitAccount:x},m]=(0,a.useReducer)(eD.reducer,{search:null,debouncedSearch:null,ts:Date.now()}),g=async()=>{if(u&&x?.provider){o(null),d(!0);try{await l({gitProvider:x.provider,gitNamespaceId:eU(u),gitNamespaceOwnerType:u.ownerType}),d(!1),h(null),m({type:"SET_GIT_ACCOUNT",gitAccount:null}),b.toasts.success("Protected Git scope added.")}catch(e){d(!1),(0,eP.isError)(e)?o(e):o({message:"Unable to add protected Git scope."});return}s(!1)}},f=(0,a.useCallback)(()=>{s(!1),setTimeout(()=>{h(null),m({type:"SET_GIT_ACCOUNT",gitAccount:null}),o(null)},500)},[s,o]),p=(0,a.useCallback)(()=>{h(null),m({type:"SET_GIT_ACCOUNT",gitAccount:null}),o(null)},[m]),j=(0,a.useMemo)(()=>x?(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)(ez,{disabledScopes:n?.map(e=>({scope:e,reason:"Added"})),gitProvider:x.provider,onGitScopeChange:h}),r?(0,t.jsx)(Q.Note,{type:"error",children:r.message}):null]}):(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:["github","gitlab","bitbucket"].map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(eD.ConnectGitButton,{"data-testid":(0,S.tid)("select-git-repository","choose-provider",e),dispatch:m,gitType:e})},e))}),[x,r,n]),y=(0,a.useCallback)(()=>x?(0,t.jsx)(X.Modal.Action,{onClick:p,type:"secondary",children:"Back"}):(0,t.jsx)(X.Modal.Action,{onClick:f,type:"secondary",children:"Cancel"}),[x,p,f]),v=(0,a.useMemo)(()=>x?`Select a ${x.provider} scope to protect:`:"To protect your git repositories, select a Git provider and then choose the scope to protect.",[x]);return(0,t.jsxs)(X.Modal,{active:i,onClickOutside:f,children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsxs)(X.Modal.Header,{children:[(0,t.jsx)(X.Modal.Title,{children:"Add Protected Git Scope"}),(0,t.jsx)(X.Modal.Subtitle,{children:v})]}),j]}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(y,{}),(0,t.jsx)(X.Modal.Action,{disabled:!u,loading:c,onClick:g,children:"Save"})]})]})}let eU=e=>"bitbucket"===e.provider?e.id.toString():e.slug;var eq=e.i(9722978);function eW(){let{team:e}=(0,H.useAccount)(),{can:i,isLoading:s}=(0,N.default)(),l=i(E.Action.Update,E.Resource.TeamGitExclusivity),n=i(E.Action.List,E.Resource.TeamGitExclusivity),[r,h]=(0,a.useState)(!1),x=e?.billing?.plan==="enterprise",{data:{gitExclusivity:m}={},isLoading:g,mutate:f}=(0,eF.useListGitExclusivity)({teamId:x&&n?e.id:void 0}),p=!e||g,j=(0,_.useDisabled)()||s||!l||!x,y=async t=>{e&&(await (0,eF.postGitExclusivity)({teamId:e.id,...t}),await f())},b=async e=>{await (0,eF.removeGitExclusivity)(e),await f()},S=(0,a.useMemo)(()=>l?m&&m.length>=5?"You have reached the maximum number of protected Git scopes.":void 0:"You do not have permission to add protected Git scopes.",[l,m]),A=(0,a.useMemo)(()=>s?null:x?l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.FieldsetFooter.Status,{children:(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/security/protected-git-scopes",variant:"highlight",children:"Protected Git Scopes"})]})}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:p?null:(0,t.jsx)(eN.Tooltip,{text:S,children:(0,t.jsx)(u.Button,{disabled:!!(j||S),onClick:()=>h(!0),size:"small",children:"Add"})})})]}):(0,t.jsx)(d.FieldsetFooter.Status,{children:"You need additional permissions to manage your team's protected git scopes."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.FieldsetFooter.Status,{children:(0,t.jsxs)("span",{children:["Protected Git Scopes are available on the"," ",(0,t.jsx)(v.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]})}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:(0,t.jsx)(v.ButtonLink,{href:C.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]}),[l,s,x,j,S,p]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(c.Fieldset,{disabled:j,children:[(0,t.jsxs)(o.FieldsetContent,{children:[(0,t.jsx)(W.FieldsetTitle,{id:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.gitExclusivity,children:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.gitExclusivity}),(0,t.jsxs)(z.FieldsetSubtitle,{children:["Add up to 5"," ",(0,t.jsx)(eN.Tooltip,{text:"GitHub organization or account. GitLab group or account. Bitbucket workspace.",children:(0,t.jsx)("u",{style:{cursor:"help",textDecorationStyle:"dotted",textUnderlineOffset:2},children:"Git scopes"})})," ","to this team to limit other Vercel teams from deploying repositories from the protected scope. Multiple teams can specify the same scope, allowing both teams access."]}),(0,t.jsx)(eL.EntityCollapsible,{disabled:!l,emptyDescription:"Add a protected Git scope to limit other Vercel teams from deploying repositories from the protected scope.",entities:m?.map(e=>({key:`${e.gitProvider}-${e.gitNamespaceOwnerType}-${e.gitNamespaceId}`,component:(0,t.jsx)(eY,{entity:e,onRemove:b})})),isLoading:p,title:"Protected Scopes"})]}),(0,t.jsx)(d.FieldsetFooter,{disabled:!1,children:A})]}),(0,t.jsx)(eH,{isOpen:r,onAdd:y,selectedScopes:m?.map(e=>e.gitNamespaceId),setIsOpen:h})]})}function eY(e){let{entity:i,onRemove:s}=e,[l,n]=(0,a.useState)(!1),r=async()=>{n(!0);try{await s(i),b.toasts.success("Protected Git scope removed.")}catch(e){(0,eP.isError)(e)&&b.toasts.error(e.message),b.toasts.error("An error occurred while removing the protected Git scope.")}n(!1)};return(0,t.jsx)(x.Entity,{left:(0,t.jsx)(eJ,{entity:i}),right:(0,t.jsx)(u.Button,{loading:l,onClick:()=>void r(),size:"small",type:"secondary",children:"Remove"}),children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between flex-initial w-full",children:[(0,t.jsx)("div",{className:(0,eq.default)("flex flex-col items-stretch justify-center flex-initial",eR.default.entityContent),style:{flex:1},children:(0,t.jsxs)(v.Link,{href:function(e){switch(e.gitProvider){case"github":case"github-limited":return`https://github.com/${e.gitNamespaceId}`;case"github-custom-host":return`https://${e.gitProviderCustomHost}/${e.gitNamespaceId}`;case"gitlab":return`https://gitlab.com/${e.gitNamespaceId}`;case"bitbucket":return`https://bitbucket.org/${e.gitNamespaceId}`}}(i),children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:i.name}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 geist-hide-on-mobile",children:function(e){switch(e.gitProvider){case"github":case"github-limited":return`github.com/${e.slug||e.gitNamespaceId}`;case"github-custom-host":return`${e.gitProviderCustomHost}/${e.slug||e.gitNamespaceId}`;case"gitlab":return`gitlab.com/${e.slug||e.gitNamespaceId}`;case"bitbucket":return`bitbucket.org/${e.slug||e.gitNamespaceId}`}}(i)})]})}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 text-right geist-hide-on-mobile",style:{flex:1},children:i.description})]})})}function eJ(e){let{entity:i}=e,[s,l]=(0,a.useState)(!1);switch(i.gitProvider){case"github":case"github-limited":case"github-custom-host":return(0,t.jsx)(ek.GitHubAvatar,{right:0,size:32,username:i.gitNamespaceId});case"gitlab":return i.avatarUrl&&!s?(0,t.jsx)(eC.AvatarWithIcon,{gitType:"gitlab",icon:(0,t.jsxs)("div",{className:eR.default.iconWrapper,children:[(0,t.jsx)(e_.LogoGitlab,{className:eR.default.iconUnderlay}),(0,t.jsx)(e_.LogoGitlab,{className:eR.default.iconOverlay})]}),onError:()=>{l(!0)},right:0,size:32,url:i.avatarUrl}):(0,t.jsx)("div",{className:eR.default.emptyAvatar,children:(0,t.jsx)(e_.LogoGitlab,{size:20})});case"bitbucket":return i.avatarUrl&&!s?(0,t.jsx)(eC.AvatarWithIcon,{gitType:"bitbucket",icon:(0,t.jsxs)("div",{className:eR.default.iconWrapper,children:[(0,t.jsx)(eE.LogoBitbucketColor,{className:eR.default.iconUnderlay}),(0,t.jsx)(eE.LogoBitbucketColor,{className:eR.default.iconOverlay})]}),onError:()=>{l(!0)},right:0,size:32,url:i.avatarUrl}):(0,t.jsx)("div",{className:eR.default.emptyAvatar,children:(0,t.jsx)(eE.LogoBitbucketColor,{size:20})})}}var eZ=e.i(8045441),eK=e.i(5140444);function eX(){let e=(0,b.useToasts)(),{user:i}=(0,eK.useUser)(),{team:s,mutate:l}=(0,I.useTeam)(),[n,r]=(0,a.useTransition)(),{can:h}=(0,N.default)(),x=h(E.Action.Update,E.Resource.Team),[m,g]=(0,a.useState)(s?.mfa?.enforced??null),{value:f}=(0,k.useMfaEnforcementTeamFlag)();if(!f)return null;s&&null===m&&g(s.mfa?.enforced??!1);let p=!x||!s||!i?.mfa?.enabled||n;return(0,t.jsx)(L.default,{id:"two-factor-enforcement",children:(0,t.jsxs)(c.Fieldset,{disabled:!x,children:[(0,t.jsxs)(o.FieldsetContent,{className:"flex flex-col",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(ee.FieldsetTitle,{children:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.mfaEnforcement}),(0,t.jsxs)(z.FieldsetSubtitle,{children:["Require two-factor authentication (2FA) for members of your team. Team members who do not have 2FA will not be able access your team, but will remain a member. Visit the"," ",(0,t.jsx)(v.Link,{href:`/${s?.slug}/~/settings/members`,type:"highlight",children:"team members page"})," ","to view the 2FA status of each member."]})]}),(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)(eN.Tooltip,{disableTriggers:i?.mfa?.enabled,text:(0,t.jsxs)(t.Fragment,{children:["You must have two-factor authentication enabled to enforce it on the team. Go to"," ",(0,t.jsx)(v.Link,{href:"/account/settings/authentication#two-factor-authentication",type:"highlight",children:"account settings"})," ","to enabled 2FA."]}),children:(0,t.jsx)(y.Toggle,{"aria-label":"Two-factor enforcement","aria-checked":m??!1,checked:m??!1,direction:"switch-first",disabled:p,onChange:()=>g(e=>!e),size:"large",children:(0,t.jsx)("span",{className:`text-copy-14 ${p?"text-gray-700":""}`,children:m?"Enabled":"Disabled"})})})}),(0,t.jsx)("div",{className:"pt-4",children:(0,t.jsx)(Q.Note,{children:"To prevent workflow disruptions, configure two-factor authentication on all user-managed accounts prior to enforcement. Any CI/CD pipeline tokens associated with users who do not have two-factor authentication enabled will cease to work."})})]}),(0,t.jsx)(d.FieldsetFooter,{highlight:!x,children:x?(0,t.jsxs)(t.Fragment,{children:[" ",(0,t.jsxs)(d.FieldsetFooter.Status,{children:["Learn more about "," ",(0,t.jsxs)(v.Link,{external:!0,href:"/docs/two-factor-enforcement",type:"highlight",children:["Two-Factor"," ",(0,t.jsx)("span",{className:"hidden md:inline",children:"Authentication"})," ","enforcement"]})]}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:(0,t.jsx)(u.Button,{disabled:!s||m===s.mfa?.enforced,loading:n,onClick:()=>{r(async()=>{if(s)try{await (0,T.fetchAPI)(`${w.API_TEAMS}/${s.id}`,{method:"PATCH",body:JSON.stringify({mfaEnforced:!s.mfa?.enforced}),throwOnHTTPError:!0});let t=await l(),i=t?.teams?.find(e=>e.id===s.id);e.success(`Two-factor enforcement successfully ${i?.mfa?.enforced?"enabled":"disabled"}.`)}catch(t){e.error((0,G.normalizeError)(t).message)}})},size:"small",children:"Save"})})]}):(0,t.jsx)(d.FieldsetFooter.Status,{children:"You need additional permissions to manage two-factor enforcement."})})]})})}var eQ=e.i(7750276),e0=e.i(8761240),e1=e.i(5756088),e2=e.i(6318858),e4=e.i(6493690),e3=e.i(4585051),e5=e.i(4030453),e8=e.i(5326905),e9=e.i(940143),e7=e.i(6228447),e6=e.i(1235157),te=e.i(4575926);function tt(){return(0,te.useAuthenticatedSWR)(`${w.API_USER_TOKENS_GET}/current`,e=>(0,T.fetchAPI)(e,{throwOnHTTPError:!0}))}var ti=e.i(4418317),ts=e.i(8451453),tl=e.i(8128235),tn=e.i(9480212),tr=e.i(3338350),ta=e.i(4899593),to=e.i(4597921),tc=e.i(7519944);function td(){let{team:e,mutate:i}=(0,I.useTeam)(),{can:s}=(0,N.default)(),l=s(E.Action.Update,E.Resource.SamlConfig),{value:n}=(0,k.useRbacSetDefaultRoles)(),o=(0,to.useServerFlag)("enable-default-sso-redirect-uri",!1),c=(0,b.useToasts)(),[d,h]=(0,tn.default)(!!e?.saml?.enforced),[j,S]=(0,a.useState)(!1),[C,_]=(0,a.useState)(null),{data:P}=tt(),[F,L]=(0,a.useState)(!1),[R,D]=(0,a.useState)(!1),O=(0,M.useIsMobile)(),B=e&&(0,e7.isSAMLConfigured)(e),$=async s=>{if(e&&P){if(s&&!(0,e7.tokenHasSamlScope)(P.token,e))return _({message:(0,t.jsxs)(t.Fragment,{children:["To ensure your configuration is working correctly, please authenticate with SAML before Enforcing SAML for this Team.",(0,t.jsx)(v.Link,{onClick:()=>(0,e7.loginWithSAMLInline)(e.slug,{next:`${window.location.origin}${window.location.pathname}#saml-options`}),variant:"blend",children:"Click here to re-authenticate with SAML SSO"}),"."]})});_(null);try{await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}`,{method:"PATCH",body:JSON.stringify({saml:{enforced:s}}),throwOnHTTPError:!0}),await i(),c.success("Updated SAML for your Team successfully.")}catch(e){_((0,G.normalizeError)(e))}}},V=(0,a.useRef)(null),z=async()=>{if(e){if(V.current)return void V.current.open();try{let t=location.origin+`/popups/saml-sso${(0,A.encode)({teamSlug:e.slug})}`,s=`${w.API_TEAMS}/${e.id}/sso/configure${(0,A.encode)({redirect:1,intent:"sso",next:t})}`,l=e.slug;V.current=new ti.default({id:`saml-configure-popup:${Math.random().toString(36).slice(2)}`,width:1200,height:840,url:s,callbacks:{onPoll:async e=>{if(e.location.href===t){V.current?.cancelPolling(),V.current?.close();let e=await i();if(e?.teams){let t=e.teams.find(e=>e.slug===l);(0,e7.isSAMLConfigured)(t)?(_(null),B||c.success("SAML Single Sign-On configured successfully.")):_({message:"The SAML configuration was not completed. Please try again."})}else _({message:"Failed to fetch updated Team information."});V.current=null}},onClose:()=>{V.current=null},onAbort:()=>{V.current=null},onBlocked:()=>{_({message:"The popup to configure SAML Single Sign-On could not be opened."}),V.current=null}}}),V.current.open()}catch(e){_((0,G.normalizeError)(e))}}},H=async()=>{if(e){S("removeSAML");try{await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}/sso`,{method:"DELETE",throwOnHTTPError:!0}),await i(),_(null),c.success("Removed SAML configuration successfully.")}catch(e){_((0,G.normalizeError)(e))}S(!1),D(!1)}},U=async t=>{if(e)try{await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}`,{method:"PATCH",body:JSON.stringify({saml:{defaultRedirectUri:t}}),throwOnHTTPError:!0}),c.success("Updated default authentication redirect URL successfully."),await i()}catch{_({message:"Failed to update default authentication redirect URL."})}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Entity.List,{children:[(0,t.jsxs)(x.Entity,{left:e?.saml?.connection?.type?(0,t.jsx)(e3.Avatar,{size:32,src:(0,e7.getSAMLConnectionLogo)(e.saml.connection.type)}):(0,t.jsx)("div",{className:tr.default.circleIcon,children:(0,t.jsx)(e1.LockClosed,{})}),children:[(0,t.jsx)(x.Entity.Content,{description:B?"Manage the configuration with your Identity Provider.":"Allow Team Members to login using an Identity Provider.",fill:!0,title:e?.saml?.connection?.type?(0,e7.getSAMLConnectionType)(e.saml.connection.type):"SAML"}),B?(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:[!O&&(0,t.jsx)(u.Button,{onClick:()=>void z(),size:"small",type:"secondary",children:"Manage"}),(0,t.jsx)(e0.CheckCircleFill,{color:"blue-700",size:20})]}):!O&&(0,t.jsx)(u.Button,{onClick:()=>void z(),size:"small",children:"Configure"}),(0,t.jsxs)(f.MenuContainer,{position:o?"left-start":"bottom-start",children:[(0,t.jsx)(g.MenuButton,{"aria-label":"Show options",svgOnly:!0,type:"tertiary",disabled:!B&&!O&&!n,children:(0,t.jsx)(r.MoreHorizontal,{})}),(0,t.jsxs)(m.Menu,{width:210,children:[n?(0,t.jsx)(p.MenuItem,{onClick:()=>L(!0),children:"Manage Default Roles"}):null,B?(0,t.jsxs)(t.Fragment,{children:[O?(0,t.jsx)(p.MenuItem,{onClick:()=>void z(),children:"Manage"}):null,o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e9.MenuSection,{title:"Once authenticated default to…",children:[(0,t.jsx)(p.MenuItem,{prefix:(0,t.jsx)(e4.LogoVercelCircle,{size:16}),suffix:e?.saml?.defaultRedirectUri&&e?.saml?.defaultRedirectUri!=="vercel.com"?null:(0,t.jsx)(e2.Check,{color:"gray-900"}),onClick:()=>{U("vercel.com")},children:"vercel.com"}),(0,t.jsx)(p.MenuItem,{prefix:(0,t.jsx)(ta.V0Mark,{size:16}),suffix:e?.saml?.defaultRedirectUri==="v0.app"?(0,t.jsx)(e2.Check,{color:"gray-900"}):null,onClick:()=>{U("v0.app")},children:"v0.app"})]}),(0,t.jsx)(e8.MenuDivider,{})]}):null,(0,t.jsx)(p.MenuItem,{onClick:()=>D(!0),type:"error",children:"Remove SAML"})]}):O&&(0,t.jsx)(p.MenuItem,{onClick:()=>void z(),children:"Configure"})]})]})]}),(0,t.jsxs)(x.Entity,{children:[(0,t.jsx)(x.Entity.Content,{description:B&&l&&P&&!(0,e7.tokenHasSamlScope)(P.token,e)?"Please authenticate with SAML before enforcing SAML for this Team.":"Require Team Members to login with SAML to access this Team.",fill:!0}),B&&l&&P&&!(0,e7.tokenHasSamlScope)(P.token,e)?(0,t.jsx)(tu,{disabled:!B,team:e}):(0,t.jsx)(y.Toggle,{checked:d,disabled:!l||!B,onChange:()=>{$(!d),h(e=>!e)},size:"large"})]})]}),C?(0,t.jsx)("div",{className:tr.default.kolchb,children:(0,t.jsx)(e5.Error,{error:C})}):null,(0,t.jsxs)(X.Modal.Modal,{active:R,onClickOutside:()=>D(!1),children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsx)(X.Modal.Title,{children:"Disconnect SAML"}),(0,t.jsx)("div",{className:tr.default.hbsbyw,children:(0,t.jsxs)(X.Modal.Subtitle,{children:["You are about to remove the SAML Configuration. After removing it,"," ","you won't be able to use SAML Single Sign-On to log in to Vercel anymore."]})}),(0,t.jsx)(X.Modal.Subtitle,{children:"Do you want to continue?"})]}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:()=>D(!1),type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{loading:"removeSAML"===j,onClick:H,children:"Continue"})]})]}),e?(0,t.jsx)(th,{team:e,active:F,onClose:()=>L(!1)}):null]})}function tu(e){let{disabled:i,team:s}=e,{mutate:l}=(0,I.useTeam)(),{mutate:n}=(0,eK.useUser)(),{mutate:r}=tt(),{login:a,state:o}=(0,ts.useAuth)("login",{onAuthenticated:async()=>{await Promise.all([l,n,r])},defaultState:{teamSlug:s.slug}}),{loginState:c}=o;return(0,t.jsx)(u.Button,{disabled:i,loading:c===tl.LOGIN_STATE.LOADING_SAML,onClick:()=>void a("saml"),size:"small",children:"Re-Authenticate"})}function th(e){let{team:i,active:s,onClose:l}=e,n=e6.v0Roles.find(e=>i.defaultRoles?.teamPermissions?.includes(e)),r=(0,b.useToasts)(),{mutate:o}=(0,I.useTeam)(),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(i.defaultRoles?.teamRoles[0]??void 0),[x,m]=(0,a.useState)(n??null);async function g(){try{d(!0),await (0,T.fetchAPI)(`${w.API_TEAMS}/${i.id}`,{method:"PATCH",body:JSON.stringify({defaultRoles:{teamRoles:[u],teamPermissions:x?[x]:[]}}),throwOnHTTPError:!0}),await o(),r.success("Updated default roles for your Team successfully."),l()}catch(e){r.error((0,G.normalizeError)(e).message)}finally{d(!1)}}return(0,t.jsxs)(X.Modal.Modal,{active:s,onClickOutside:l,allowOverflow:!0,disableFocusTrap:!0,children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsx)(X.Modal.Title,{children:"Manage Default Roles"}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)(X.Modal.Subtitle,{children:"Select the roles that users will have by default when they join the Team if they join without a role."}),(0,t.jsx)(X.Modal.Subtitle,{children:"Creating an email invite or configuring Directory Sync will override these settings."}),(0,t.jsx)(tc.RoleSelector,{value:u,onChange:h,width:240,ignoreRoles:["OWNER"],v0Role:x??"NONE",onV0RoleChange:e=>{m("NONE"===e?null:e)}})]})]}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:l,type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{onClick:()=>void g(),loading:c,disabled:!u,children:"Save default roles"})]})]})}var tx=e.i(4161083),tm=e.i(5585544),tg=e.i(3924999),tf=e.i(7567269),tp=e.i(8735244),tj=e.i(2384195),ty=e.i(5797774);function tb(e){let{entries:i,children:s,...l}=e,n=i.filter(e=>null!=e.date),r=void 0===s?(0,t.jsx)(tv,{entries:n}):s;return 0===n.length?r:(0,t.jsx)(ty.ContextCard.Trigger,{content:(0,t.jsx)(tS,{entries:n}),...l,children:r})}function tv(e){var i;let s,l,{entries:n}=e,r=n[0],o=(i=r?.date,s=(0,a.useCallback)(()=>{if(null==i)return"";let e=Date.now()-i,t=Math.floor(e/864e5),s=Math.floor(e/36e5),l=Math.floor(e/6e4);return t>0?`${t} day${t>1?"s":""} ago`:s>0?`${s} hour${s>1?"s":""} ago`:l>0?`${l} minute${l>1?"s":""} ago`:"Just now"},[i]),l=(0,a.useCallback)(e=>{if(null==i)return()=>void 0;let t=setInterval(e,6e4);return()=>clearInterval(t)},[i]),(0,a.useSyncExternalStore)(l,s,s));return(0,t.jsx)("p",{className:"text-label-14 text-gray-900",children:o||"—"})}function tS(e){let{entries:i}=e;return(0,t.jsx)("div",{className:"flex flex-col gap-4 min-w-[300px]",children:i.map((e,s)=>(0,t.jsx)(tA,{entry:e,showDivider:s<i.length-1},e.title))})}function tA(e){var i;let s,l,{entry:n,showDivider:r}=e,o=Intl.DateTimeFormat().resolvedOptions().timeZone,c=(i=n.date,s=(0,a.useCallback)(()=>{if(null==i)return"";let e=function(e){let t=Math.abs(e),i=[];for(let{unit:e,ms:s}of tw){let l=Math.floor(t/s);if((l>0||i.length>0)&&(i.push(`${l} ${e}${1!==l?"s":""}`),t%=s),3===i.length)break}return i.join(", ")}(Date.now()-i);return e?`${e} ago`:"Just now"},[i]),l=(0,a.useCallback)(e=>{if(null==i)return()=>void 0;let t=setInterval(e,1e3);return()=>clearInterval(t)},[i]),(0,a.useSyncExternalStore)(l,s,s));return null==n.date?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("span",{className:"text-label-13",children:n.title}),(0,t.jsx)("span",{className:"tabular-nums text-label-13 text-gray-900",children:c}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)(tT,{date:n.date,zone:"UTC"}),(0,t.jsx)(tT,{date:n.date,zone:o})]})]}),r&&(0,t.jsx)("div",{className:"h-px bg-gray-alpha-400"})]})}function tT(e){let{date:i,zone:s}=e,l=new Date(i),n=new Intl.DateTimeFormat("en-US",{timeZone:s,timeZoneName:"short"}).formatToParts(l).find(e=>"timeZoneName"===e.type)?.value||s,r=l.toLocaleString("en-US",{timeZone:s,year:"numeric",month:"long",day:"numeric"}),a=l.toLocaleTimeString("en-US",{timeZone:s,hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"flex items-center justify-center h-4 px-1.5 bg-gray-200 rounded-xs",children:(0,t.jsx)("span",{className:"text-label-12-mono text-gray-900",children:n})}),(0,t.jsx)("span",{className:"text-label-13",children:r})]}),(0,t.jsx)("span",{className:"tabular-nums text-label-12-mono text-gray-900",children:a})]})}let tw=[{unit:"year",ms:31536e6},{unit:"month",ms:2628e6},{unit:"day",ms:864e5},{unit:"hour",ms:36e5},{unit:"minute",ms:6e4},{unit:"second",ms:1e3}];var tI=e.i(950120),tM=e.i(2699603),tC=e.i(8129674),tk=e.i(5323212);function tN(e){let{value:i,onChange:s,disabled:l,placeholder:n}=e,{teamRoles:r}=(0,tC.useAvailableRolesInfo)(),{accessGroups:a}=(0,tM.useAccessGroups)();return(0,t.jsxs)(tk.Select,{disabled:l,onChange:e=>{s(e.target.value)},placeholder:i?void 0:n,size:"small",value:i,width:180,children:[(0,t.jsx)("option",{disabled:!0,children:"Roles"}),r.map(e=>{let{role:i,label:s,description:l}=e;return(0,t.jsx)("option",{title:l,value:i,children:s},i)}),(0,t.jsx)("option",{disabled:!0,children:"─"}),(0,t.jsx)("option",{disabled:!0,children:"Access Groups"}),a?.map(e=>{let{accessGroupId:i,name:s}=e;return(0,t.jsx)("option",{value:i,children:s},i)})]})}var tE=e.i(1539040);function t_(){let{team:e,mutate:i}=(0,I.useTeam)(),{user:s}=(0,eK.useUser)(),{can:l}=(0,N.default)(),n=l(E.Action.Update,E.Resource.SamlConfig),o=l(E.Action.Read,E.Resource.SamlConfig),c=(0,tC.useAvailableRolesInfo)(),{value:d}=(0,eQ.useEntitlement)("multi-role-selector"),h=(0,M.useIsMobile)(),j=(0,b.useToasts)(),[y,v]=(0,a.useState)(!1),[S,C]=(0,a.useState)(null),[k,_]=(0,a.useState)(!1),[P,F]=(0,a.useState)(!1),[L,R]=(0,a.useState)(!1),D=(0,a.useRef)(e?.saml?.roles||{}),[O,B]=(0,a.useState)(()=>e?.saml?.roles||{}),$=(0,a.useRef)(null),V=(0,e7.isDSyncConfigured)(e),z="VIEWER",H=`Default: ${(0,tf.default)(z)}`;(0,a.useEffect)(()=>{let t=e?.saml?.roles||{};D.current=t,B(t)},[e]);let{data:U}=(0,tg.default)((t,i)=>{if(!e||!V||!o)return null;let s=`${w.API_TEAMS}/${e.id}/dsync/groups`;if(!i)return s;let l=i.pagination.after;return l?`${s}?after=${l}`:null},e=>(0,T.fetchAPI)(e,{throwOnHTTPError:!0}),{revalidateOnFocus:!1,refreshInterval:0,initialSize:500}),{data:q,isLoading:W}=(0,tg.default)((t,i)=>{if(!(V&&e&&o)||!k)return null;let s=`${w.API_TEAMS}/${e.id}/dsync/users`;if(!i)return s;let l=i.pagination.after;return l?`${s}?after=${l}`:null},e=>(0,T.fetchAPI)(e,{throwOnHTTPError:!0}),{revalidateOnFocus:!1,refreshInterval:0,initialSize:3e3}),{accessGroups:Y}=(0,tM.useAccessGroups)(),J=q?.reduce((e,t)=>t?e.concat(t.users):e,[]),Z=(0,a.useMemo)(()=>U?.reduce((e,t)=>t?e.concat(t.groups):e,[]),[U]);(0,a.useEffect)(()=>{if(!Z)return;let e=Z.reduce((e,t)=>(t.predefinedRole&&(e[t.id]=t.predefinedRole),e),{});B(t=>{let i={...t,...e};return D.current=i,i})},[Z]);let{lastReceivedWebhookEvent:K,lastSyncedAt:ee,type:et}=e?.saml?.directory||{},ei=et&&tj.DirectorySyncType[et],es=et&&tj.DirectorySyncLogo[et],el=(0,a.useMemo)(()=>J?tP(J,O,c.teamRoles,Y,!!d):[],[J,O,c,d,Y]);async function en(){if(e&&O){v(!0);try{await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}`,{method:"PATCH",body:JSON.stringify({saml:{roles:O}}),throwOnHTTPError:!0}),D.current=O,_(!1),j.success("Directory Sync configured successfully.")}catch(e){C((0,G.normalizeError)(e))}v(!1)}}let er=Y?.reduce((e,t)=>(e[t.accessGroupId]=t.name,e),{})||{},ea=(0,a.useCallback)(()=>{if(e&&n){if($.current)return void $.current.open();try{let t=`${location.origin}/popups/saml-sso${(0,A.encode)({teamSlug:e.slug})}`,s=`${w.API_TEAMS}/${e.id}/sso/configure${(0,A.encode)({intent:"dsync",next:t,redirect:1})}`,l=e.slug;$.current=new ti.default({id:`saml-configure-popup:${Math.random().toString(36).slice(2)}`,width:1200,height:840,url:s,callbacks:{onPoll:async e=>{let s;try{s=e.location.href}catch{return}if(s===t){$.current?.cancelPolling(),$.current?.close();let e=await i();if(e?.teams){let t=e.teams.find(e=>e.slug===l);(0,e7.isDSyncConfigured)(t)&&(C(null),V||_(!0))}else C({message:"Failed to fetch updated Team information."});$.current=null}},onClose:()=>{$.current=null},onAbort:()=>{$.current=null},onBlocked:()=>{C({message:"The popup to configure Directory Sync could not be opened."}),$.current=null}}}),$.current.open()}catch(e){C((0,G.normalizeError)(e))}}},[n,V,i,e]),eo=()=>{_(!1)},ec=async()=>{if(e){v("removeDsync");try{await (0,T.fetchAPI)(`${w.API_TEAMS}/${e.id}/dsync`,{method:"DELETE",throwOnHTTPError:!0}),await i(),C(null),j.success("Removed Directory Sync configuration successfully.")}catch(e){C((0,G.normalizeError)(e))}v(!1),R(!1)}},ed=(0,a.useCallback)(()=>{if(n){if(V)return _(!0);ea()}},[n,V,ea]),eu=e?.membership?.role.toLowerCase()??"",eh=(0,a.useMemo)(()=>el.find(e=>Object.values(e.users).find(e=>e?.connectedUserId===s?.uid)),[el,s?.uid]),ex=eh?.role.toLowerCase()??eu,em=[];return Object.values(O).forEach(e=>{let t=e&&"string"!=typeof e&&"accessGroupId"in e?e.accessGroupId:null,i=Y?.find(e=>e.accessGroupId===t);i&&!i.isDsyncManaged&&i.membersCount>0&&!em.find(e=>e.accessGroupId===i.accessGroupId)&&em.push(i)}),(0,t.jsxs)("div",{className:"tailwind-preflight",children:[(0,t.jsx)(x.Entity.List,{children:(0,t.jsx)(x.Entity,{left:(0,t.jsx)("div",{children:et?(0,t.jsx)(e3.Avatar,{size:32,src:es}):(0,t.jsx)("div",{className:tE.default.circleIcon,children:(0,t.jsx)(tx.BookOpen,{size:16})})}),right:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:[!h&&(0,t.jsx)(u.Button,{disabled:!n,onClick:ed,size:"small",children:"Configure"}),V?(0,t.jsx)(e0.CheckCircleFill,{color:"blue-700",size:20}):null,(0,t.jsxs)(f.MenuContainer,{children:[(0,t.jsx)(g.MenuButton,{"aria-label":"Show options",disabled:!V&&!h,svgOnly:!0,type:"tertiary",children:(0,t.jsx)(r.MoreHorizontal,{})}),(0,t.jsxs)(m.Menu,{children:[V?(0,t.jsx)(p.MenuItem,{disabled:!n,onClick:()=>ea(),children:"Manage"}):null,h?(0,t.jsx)(p.MenuItem,{onClick:ed,children:"Configure"}):null,V?(0,t.jsx)(p.MenuItem,{disabled:!n,onClick:()=>R(!0),type:"error",children:"Remove"}):null]})]})]}),children:(0,t.jsx)(x.Entity.Content,{description:V?"Manage the configuration with your Directory Provider.":"Provision and de-provision accounts with your directory provider.",title:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row items-stretch justify-start gap-0 lg:gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-heading-14",children:ei||"Directory Sync"}),(0,t.jsx)(tb,{entries:[{title:"Last Webhook Received",date:K},{title:"Last Sync Time",date:ee}]})]})})})}),S?(0,t.jsx)(e5.Error,{className:"pt-4",error:S}):null,(0,t.jsxs)(X.Modal.Modal,{active:L,onClickOutside:()=>R(!1),children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsx)(X.Modal.Title,{children:"Disconnect Directory Sync"}),(0,t.jsx)("div",{children:(0,t.jsx)(X.Modal.Subtitle,{children:"You are about to remove the Directory Sync Configuration. After removing it, changes to users and groups in your Identity Provider will not be reflected on Vercel."})}),(0,t.jsx)(X.Modal.Subtitle,{children:"Do you want to continue?"})]}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:()=>R(!1),type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{loading:"removeDsync"===y,onClick:ec,children:"Continue"})]})]}),(0,t.jsx)(X.Modal.Modal,{active:k,disableFocusTrap:!0,onAnimationDone:()=>{F(!1),B(D.current)},onClickOutside:eo,width:500,children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(X.Modal.Body,{children:[(0,t.jsx)(X.Modal.Title,{children:"Directory Sync"}),(0,t.jsx)("div",{children:(0,t.jsx)(X.Modal.Subtitle,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial pb-4",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Continuing will synchronize your Vercel Team Member accounts with your Directory Provider, allowing you to provision and de-provision accounts and manage permissions on Vercel."}),eu!==ex?(0,t.jsxs)(Q.Note,{fill:!0,type:"warning",children:["Based on the current assignments, your role will change from ",(0,t.jsx)("span",{className:tE.default.capitalize,children:eu})," to ",(0,t.jsx)("span",{className:tE.default.capitalize,children:ex}),"."]}):null,em.length?(0,t.jsxs)(Q.Note,{fill:!0,type:"warning",children:["Access Groups linked to Directory Sync will have their members synced. All other members will be removed. Affected Access groups: ",em.map(e=>e.name).join(", ")]}):null]})})}),W?(0,t.jsx)(X.Modal.Inset,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center flex-initial",children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-center",children:"Loading Users"}),(0,t.jsx)(tp.Spinner,{})]})})}):null,el.length?(0,t.jsxs)(X.Modal.Outset,{children:[(0,t.jsx)("hr",{className:"geist-hr-reset"}),el.map(e=>Object.keys(e.users).length?(0,t.jsx)(tI.Details,{title:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-between flex-initial w-full",children:[(0,t.jsxs)("div",{className:"font-semibold",children:[e.name," (",Object.keys(e.users).length," user",Object.keys(e.users).length>1?"s":"",")"]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(e3.Avatar,{size:20,src:es}),(0,t.jsx)(tF,{groups:e.groups}),(0,t.jsx)(tL,{groups:e.accessGroups})]})]}),children:Object.values(e.users).map(e=>{let i=new Set(e?.groups.map(e=>{let t=O[e.id];return t&&"string"!=typeof t?er[t.accessGroupId]:null}).filter(Boolean));return e?(0,t.jsxs)(tI.Item,{children:[(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start flex-1",children:[e.firstName?(0,t.jsxs)("p",{className:"text-[14px] leading-[20px] font-medium",children:[e.firstName," ",e.lastName]}):null,e.email?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:[e.firstName?(0,t.jsx)(t.Fragment,{children:" • "}):null,e.email]}):null]}),i.size?(0,t.jsx)(eN.Tooltip,{text:(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("strong",{children:"Access Groups"}),Array.from(i).map(e=>(0,t.jsx)("div",{className:"max-w-48 overflow-hidden truncate whitespace-nowrap",children:(0,t.jsx)("p",{className:"text-copy-14",children:e})},e))]}),children:(0,t.jsx)("div",{className:tE.default.circleIconSmall,children:(0,t.jsx)(tm.Users,{size:12})})}):null]},e.id):null})},e.name):null)]}):null]}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:()=>F(!1),type:"secondary",children:"Back"}),(0,t.jsx)(X.Modal.Action,{onClick:en,children:"Confirm and Sync"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Modal.Body,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)(X.Modal.Title,{children:"Directory Sync"}),(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Choose which roles will be assigned to synced members. Non-configured groups default to the Viewer role.",d?" Users can be part of multiple groups and have multiple roles.":null]}),(0,t.jsxs)("div",{className:"flex items-center justify-center pb-4 pt-6",children:[(0,t.jsxs)("div",{className:"flex w-28 flex-col items-center gap-2",children:[(0,t.jsx)(e3.Avatar,{size:48,src:es}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900 truncate",title:ei,children:ei})]}),(0,t.jsx)(tR,{}),(0,t.jsxs)("div",{className:"flex w-28 flex-col items-center gap-2",children:[(0,t.jsx)(e3.Avatar,{size:48,teamId:e?.id}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900 truncate",title:e?.name,children:e?.name})]})]}),(0,t.jsx)(X.Modal.Outset,{children:(0,t.jsx)("div",{style:{overflow:"scroll",maxHeight:"40vh"},children:Z?Z.map(e=>{let i,s=!1;if(e.id in O){var l;let t=O[e.id];i=t?"string"==typeof(l=t)?l:"accessGroupId"in l?l.accessGroupId:l:z}return e.predefinedRole&&c.teamRoles.find(t=>t.role===e.predefinedRole)&&(i=e.predefinedRole,s=!0),(0,t.jsxs)(a.Fragment,{children:[(0,t.jsx)("hr",{className:"geist-hr-reset"}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-1 flex-initial",style:{padding:"var(--geist-gap-half) var(--geist-gap)"},children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",style:{flexBasis:"60%"},children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(e3.Avatar,{size:20,src:es}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:e.name})]})}),(0,t.jsx)(eN.Tooltip,{disableTriggers:!s,text:"This group has a predefined role which cannot be modified.",children:(0,t.jsx)(tN,{disabled:s,onChange:t=>{var i;let s=(i=t).startsWith("ag_")?{accessGroupId:i}:i;B({...O,[e.id]:s})},placeholder:H,value:i})})]})]},e.id)}):(0,t.jsx)(X.Modal.Inset,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center flex-initial",children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-center",children:"Loading Groups"}),(0,t.jsx)(tp.Spinner,{})]})})})})})]})}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:eo,type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{onClick:()=>F(!0),children:"Continue"})]})]})})]})}let tP=(e,t,i,s,l)=>{let n={},r=i.map(e=>e.role);for(let e of i)n[e.role]={name:e.label,role:e.role,groups:{},accessGroups:{},users:{}};let a=new Set;for(let i of e){let e=[];for(let l of i.groups){let r=t[l.id];if(r){if(l.predefinedRole){e.push(l.predefinedRole);continue}if("string"==typeof r&&n[r]){n[r].groups[l.id]=l,e.push(r);continue}if("string"!=typeof r){a.add(i.id);let t=s?.find(e=>e.accessGroupId===r.accessGroupId);if(!t)continue;let o=t?.teamRoles||["CONTRIBUTOR"];for(let i of(e.push(...o),o||[]))n[i]&&(n[i].groups[l.id]=l,n[i].accessGroups[r.accessGroupId]=t)}}}let o=a.has(i.id)?"CONTRIBUTOR":"VIEWER",c=r.filter(t=>e.includes(t));0===c.length&&c.push(o);let d=r.find(e=>i.groups.some(t=>t.predefinedRole===e));for(let e of l?c:[d||c[0]||o])n[e]&&(n[e].users[i.id]=i)}return r.map(e=>n[e]).filter(e=>void 0!==e)};function tF(e){let{groups:i}=e;return Object.keys(i).length>0?(0,t.jsxs)(t.Fragment,{children:[1===Object.keys(i).length?(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:Object.values(i)[0]?.name}):null,Object.values(i).length>1?(0,t.jsx)(eN.Tooltip,{text:Object.values(i).map(e=>e?.name).join("\n"),children:(0,t.jsxs)("p",{className:"text-copy-14",children:[Object.values(i).length," groups"]})}):null]}):(0,t.jsx)("p",{className:"text-copy-14",children:"No group"})}function tL(e){let{groups:i}=e,s=Object.values(i);return 0===s.length?null:(0,t.jsx)(eN.Tooltip,{text:(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("strong",{children:"Access Groups"}),s.map(e=>(0,t.jsx)("div",{className:"max-w-48 overflow-hidden truncate whitespace-nowrap",children:(0,t.jsx)("p",{className:"text-copy-14",children:e?.name})},e?.accessGroupId))]}),children:(0,t.jsx)("div",{className:tE.default.circleIconSmall,children:(0,t.jsx)(tm.Users,{size:12})})})}function tR(){return(0,t.jsxs)("svg",{fill:"none",height:"24",width:"66",children:[(0,t.jsx)("path",{d:"M65 11.625H1",stroke:"var(--accents-4)",strokeDasharray:"3 3",strokeLinecap:"square"}),(0,t.jsx)("rect",{fill:"var(--geist-background)",height:"24",rx:"12",width:"24",x:"21"}),(0,t.jsx)("path",{d:"M33 22c5.523 0 10-4.477 10-10S38.523 2 33 2 23 6.477 23 12s4.477 10 10 10z",fill:"var(--accents-5)"}),(0,t.jsx)("g",{clipPath:"url(#clip0)",stroke:"var(--geist-background)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",children:(0,t.jsx)("path",{d:"M34.5 9.5H36a2.5 2.5 0 110 5h-1.5m-3 0H30a2.5 2.5 0 010-5h1.5M31 12h4"})}),(0,t.jsx)("defs",{children:(0,t.jsx)("clipPath",{id:"clip0",children:(0,t.jsx)("path",{d:"M0 0h12v12H0z",fill:"var(--geist-background)",transform:"translate(27 6)"})})})]})}var tD=e.i(7909933);function tO(){let{team:e}=(0,I.useTeam)(),{can:i}=(0,N.default)(),[s,l]=(0,a.useState)(null),n=function(){let[e,t]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{"#error"===window.location.hash&&t(!0)},[]),e}(),o=(0,b.useToasts)();(0,a.useEffect)(()=>{n&&o.error("Verification failed. Please try again.")},[n,o]);let[c,d]=(0,a.useState)(!1),h=i(E.Action.Update,E.Resource.SamlConfig),j=(0,M.useIsMobile)(),y=(0,e7.isDSyncConfigured)(e),{isReady:v,value:S}=(0,k.useLaunchDarklyTeamFeatureFlag)("organization-domain-verification"),{data:C,isLoading:_}=(0,tD.default)(e&&h?`${w.API_TEAMS}/${e?.id}/domain-verification/status`:null,async t=>{if(!e||!h)return null;try{return(await (0,T.default)(t,{method:"GET",throwOnHTTPError:!0})).status}catch(e){return e&&"object"==typeof e&&"status"in e&&"number"==typeof e.status&&e.status>=500&&l({message:"Failed to fetch domain verification status. Please try again."}),null}}),P=async()=>{if(e&&h)try{await (0,T.default)(`${w.API_TEAMS}/${e.id}/domain-verification`,{method:"DELETE",throwOnHTTPError:!0}),d(!1),o.success("Removed Domain Verification successfully.")}catch(e){l((0,G.normalizeError)(e)),d(!1),o.error("Failed to remove Domain Verification.")}},F="VERIFIED"===C||"PENDING"===C,L="VERIFIED"!==C,R=(0,a.useCallback)(()=>{if(e&&h)try{let t=`${location.origin}/teams/${e.slug}/~/settings/security`,i=`${w.API_TEAMS}/${e.id}/sso/configure${(0,A.encode)({intent:"domain_verification",next:t,redirect:1})}`;window.location.assign(i)}catch(e){l((0,G.normalizeError)(e))}},[h,e]),D=(0,a.useCallback)(()=>{h&&R()},[h,R,C]);return v&&!S?null:(0,t.jsxs)("div",{className:"tailwind-preflight",children:[(0,t.jsx)(x.Entity.List,{className:`${y?"":"hidden"}`,children:(0,t.jsx)(x.Entity,{left:(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"border-[1px] border-(--accents-2) rounded-full flex justify-center items-center w-[32px] h-[32px]",children:(0,t.jsx)(tx.BookOpen,{size:16})})}),right:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[!j&&(0,t.jsx)(u.Button,{disabled:!h||F,onClick:D,size:"small",children:"Configure"}),_||"VERIFIED"!==C?null:(0,t.jsx)(e0.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsxs)(f.MenuContainer,{children:[(0,t.jsx)(g.MenuButton,{"aria-label":"show options",disabled:_||!y,svgOnly:!0,type:"tertiary",children:(0,t.jsx)(r.MoreHorizontal,{})}),(0,t.jsxs)(m.Menu,{children:[(0,t.jsx)(p.MenuItem,{disabled:!h||!y||F,onClick:()=>R(),children:"Manage"}),(0,t.jsx)(p.MenuItem,{disabled:!h||!y||L,onClick:()=>d(!0),children:"Remove"})]})]})]}),children:(0,t.jsx)(x.Entity.Content,{description:"VERIFIED"===C?"Manage your domain's verification status.":"Verify your domain to simplify login for your users.",title:(0,t.jsx)("div",{className:"flex flex-col md:flex-row items-center md:gap-2",children:(0,t.jsx)("p",{className:"text-heading-14",children:"Domain Verification"})})})})}),(0,t.jsxs)(X.Modal.Modal,{active:c,onClickOutside:()=>d(!1),children:[(0,t.jsx)("div",{className:"flex flex-col gap-2 p-4",children:(0,t.jsxs)(X.Modal.Header,{children:[(0,t.jsx)(X.Modal.Title,{children:"Remove Domain Verification"}),(0,t.jsx)(X.Modal.Subtitle,{children:"Proceeding will remove the domain verification configuration."})]})}),(0,t.jsxs)(X.Modal.Actions,{children:[(0,t.jsx)(X.Modal.Action,{onClick:()=>d(!1),type:"secondary",children:"Cancel"}),(0,t.jsx)(X.Modal.Action,{onClick:P,children:"Remove"})]})]}),s?(0,t.jsx)(e5.Error,{className:"pt-4",error:s}):null]})}function tB(){let{team:e,isReady:i}=(0,I.useTeam)(),{can:s,isLoading:l}=(0,N.default)(),n=s(E.Action.Update,E.Resource.SamlConfig),r=!i||!e||l,a=r||!n,{value:u}=(0,eQ.useEntitlement)("saml"),{value:h}=(0,eQ.useEntitlement)("dsync");return(0,t.jsxs)(c.Fieldset,{disabled:a,children:[(0,t.jsxs)(o.FieldsetContent,{children:[(0,t.jsx)(ee.FieldsetTitle,{id:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.samlSingleSignOn,children:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.samlSingleSignOn}),(0,t.jsx)(z.FieldsetSubtitle,{children:"Customize the behavior of SAML authentication and directory syncing for your Team."}),(0,t.jsx)(_.DisabledContext.Provider,{value:!u,children:(0,t.jsx)(td,{})}),(0,t.jsx)("hr",{className:"geist-hr-reset",style:{margin:"24px 0"}}),(0,t.jsxs)(_.DisabledContext.Provider,{value:!h,children:[(0,t.jsx)(t_,{}),(0,t.jsx)(tO,{})]})]}),(0,t.jsx)(d.FieldsetFooter,{disabled:!1,highlight:!n||!h,children:(0,t.jsx)(t$,{loading:r,hasSamlEntitlement:u,canUpdateSAML:n,team:e??void 0})})]})}function t$(e){let{loading:i,hasSamlEntitlement:s,canUpdateSAML:l,team:n}=e;if(i||!n)return(0,t.jsx)(j.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"});let r=n.billing?.plan,a=n.billing?.planIteration;return"pro"!==r||"plus"===a||s?"enterprise"!==r||s?"pro"!==r||"plus"!==a||s?l?(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/saml",variant:"highlight",children:"SAML Single Sign-On"})]}):(0,t.jsx)("span",{children:"You need additional permissions to manage your team's SAML single sign-on."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["SAML is optionally available as an add-on. Directory Sync is optionally available on the"," ",(0,t.jsx)(v.Link,{"data-testid":(0,S.tid)("account-settings","security","enterprise-learn-more"),href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:(0,t.jsx)(v.ButtonLink,{href:`/${n.slug}/~/settings/billing#saml-sso`,size:"small",children:"Go to Billing Add-Ons"})})]}):(0,t.jsx)("span",{children:"Contact Sales to enable SAML Single Sign-On."}):(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/saml",variant:"highlight",children:"SAML Single Sign-On"})]})}var tG=e.i(6143247);function tV(){let{team:e,isReady:i}=(0,I.useTeam)(),{can:s,isLoading:l}=(0,N.default)(),{isReady:n}=(0,$.useIsRoleEnabled)("VIEWER"),{isReady:r}=(0,$.useIsRoleEnabled)("DEVELOPER"),{value:a}=(0,k.useGitExclusivityFlag)(),o=s(E.Action.Update,E.Resource.Team),c=s(E.Action.Read,E.Resource.SensitiveEnvironmentVariablePolicy),d=!i||!e||l||!n||!r,{value:u}=(0,eQ.useEntitlement)("saml"),h=d||!o||!u;return(0,t.jsxs)(t.Fragment,{children:[a?(0,t.jsx)(L.default,{id:"git-exclusivity",children:(0,t.jsx)(eW,{})}):null,d?(0,t.jsx)(L.default,{children:(0,t.jsx)(J.default,{height:80})}):null,c?(0,t.jsx)(L.default,{id:"sensitive-environment-variable-policy",children:(0,t.jsx)(tH,{})}):null,(0,t.jsx)(L.default,{id:"audit-log-export",children:(0,t.jsx)(tz,{})}),(0,t.jsx)(_.DisabledContext.Provider,{value:h,children:(0,t.jsx)(P.PlaceholderContext.Provider,{value:d,children:(0,t.jsx)(L.default,{id:"saml-options",children:(0,t.jsx)(tB,{})})})}),(0,t.jsx)(eX,{}),(0,t.jsx)(L.default,{id:"hide-ip-addresses",children:(0,t.jsx)(Y,{})}),(0,t.jsx)(eM,{}),(0,t.jsx)(eZ.TeamDeploymentRetention,{})]})}function tz(){let{team:e,isReady:y}=(0,I.useTeam)(),{can:_,isLoading:P}=(0,N.default)(),{value:L}=(0,k.useAuditLogStreamsFlag)(),R=L||e?.enabledInvoiceItems?.siem?.enabled===!0,D=_(E.Action.Create,E.Resource.AuditLog),$=(0,M.useIsMobile)(),G=(0,b.useToasts)(),V=(0,a.useMemo)(()=>new Date,[]),z=(0,a.useMemo)(()=>(0,l.addDays)(V,-90),[V]),[H,U]=(0,a.useState)({start:z,end:V}),[q,Y]=(0,a.useState)(!1),J=(0,a.useCallback)(async()=>{if(!q&&H&&e)try{Y(!0);let t=(0,A.encode)({teamId:e.id}),l=new Date(H.start),n=new Date(H.end),r=Date.UTC(l.getFullYear(),l.getMonth(),l.getDate()),a=Math.min(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())+864e5-1,Date.now());i.analytics.track(s.AnalyticsEvent.AUDIT_LOG_EXPORT_CLICKED,{teamId:e.id,from:r,to:a}),await (0,T.fetchAPI)(`${w.API_EVENTS_EXPORT}${t}`,{method:"POST",throwOnHTTPError:!0,body:JSON.stringify({format:"CSV",from:r,to:a}),headers:{"Content-Type":"application/json"}}),G.success({text:"Successfully started the export. You will receive an email when your download is ready.",key:"audit-log-export-success"})}catch(e){if(e instanceof Error)G.error(e.message);else throw e}finally{Y(!1)}},[e,q,Y,G,H]),Z=y||!P,K=e?.billing?.plan==="enterprise",X=(0,a.useMemo)(()=>Z?K?D?(0,t.jsxs)(t.Fragment,{children:["Learn more about ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/observability/audit-log",variant:"highlight",children:"Audit Logs"})]}):(0,t.jsx)(t.Fragment,{children:"You need additional permissions to manage your team's audit logs."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["Audit Logs are available on the"," ",(0,t.jsx)(v.Link,{href:"/pricing",variant:"highlight",children:"Enterprise Plan"}),"."]}),(0,t.jsx)(d.FieldsetFooter.Actions,{children:(0,t.jsx)(v.ButtonLink,{href:C.CONTACT_SALES_DASHBOARD_HREF,size:"small",tab:!0,children:"Upgrade"})})]}):(0,t.jsx)(j.Skeleton,{boxHeight:"32px",vcenter:!0,width:"200px"}),[D,Z,K]),Q=(0,A.encode)({teamId:e?.id});return(0,t.jsxs)(c.Fieldset,{disabled:!Z||!D||!K,children:[(0,t.jsx)(o.FieldsetContent,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:(0,t.jsx)(W.FieldsetTitle,{id:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.auditLog,children:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.auditLog})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsx)("div",{children:(0,t.jsx)(F.FormTitleDescription,{description:"Export your team's activity up to the last 90 days.",title:"Export Audit Log"})}),(0,t.jsxs)("div",{className:(0,tG.cn)("flex justify-between flex-initial",$?"flex-col gap-4":"gap-0 flex-row items-center"),children:[(0,t.jsx)(h.Calendar,{dataTestId:(0,S.tid)("security-page","calendar"),maxValue:V,minValue:z,onChange:e=>U(e),value:H,width:"auto"}),(0,t.jsx)(u.Button,{disabled:!H,loading:q,onClick:()=>void J(),size:"small",children:q?"Exporting CSV":"Export CSV"})]})]}),(0,t.jsx)(O.default,{margin:0}),(0,t.jsx)(x.Entity.List,{children:(0,t.jsx)(x.Entity,{right:$?(0,t.jsxs)(f.MenuContainer,{children:[(0,t.jsx)(g.MenuButton,{"aria-label":"Show options",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(r.MoreHorizontal,{})}),(0,t.jsx)(m.Menu,{children:(0,t.jsx)(p.MenuItem,{href:`/api/audit-logs/log-stream${Q}`,isLink:!0,prefetch:!1,rel:"noopener noreferrer",target:"_blank",children:"Configure"})})]}):(0,t.jsx)(v.ButtonLink,{disabled:!R,href:`/api/audit-logs/log-stream${Q}`,prefetch:!1,rel:"noopener noreferrer",size:"small",suffix:(0,t.jsx)(n.ExternalSmall,{}),target:"_blank",type:"secondary",children:"Configure"}),children:(0,t.jsx)(x.Entity.Content,{description:R?"Set up a log stream for audit logs to be sent to your SIEM provider.":"Setting up a log stream for audit logs is not available for your plan.",title:"SIEM Integration"})})})]})}),(0,t.jsx)(d.FieldsetFooter,{disabled:!1,highlight:!D||!K,children:X})]})}function tH(){let{team:e,isTeamReady:i,error:s,isLoading:l,saving:n,handleSave:r,hasChangedSensitiveEnvVarPolicy:a,sensitiveEnvVarPolicySetting:o,setSensitiveEnvVarPolicySetting:c}=(0,D.useSensitiveEnvironmentVariablePolicy)(),d=(0,_.useDisabled)(),{can:u,isLoading:h}=(0,N.default)(),x=u(E.Action.Update,E.Resource.SensitiveEnvironmentVariablePolicy),m=(0,D.getBooleanValueFromOnOffDefault)(o);return(0,t.jsx)(R.ProjectSettingsFieldset,{description:"Enforce policies for the creation and editing of this team's environment variables.",disabled:!x||d||!!e?.limited||l||!(i||!h),error:s,highlightNote:d,note:d?(0,t.jsx)(t.Fragment,{children:"You need additional permissions to manage your team's Environment Variable Policy."}):(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/environment-variables/sensitive-environment-variables#environment-variables-policy",variant:"highlight",children:"Environment Variable Policies"})]}),onSave:async()=>{await r()},saveDisabled:!a,saveLoading:n,title:B.TEAM_SETTINGS_NAVIGATION_TITLES.security.environmentVariablePolicy,children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsx)(O.default,{margin:10}),(0,t.jsx)("p",{className:`text-heading-16 text-inherit ${d?"disabled":""}`,"data-testid":(0,S.tid)("geist","fieldset","subtitle"),children:"Enforce Sensitive Environment Variables"}),(0,t.jsxs)("p",{className:"text-copy-14 text-inherit",children:["Ensures that all environment variables created by members of this team will be created as"," ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/environment-variables/sensitive-environment-variables",variant:"highlight",children:"Sensitive Environment Variables"})," ","which can only be decrypted by Vercel's deployment system."]}),(0,t.jsx)("label",{htmlFor:"toggle-env-var-policy",style:{cursor:"pointer"},children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(y.Toggle,{checked:m,id:"toggle-env-var-policy",onChange:()=>{c(m?"off":"on")},size:"large"}),(0,t.jsx)("span",{className:"text-copy-14",children:m?"Enabled":"Disabled"})]})})]})})}e.s(["Security",()=>tV],9379957)}]);

//# debugId=1802e7e6-aafa-da6e-162b-9bfdef2661ec
//# sourceMappingURL=b2bcf358f069ce7f.js.map