;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="e712bda7-c1b3-5cab-8eea-7eca9145797f")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2342653,e=>{"use strict";var t=e.i(8711407),i=e.i(2064047),a=e.i(5255926),s=e.i(2504781),r=e.i(4585051),l=e.i(4991687),n=e.i(6850581),o=e.i(8459493),d=e.i(8674454),c=e.i(6694387),u=e.i(5468328),p=e.i(6891161),g=e.i(3500331),y=e.i(455575),x=e.i(8923565),m=e.i(4030453),h=e.i(1176592),f=e.i(5757634),v=e.i(5338940),j=e.i(7867910),k=e.i(119294),I=e.i(6352514),C=e.i(134877),b=e.i(7722264),w=e.i(6905199);e.i(3512434);var A=e.i(9835407);let N=A.z.string().optional(),K=A.z.object({project:A.z.string().min(1,"Project ID is required"),location:A.z.string().min(1,"Location is required"),googleCredentials:A.z.object({clientEmail:A.z.string().min(1,"Client email is required").email("Invalid email format"),privateKey:A.z.string().min(1,"Private key is required").transform(e=>e.replace(/\\n/g,"")).refine(e=>e.includes("-----BEGIN PRIVATE KEY-----")&&e.includes("-----END PRIVATE KEY-----"),{message:"Must be a valid private key format"}),privateKeyId:N})}),E=A.z.object({authMethod:A.z.enum(["sigv4","apikey"]),accessKeyId:A.z.string().optional(),secretAccessKey:A.z.string().optional(),sigv4Region:A.z.string().optional(),apiKey:A.z.string().optional(),apikeyRegion:A.z.string().optional()}).superRefine((e,t)=>{"sigv4"===e.authMethod?(e.accessKeyId&&0!==e.accessKeyId.length||t.addIssue({code:A.z.ZodIssueCode.custom,message:"Access Key ID is required",path:["accessKeyId"]}),e.secretAccessKey&&0!==e.secretAccessKey.length||t.addIssue({code:A.z.ZodIssueCode.custom,message:"Secret Access Key is required",path:["secretAccessKey"]}),e.sigv4Region&&0!==e.sigv4Region.length||t.addIssue({code:A.z.ZodIssueCode.custom,message:"Region is required",path:["sigv4Region"]})):"apikey"===e.authMethod&&(e.apiKey&&0!==e.apiKey.length||t.addIssue({code:A.z.ZodIssueCode.custom,message:"API Key is required",path:["apiKey"]}),e.apikeyRegion&&0!==e.apikeyRegion.length||t.addIssue({code:A.z.ZodIssueCode.custom,message:"Region is required",path:["apikeyRegion"]}))}),S=A.z.object({apiKey:A.z.string().min(1,"API Key is required"),resourceName:A.z.string().min(1,"Resource Name is required")}),T=A.z.object({apiKey:A.z.string().min(1,"API Key is required")});function M(e,t){let i=(function(e){switch(e){case"vertex":return K;case"bedrock":return E;case"azure":return S;default:return T}})(e).safeParse(t);return i.success?{success:!0,data:i.data}:{success:!1,error:i.error}}function R(e){let{integration:i}=e,[a,r]=(0,h.useState)(!1),[l,n]=(0,h.useState)("idle"),[o,d]=(0,h.useState)(!0),[c,u]=(0,h.useState)("idle"),[A,N]=(0,h.useState)(null),K=(0,h.useCallback)(e=>{try{let t=e?.steps?.[0]?.providerMetadata?.gateway?.routing?.attempts?.find(e=>e.provider===i.providerSlug&&"byok"===e.credentialType&&!1===e.success);if(t?.error)return{title:"Invalid Credentials",message:`${t.error}`,httpResponseCode:e?.httpStatusCode||400};let a=e?.message||e?.details?.error||`${i.name} credentials validation failed`;return{title:"Connection Failed",message:`Connection failed: ${a}`,httpResponseCode:e?.httpStatusCode||400}}catch(e){return{title:"Validation Error",message:`Couldn't validate ${i.name} credentials`,httpResponseCode:500}}},[i.name,i.providerSlug]),E=(0,h.useCallback)(()=>(function(e){switch(e){case"vertex":return{project:"",location:"",googleCredentials:{clientEmail:"",privateKey:"",privateKeyId:""}};case"bedrock":return{authMethod:"sigv4",accessKeyId:"",secretAccessKey:"",sigv4Region:"",apiKey:"",apikeyRegion:""};case"azure":return{apiKey:"",resourceName:""};default:return{apiKey:""}}})(i.providerSlug),[i.providerSlug]),[S,T]=(0,h.useState)(()=>E()),R=()=>{switch(i.providerSlug){case"vertex":return"project";case"bedrock":return q(S)&&"apikey"===S.authMethod?"apiKey":"accessKeyId";default:return"apiKey"}},{team:z}=(0,v.useTeam)(),{mutate:D}=(0,f.useSWRConfig)(),P=(0,y.useToasts)(),_=(0,h.useCallback)((e,t)=>{let a=t.trim();T(t=>{let s;if("vertex"===i.providerSlug&&e.startsWith("googleCredentials.")){let i=e.replace("googleCredentials.","");s={...t,googleCredentials:{...t.googleCredentials,[i]:a}}}else s={...t,[e]:a};return s}),n("idle")},[i.providerSlug]),$=(0,h.useCallback)(()=>M(i.providerSlug,S),[S,i.providerSlug]),O=(0,h.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];T(E()),d(!0),n("idle"),e||(u("idle"),N(null))},[E]),F=(0,h.useCallback)(async()=>{if(!z)return;let e=$();if(!e.success)return void n("failed");let t=e.data;n("creating"),u("testing");let a=null;try{let e=await fetch(`/api/ai-gateway-proxy/byok-credentials?ownerId=${z.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:`${i.name} Key`,credential:JSON.stringify(t),providerSlug:i.providerSlug,active:o})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error?.message||"Couldn't save your credentials. Try again.")}let s=await fetch(`/api/ai-gateway-proxy/byok-credentials/list?ownerId=${z.id}`);if(!s.ok)throw Error("Couldn't verify credential creation. Try again.");let l=await s.json(),d=l.credentials||l,c=Array.isArray(d)?d.filter(e=>e.providerSlug===i.providerSlug).sort((e,t)=>t.createdAt-e.createdAt)[0]:null;if(!c?.credentialId)throw Error("Credential created but couldn't be found. Contact support.");a=c.credentialId;let p=await fetch(`/api/ai-gateway-proxy/byok-credentials/test?teamId=${z.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credentialId:a,providerSlug:i.providerSlug})}),g=await p.json(),y=g.success,x=g.steps?.[0]?.providerMetadata?.gateway?.routing?.attempts?.some(e=>e.provider===i.providerSlug&&"byok"===e.credentialType&&!0===e.success)??!1;if(y&&x)P.success(`${i.name} key added successfully`),await D(`/api/ai-gateway-proxy/byok-credentials/list?ownerId=${z.id}`),r(!1),O();else{(await fetch(`/api/ai-gateway-proxy/byok-credentials?ownerId=${z.id}&credentialId=${a}`,{method:"DELETE"})).ok;let e=K(g);N(e),n("idle"),u("failed")}}catch(e){if(a)try{(await fetch(`/api/ai-gateway-proxy/byok-credentials?ownerId=${z.id}&credentialId=${a}`,{method:"DELETE"})).ok}catch(e){}k.analytics.track(I.AnalyticsEvent.AI_GATEWAY_BYOK_CREDENTIAL_CREATION_ERROR,{message:(0,b.isError)(e)?e.message:"Unknown error",teamId:z.id,errorCode:(0,C.isAPIError)(e)?e.code:void 0,providerSlug:i.providerSlug}),N((0,b.isError)(e)?{title:"Test Failed",message:`Test failed: ${e.message}`,httpResponseCode:(0,C.isAPIError)(e)&&Number(e.statusCode)||500}:{title:"Connection Error",message:`Couldn't test ${i.name} connection. Check your credentials and try again.`,httpResponseCode:500}),n("idle"),u("failed")}},[S,i,z,o,D,P,$,O,K]),B=(0,h.useCallback)(async()=>{"creating"===l||($().success?await F():n("failed"))},[F,l,$]);(0,j.useHotkey)(()=>{a&&"creating"!==l&&"testing"!==l&&r(!1)},"Escape"),(0,h.useEffect)(()=>{let e=e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&a&&"creating"!==l&&(e.preventDefault(),B())};return a&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[a,l,B]);let L=(0,h.useCallback)(e=>{if("Enter"===e.key&&!e.metaKey&&!e.ctrlKey){e.preventDefault();let t=e.currentTarget,a=t.closest("form")||t.closest('[role="dialog"]');if(!a)return;let s=Array.from(a.querySelectorAll('input[type="text"], input[type="password"], input[type="email"], input:not([type])')),r=s.indexOf(t);r===s.length-1?(1!==s.length||["vertex","bedrock","azure"].includes(i.providerSlug))&&"creating"===l||B():s[r+1]?.focus()}},[i.providerSlug,l,B]),q=(0,h.useCallback)(e=>"bedrock"===i.providerSlug,[i.providerSlug]),Y="bedrock"===i.providerSlug&&q(S)?S.authMethod:null;return((0,h.useEffect)(()=>{if("bedrock"===i.providerSlug&&Y){if("apikey"===Y){let e=document.querySelector("#bedrock-api-key-input");e?.focus()}else if("sigv4"===Y){let e=document.querySelector("#bedrock-access-key-input");e?.focus()}}},[Y,i.providerSlug]),(0,h.useLayoutEffect)(()=>{a&&O(!0)},[a,O]),(0,w.canMutateKeys)(z))?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Button,{type:"secondary",size:"small",onClick:()=>{r(!0),u("idle"),N(null)},children:"Add"}),(0,t.jsx)(p.Modal.Modal,{active:a,onClickOutside:()=>{r(!1)},onAnimationDone:()=>{T(E()),n("idle")},children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),B()},children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{children:`Add ${i.name} ${["vertex","bedrock","azure"].includes(i.providerSlug)?"Credentials":"API Key"}`})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(()=>{let e="failed"===l,a=M(i.providerSlug,S),s=t=>{if(!e||a.success)return;let i=a.error.errors.find(e=>e.path.join(".")===t);return i?.message};switch(i.providerSlug){case"vertex":if("vertex"!==i.providerSlug)return(0,t.jsx)("div",{children:"Invalid credentials"});return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"vertex-project-input",children:"Project ID"}),(0,t.jsx)(g.Input,{id:"vertex-project-input",autoFocus:"project"===R(),placeholder:"my-project-id",value:S.project,error:s("project"),onChange:e=>_("project",e.target.value),onKeyDown:L})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"vertex-location-input",children:"Location"}),(0,t.jsx)(g.Input,{id:"vertex-location-input",placeholder:"us-central1",value:S.location,error:s("location"),onChange:e=>_("location",e.target.value),onKeyDown:L})]}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Google Service Account Credentials"}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"vertex-client-email-input",children:"Client Email"}),(0,t.jsx)(g.Input,{id:"vertex-client-email-input",placeholder:"service-account@my-project-id.iam.gserviceaccount.com",value:S.googleCredentials?.clientEmail||"",error:s("googleCredentials.clientEmail"),onChange:e=>_("googleCredentials.clientEmail",e.target.value),onKeyDown:L})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"vertex-private-key-input",children:"Private Key"}),(0,t.jsx)(g.Input,{id:"vertex-private-key-input",placeholder:"-----BEGIN PRIVATE KEY-----",value:S.googleCredentials?.privateKey||"",error:s("googleCredentials.privateKey"),onChange:e=>_("googleCredentials.privateKey",e.target.value),onKeyDown:L,typeName:"password"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-1 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"vertex-private-key-id-input",children:"Private Key ID"}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:"(Optional)"})]}),(0,t.jsx)(g.Input,{id:"vertex-private-key-id-input",placeholder:"my-private-key-id",value:S.googleCredentials?.privateKeyId||"",onChange:e=>_("googleCredentials.privateKeyId",e.target.value),onKeyDown:L})]})]});case"bedrock":if(!q(S))return(0,t.jsx)("div",{children:"Invalid credentials"});return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Authentication Method"}),(0,t.jsxs)(x.Switch,{name:"bedrock-auth-method",children:[(0,t.jsx)(x.Switch.Control,{label:"AWS SigV4",value:"sigv4",checked:"sigv4"===S.authMethod,onChange:()=>_("authMethod","sigv4")}),(0,t.jsx)(x.Switch.Control,{label:"API Key",value:"apikey",checked:"apikey"===S.authMethod,onChange:()=>_("authMethod","apikey")})]})]}),"sigv4"===S.authMethod&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"bedrock-access-key-input",children:"Access Key ID"}),(0,t.jsx)(g.Input,{id:"bedrock-access-key-input",autoFocus:"accessKeyId"===R(),placeholder:"my-access-key-id",value:S.accessKeyId,error:s("accessKeyId"),onChange:e=>_("accessKeyId",e.target.value),onKeyDown:L})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"bedrock-secret-key-input",children:"Secret Access Key"}),(0,t.jsx)(g.Input,{id:"bedrock-secret-key-input",placeholder:"my-secret-access-key",value:S.secretAccessKey,error:s("secretAccessKey"),onChange:e=>_("secretAccessKey",e.target.value),onKeyDown:L,typeName:"password"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"bedrock-sigv4-region-input",children:"Region"}),(0,t.jsx)(g.Input,{id:"bedrock-sigv4-region-input",placeholder:"us-east-1",value:S.sigv4Region,error:s("sigv4Region"),onChange:e=>_("sigv4Region",e.target.value),onKeyDown:L})]})]}),"apikey"===S.authMethod&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"bedrock-api-key-input",children:"API Key"}),(0,t.jsx)(g.Input,{id:"bedrock-api-key-input",autoFocus:"apiKey"===R(),placeholder:"my-bedrock-api-key",value:S.apiKey,error:s("apiKey"),onChange:e=>_("apiKey",e.target.value),onKeyDown:L,typeName:"password"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"bedrock-apikey-region-input",children:"Region"}),(0,t.jsx)(g.Input,{id:"bedrock-apikey-region-input",placeholder:"us-east-1",value:S.apikeyRegion,error:s("apikeyRegion"),onChange:e=>_("apikeyRegion",e.target.value),onKeyDown:L})]})]})]});case"azure":if("azure"!==i.providerSlug)return(0,t.jsx)("div",{children:"Invalid credentials"});return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"azure-api-key-input",children:"API Key"}),(0,t.jsx)(g.Input,{id:"azure-api-key-input",autoFocus:"apiKey"===R(),placeholder:"my-azure-api-key",value:S.apiKey,error:s("apiKey"),onChange:e=>_("apiKey",e.target.value),onKeyDown:L,typeName:"password"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"azure-resource-name-input",children:"Resource Name"}),(0,t.jsx)(g.Input,{id:"azure-resource-name-input",placeholder:"my-azure-resource",value:S.resourceName,error:s("resourceName"),onChange:e=>_("resourceName",e.target.value),onKeyDown:L})]})]});default:if(["vertex","bedrock","azure"].includes(i.providerSlug))return(0,t.jsx)("div",{children:"Invalid credentials"});return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{className:"text-[14px] leading-[20px] font-medium",htmlFor:"default-api-key-input",children:`${i.name} API Key`}),(0,t.jsx)(g.Input,{id:"default-api-key-input",autoFocus:"apiKey"===R(),placeholder:"anthropic"===i.providerSlug?"sk-ant-abcdefg…":"sk-abcdefg…",value:S.apiKey,error:s("apiKey"),onChange:e=>_("apiKey",e.target.value),onKeyDown:L,typeName:"password"})]})}})(),(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Your API key will handle all ",i.name," requests. If rate limits or errors occur, requests automatically fall back to system credentials. We'll test your key before saving it."]})}),"failed"===c&&A&&(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsxs)(m.Error,{children:[i.name," Test Request Failed"]}),(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial px-4 py-3 bg-red-100 border border-red-300 rounded-md",children:[(0,t.jsxs)("p",{className:"text-copy-14-mono text-red-900",children:["HTTP ",A.httpResponseCode," ",A.title]}),(0,t.jsx)("p",{className:"text-copy-14-mono text-red-900",children:A.message})]})})]})]})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{disabled:"creating"===l,onClick:()=>r(!1),type:"secondary",children:"Cancel"}),(0,t.jsx)(p.Modal.Action,{loading:"testing"===c,onClick:B,children:"testing"===c?"Testing API Key…":"Test API Key"})]})]})})]}):(0,t.jsx)("p",{className:"text-copy-13 text-gray-800",children:"You need additional permissions to add API keys."})}A.z.union([K,E,S,T]);var z=e.i(6936038);function D(e){let{integrationName:i,credential:a,isActive:s,setIsActive:r}=e,{ownerId:l,credentialId:n}=a,[o,d]=(0,h.useState)("idle"),{team:c}=(0,v.useTeam)(),{mutate:u}=(0,f.useSWRConfig)(),g=(0,y.useToasts)(),x=(0,w.canMutateKeys)(c);async function m(){if(c&&x)try{await fetch(`/api/ai-gateway-proxy/byok-credentials?ownerId=${l}&credentialId=${n}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),await u(`/api/ai-gateway-proxy/byok-credentials/list?ownerId=${c.id}`),r(!1),d("idle")}catch(e){k.analytics.track(I.AnalyticsEvent.AI_GATEWAY_BYOK_CREDENTIAL_DELETION_ERROR,{message:(0,b.isError)(e)?e.message:"Unknown error",teamId:c.id,errorCode:(0,C.isAPIError)(e)?e.code:void 0,credentialId:a.credentialId}),(0,z.showApiErrorToast)({error:e,toasts:g,fallbackMessage:"Failed to delete credential. Please try again."}),d("idle")}}let A=async()=>{"in_progress"!==o&&(d("in_progress"),await m())};return(0,j.useHotkey)(()=>{s&&"in_progress"!==o&&r(!1)},"Escape"),(0,j.useHotkey)(()=>{s&&"in_progress"!==o&&x&&A()},"Enter"),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(p.Modal.Modal,{active:s,onClickOutside:()=>{r(!1)},children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{children:`Delete ${i} API Key`})}),x?(0,t.jsx)("p",{className:"text-copy-16",children:`Are you sure you want to delete this key? All AI Gateway requests to ${i} will now go back to their default behavior.`}):(0,t.jsx)("p",{className:"text-copy-16 text-gray-800",children:"You need additional permissions to delete BYOK credentials."})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{onClick:()=>{r(!1)},type:"secondary",children:x?"Cancel":"Close"}),x?(0,t.jsx)(p.Modal.Action,{loading:"in_progress"===o,type:"error",onClick:A,children:"Delete API Key"}):null]})]})})}var P=e.i(1906681);function _(e){let{integration:i,credential:a,isActive:r,setIsActive:l}=e,{ownerId:n,credentialId:o}=a,[d,c]=(0,h.useState)("idle"),[u,g]=(0,h.useState)(a.active),x=()=>{g(a.active),c("idle"),l(!1)},m=(0,h.useId)(),{team:A}=(0,v.useTeam)(),{mutate:N}=(0,f.useSWRConfig)(),K=(0,y.useToasts)(),E=(0,w.canMutateKeys)(A);async function S(){if(A&&E)try{await fetch(`/api/ai-gateway-proxy/byok-credentials?ownerId=${n}&credentialId=${o}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:u})}),await N(`/api/ai-gateway-proxy/byok-credentials/list?ownerId=${A.id}`),c("idle"),l(!1)}catch(e){k.analytics.track(I.AnalyticsEvent.AI_GATEWAY_BYOK_CREDENTIAL_UPDATE_ERROR,{message:(0,b.isError)(e)?e.message:"Unknown error",teamId:A.id,errorCode:(0,C.isAPIError)(e)?e.code:void 0,credentialId:a.credentialId}),(0,z.showApiErrorToast)({error:e,toasts:K,fallbackMessage:"Couldn't update your API key. Try again in a moment."}),c("idle")}}let T=async()=>{"in_progress"!==d&&(c("in_progress"),await S())};return(0,j.useHotkey)(()=>{r&&"in_progress"!==d&&x()},"Escape"),(0,j.useHotkey)(()=>{r&&"in_progress"!==d&&E&&T()},"Enter"),(0,t.jsxs)(p.Modal.Modal,{active:r,onClickOutside:x,children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{children:`Edit ${i.name} API Key`})}),E?(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-1000 leading-normal",children:"When disabled, requests use system credentials instead."}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,t.jsxs)("p",{className:"text-copy-14 flex items-center gap-3",children:[(0,t.jsx)(P.Toggle,{id:m,name:m,size:"large",checked:u,onChange:()=>{g(e=>!e)}}),u?"Enabled":"Disabled"]})}),(0,t.jsxs)("div",{className:"pt-3 flex items-baseline gap-1",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Need to delete the API key?"}),(0,t.jsx)(s.Button,{onClick:e.openDeleteModal,className:"!h-fit !px-0 *:px-1 rounded-sm flex items-center",type:"tertiary",children:"Delete it"})]})]})}):(0,t.jsx)("p",{className:"text-copy-16 text-gray-800",children:"You need additional permissions to edit API keys."})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{onClick:x,type:"secondary",children:E?"Cancel":"Close"}),E?(0,t.jsx)(p.Modal.Action,{loading:"in_progress"===d,onClick:T,children:"Save"}):null]})]})}var $=e.i(5838627),O=e.i(3306538),F=e.i(5761705),B=e.i(6226725);function L(e){let{isActive:i,onClose:a,responseData:s,providerName:r,status:l}=e,n=(0,h.useCallback)(()=>{a()},[a]);(0,j.useHotkey)(()=>{i&&n()},"Escape");let o=(0,h.useCallback)(()=>{let e=JSON.stringify(s,null,2).split("\n"),t=[];return e.forEach((i,a)=>{let s=a+1;(i.includes('"credentialType": "byok"')||i.includes('"success":')&&e[a-1]?.includes('"credentialType": "byok"'))&&t.push(s),"failed"===l&&e.slice(Math.max(0,a-10),a+5).some(e=>e.includes('"credentialType": "byok"'))&&i.includes('"error":')&&t.push(s)}),t},[s,l]);(0,h.useEffect)(()=>{i&&o().length>0&&setTimeout(()=>{let e=document.querySelector('[data-highlighted="true"]');e&&e.scrollIntoView({behavior:"smooth",block:"center"})},200)},[i,o]);let d=(0,h.useCallback)(()=>{let e=s?.details?.model||`${r.toLowerCase()}/default-model`,t=s?.details?.provider||r.toLowerCase();return s?.details?.type==="image"?`import { createGateway } from '@ai-sdk/gateway';
import { experimental_generateImage as generateImage } from 'ai';

const gateway = createGateway({
  apiKey: 'your-api-key-here', // Replace with your API key
});

// Make request with BYOK credentials
const result = await generateImage({
  model: gateway.imageModel('${e}'),
  prompt: 'A red balloon on a wooden table.',
  providerOptions: {
    gateway: {
      only: ['${t}'], // Force routing to ${r}
    },
  },
});

console.log('Generated', result.images.length, 'image(s)');`:`import { createGateway } from '@ai-sdk/gateway';
import { generateText } from 'ai';

const gateway = createGateway({
  apiKey: 'your-api-key-here', // Replace with your API key
});

// Make request with BYOK credentials
const result = await generateText({
  model: gateway('${e}'),
  prompt: 'test',
  maxOutputTokens: 20,
  temperature: 0,
  providerOptions: {
    gateway: {
      only: ['${t}'], // Force routing to ${r}
    },
  },
});

console.log(result.text);`},[s,r]),c="success"===l?F.CheckCircle:B.CrossCircle;return(0,t.jsxs)(p.Modal.Modal,{active:i,onClickOutside:n,children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{children:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[`${r} Test Request`,(0,t.jsxs)(O.Badge,{variant:"success"===l?"green-subtle":"red-subtle",className:"pl-1.5",children:[(0,t.jsx)(c,{size:12}),"success"===l?"Success":"Failed"]})]})})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Response"}),(0,t.jsx)($.CodeBlock,{language:"json",highlightedLinesNumbers:o(),className:"[&>pre]:max-h-[300px] [&>pre]:overflow-auto my-0",hideLineNumbers:!0,children:JSON.stringify(s,null,2)})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"AI Gateway Request"}),(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:[r," credentials tested with"]})]}),(0,t.jsx)($.CodeBlock,{language:"typescript",className:"[&>pre]:max-h-[300px] [&>pre]:overflow-auto my-0",hideLineNumbers:!0,children:d()})]})]})]}),(0,t.jsx)(p.Modal.Actions,{children:(0,t.jsx)(p.Modal.Action,{onClick:n,fullWidth:!0,children:"Close"})})]})}var q=e.i(5169576),Y=e.i(8735244),G=e.i(9722978);function W(e){let{status:i,isTestingKey:a,onClick:s}=e,r=(()=>{switch(i){case"success":return{icon:q.Information,badgeVariant:"green-subtle"};case"failed":return{icon:q.Information,badgeVariant:"red-subtle"};default:return{icon:q.Information,badgeVariant:"gray-subtle"}}})(),l=r.icon,n=s&&!a;return(0,t.jsxs)(O.Badge,{as:"button",className:(0,G.clsx)(n&&"cursor-pointer hover:opacity-80","pl-1"),size:"sm",onClick:n?s:void 0,variant:r.badgeVariant,children:[a||"pending"===i?(0,t.jsx)("div",{className:"size-3 mr-1",children:(0,t.jsx)(Y.Spinner,{size:12})}):(0,t.jsx)(l,{size:12}),a?"Testing…":"never"===i?"Never Tested":"success"===i?"Test Successful":"failed"===i?"Test Failed":`Test ${i}`]})}var H=e.i(923772),V=e.i(3496900),U=e.i(1077431),J=e.i(8876434),Z=e.i(5756088),Q=e.i(1581435),X=e.i(665316);function ee(e){let{integration:p,credential:g,isLoading:y}=e,[x,m]=(0,h.useState)(!1),[f,j]=(0,h.useState)(!1),[C,b]=(0,h.useState)(!1),[A,N]=(0,h.useState)("idle"),[K,E]=(0,h.useState)(null),[S,T]=(0,h.useState)(!1),{team:M}=(0,v.useTeam)(),z=(0,w.canMutateKeys)(M),P=(0,h.useRef)(g?.credentialId);(0,h.useEffect)(()=>{P.current!==g?.credentialId&&(P.current=g?.credentialId,"idle"===A||C||(N("idle"),E(null)))},[g?.credentialId,A,C]);let $=async()=>{if(g&&M&&!C){b(!0),N("testing"),E(null);try{let e,t=await fetch(`/api/ai-gateway-proxy/byok-credentials/test?teamId=${M.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credentialId:g.credentialId,providerSlug:p.providerSlug})}),i=await t.json();E(i);let a=i.success,s=i.steps?.[0]?.providerMetadata?.gateway?.routing?.attempts?.some(e=>e.provider===p.providerSlug&&"byok"===e.credentialType&&!0===e.success)??!1;a&&s?(N("success"),e="success"):(N("failed"),e="failed"),k.analytics.track(I.AnalyticsEvent.AI_GATEWAY_BYOK_CREDENTIAL_TEST_COMPLETED,{teamId:M.id,providerSlug:p.providerSlug,credentialId:g.credentialId,testResult:e})}catch(e){E({success:!1,message:"Network error during test",details:{error:e instanceof Error?e.message:"Unknown network error",provider:p.providerSlug,model:`${p.providerSlug}/default-model`}}),N("failed"),k.analytics.track(I.AnalyticsEvent.AI_GATEWAY_BYOK_CREDENTIAL_TEST_COMPLETED,{teamId:M.id,providerSlug:p.providerSlug,credentialId:g.credentialId,testResult:"failed"})}finally{b(!1)}}};return(0,t.jsx)(i.Entity,{left:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:[(0,t.jsx)(X.ModelLogo,{name:p.providerSlug}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-1000",children:p.name}),(()=>{let e;if("idle"===A)return null;switch(A){case"testing":e="pending";break;case"success":e="success";break;case"failed":e="failed";break;default:e="never"}return(0,t.jsx)(W,{status:e,isTestingKey:C,onClick:"testing"!==A&&K?()=>{k.analytics.track(I.AnalyticsEvent.AI_GATEWAY_BYOK_CREDENTIAL_TEST_BADGE_CLICKED,{teamId:M?.id,providerSlug:p.providerSlug,credentialId:g?.credentialId,testResult:"success"===A?"success":"failed"}),T(!0)}:void 0})})()]})]}),right:(0,t.jsxs)(t.Fragment,{children:[y||g||!z?null:(0,t.jsx)(R,{integration:p}),y||g||z?null:(0,t.jsx)(u.Tooltip,{text:"You need additional permissions to add integrations",children:(0,t.jsx)(s.Button,{type:"secondary",size:"small",disabled:!0,children:"Add"})}),y?(0,t.jsx)(a.Skeleton,{children:(0,t.jsx)(s.Button,{size:"small",children:"Add"})}):null,!y&&g?(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(n.RelativeTimeCard,{date:new Date(g.createdAt).getTime(),side:"top",children:(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:`Updated ${(0,Q.formatDistanceToNow)(new Date(g.updatedAt))} ago`})}),(0,t.jsx)(r.Avatar,{teamId:g.ownerId,size:20}),(0,t.jsxs)(l.MenuContainer,{children:[(0,t.jsx)(c.MenuButton,{"aria-label":"More options",type:"tertiary",shape:"square",size:"small",svgOnly:!0,children:(0,t.jsx)(J.MoreHorizontal,{})}),(0,t.jsxs)(d.Menu,{width:220,children:[(0,t.jsx)(o.MenuItem,{prefix:(0,t.jsx)(V.PencilEdit,{}),suffix:z?void 0:(0,t.jsx)(Z.LockClosed,{}),onClick:()=>{m(!0)},disabled:!z,children:"Edit Key"}),(0,t.jsx)(o.MenuItem,{prefix:(0,t.jsx)(U.BeakerFlask,{}),suffix:z?void 0:(0,t.jsx)(Z.LockClosed,{}),onClick:()=>{$()},disabled:!z||C,children:C?"Testing…":"Test Key"}),(0,t.jsx)(o.MenuItem,{prefix:(0,t.jsx)(H.Trash,{}),suffix:z?void 0:(0,t.jsx)(Z.LockClosed,{}),onClick:()=>{j(!0)},type:"error",disabled:!z,children:"Delete"})]})]}),z?(0,t.jsx)(_,{integration:p,credential:g,isActive:x,setIsActive:m,openDeleteModal:()=>{j(!0),m(!1)}}):null,z?(0,t.jsx)(D,{integrationName:p.name,credential:g,isActive:f,setIsActive:j}):null,K?(0,t.jsx)(L,{isActive:S,onClose:()=>T(!1),responseData:K,providerName:p.name,status:"success"===A?"success":"failed"}):null]}):null]})})}function et(){return(0,t.jsx)(i.Entity,{left:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:[(0,t.jsx)("div",{className:"size-8 shrink-0 rounded-full bg-gray-200"}),(0,t.jsx)(a.Skeleton,{height:16,width:100})]}),right:(0,t.jsx)(a.Skeleton,{children:(0,t.jsx)(s.Button,{size:"small",children:"Add"})})})}e.s(["IntegrationItem",()=>ee,"IntegrationItemSkeleton",()=>et],2342653)}]);

//# debugId=e712bda7-c1b3-5cab-8eea-7eca9145797f
//# sourceMappingURL=74f1df533487682e.js.map