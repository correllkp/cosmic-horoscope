;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="6f9bd975-d11d-7ac3-df7a-94e4cc55b09e")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7966665,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});let i=e.r(2795167);function a(e){return/^[a-f0-9]{40}$/i.test(e)}l.default=function(e,t){let l,s;if("string"!=typeof e||!e.length)return null;if(e.startsWith("git@"))switch(!0){case e.startsWith("git@github.com:"):l="github",s=e.replace("git@github.com:","");break;case t&&e.startsWith(`git@${t}:`):l="ghes",s=e.replace(`git@${t}:`,"");break;case e.startsWith("git@gitlab.com:"):l="gitlab",s=e.replace("git@gitlab.com:","");break;case e.startsWith("git@bitbucket.org:"):l="bitbucket",s=e.replace("git@bitbucket.org:","");break;default:return null}else{let a=i.parse(e);if(!a.pathname)return null;switch(a.hostname){case"github.com":case"www.github.com":l="github";break;case t:l="ghes";break;case"gitlab.com":case"www.gitlab.com":l="gitlab";break;case"bitbucket.org":case"www.bitbucket.org":l="bitbucket";break;default:return null}s=a.pathname.replace(/(^\/|\/$)/g,"")}let n=(s=s.replace(/\.git$/,"")).split("/").filter(Boolean);if(n.length<2)return null;if(2===n.length)return{type:l,owner:n[0],name:n[1],branch:"",sha:"",subdir:""};let r="",o="",c="",d=n[0],u=n[1];if("github"===l)if("blob"!==n[2]&&"tree"!==n[2]&&"commit"!==n[2])return null;else a(n[3])?o=n[3]:r=n[3],c=n.slice(4).join("/");else if("ghes"===l)if("blob"!==n[2]&&"tree"!==n[2]&&"commit"!==n[2])return null;else a(n[3])?o=n[3]:r=n[3],c=n.slice(4).join("/");else if("gitlab"===l)if("-"===n[2])("blob"===n[3]||"tree"===n[3]||"commit"===n[3])&&(a(n[4])?o=n[4]:r=n[4],c=n.slice(5).join("/"));else{let e=n.indexOf("-");-1===e?u=n.slice(1).join("/"):(u=n.slice(1,e).join("/"),("blob"===n[e+1]||"tree"===n[e+1]||"commit"===n[e+1])&&(a(n[e+2])?o=n[e+2]:r=n[e+2],c=n.slice(e+3).join("/")))}else if("bitbucket"===l)if("src"!==n[2]&&"commits"!==n[2])return null;else a(n[3])?o=n[3]:r=n[3],c=n.slice(4).join("/");return{type:l,owner:d,name:u,branch:r,sha:o,subdir:c}}},3023251,e=>{"use strict";var t=e.i(7966665);function l(e){if(!e||"error"in e)return null;switch(e.type){case"github-limited":case"github":return{org:e.org||"",repo:e.repo};case"gitlab":if("projectUrl"in e){let l=(0,t.default)(e.projectUrl);if(l)return{org:l.owner,repo:l.name}}break;case"bitbucket":if("slug"in e)return{org:e.owner,repo:e.slug}}return null}function i(e){let{includeOrg:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=l(e);return i?t?`${i.org}/${i.repo}`:i.repo:""}e.s(["getOrgAndRepoFromLink",()=>l,"getRepoFromLink",()=>i])},913614,e=>{"use strict";var t=e.i(7966665);function l(e){let{type:l,org:i,repo:a,projectUrl:s,owner:n,slug:r,host:o}=e;switch(l){case"github-limited":case"github":return`https://github.com/${i}/${a}`;case"gitlab":{let e=(0,t.default)(s||"");return`https://gitlab.com/${e?.owner}/${e?.name}`}case"bitbucket":return`https://bitbucket.org/${n}/${r}`;case"github-custom-host":if(!o)throw Error("Custom host is required for github-custom-host");return`https://${o}/${i}/${a}`;default:return""}}e.s(["getGitRepoUrlFromLink",()=>l])},492520,9172735,e=>{"use strict";var t=e.i(7909933),l=e.i(5802506);function i(e){let{data:i,isLoading:a}=(0,t.default)(e?"/api/feature-flags/deployment-outage-banner":null,e=>fetch(e).then(e=>e.json()),{async onError(e){await (0,l.captureError)(e)}}),s="github-limited"===e?"github":e,n=s?i?.providers?.[s]:void 0;return s&&n?.enabled?{data:{link:n.learnMoreLink||"https://www.vercel-status.com",customMessage:n.customMessage||void 0,isVercelOnly:i?.showToVercelianOnly??!1},isLoading:a}:{data:null,isLoading:a}}function a(e){let i=e.length>0,{data:a,isLoading:s}=(0,t.default)(i?"/api/feature-flags/deployment-outage-banner":null,e=>fetch(e).then(e=>e.json()),{async onError(e){await (0,l.captureError)(e)}}),n=a?.providers?.marketplace;if(n?.enabled&&n.affectedSlugs?.length){let t=new Set(n.affectedSlugs);if(e.some(e=>t.has(e)))return{data:{link:n.learnMoreLink||void 0,customMessage:n.customMessage||void 0,showRedeployCta:n.showRedeployCta,isVercelOnly:a?.showToVercelianOnly??!1},isLoading:s}}return{data:null,isLoading:s}}e.s(["useDeploymentOutageBanner",()=>i,"useMarketplaceOutageBanner",()=>a],492520);var s=e.i(8711407),n=e.i(762945),r=e.i(57106),o=e.i(1335111);function c(e){let{actionOnClick:t,gitType:l,link:i,customMessage:a,hideAction:c=!1,isVercelOnly:d=!1}=e;if(!l&&!a)return null;let u=l?function(e){switch(e){case"github":return"GitHub";case"gitlab":return"GitLab";case"bitbucket":return"Bitbucket";default:return""}}(l):"",m=u?`Automatic deployments from ${u} are temporarily unavailable. You can manually create a new deployment.`:"",h=a||m,p=d?`[Vercel-only] ${h}`:h,x=(0,s.jsxs)(s.Fragment,{children:[p,i?(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)(r.Link,{external:!0,href:i,children:"Learn more"})]}):null]});return(0,s.jsx)(o.CompatBanner,{callToAction:!c&&t?{label:"Create Deployment",onClick:t}:void 0,icon:(0,s.jsx)(n.Warning,{className:"shrink-0"}),label:x,variant:"warning",sticky:!1})}e.s(["OutageBanner",()=>c],9172735)},9204765,4095738,e=>{"use strict";var t=e.i(8711407),l=e.i(1987325),i=e.i(1176592),a=e.i(2504781),s=e.i(2064047),n=e.i(6891161),r=e.i(8522580),o=e.i(7087273),c=e.i(9318197),d=e.i(455575),u=e.i(57106),m=e.i(7749291),h=e.i(4345845),p=e.i(7218483),x=e.i(5614970),f=e.i(913614),y=e.i(3023251),g=e.i(7401972),j=e.i(5598924),b=e.i(5761705),v=e.i(5479400),k=e.i(6401841),w=e.i(3306538),S=e.i(3500331),N=e.i(5255926),C=e.i(8735244);function D(e){let{loading:l,onChange:a,onPaste:s,size:n,state:r,...o}=e;return(0,t.jsx)(S.Input,{...o,id:(0,i.useId)(),onChange:a,onPaste:s,size:n,suffix:(0,t.jsx)(R,{loading:l,size:"small"===n?16:void 0,state:r}),suffixStyling:!1})}function R(e){let{loading:l,state:i,size:a}=e;return l?(0,t.jsx)(C.Spinner,{size:a}):"success"===i?(0,t.jsx)(b.CheckCircle,{color:"blue-700",size:a}):"error"===i?(0,t.jsx)(k.Stop,{color:"red-900",size:a}):null}function A(e){let{branchName:l,commitMessage:i,commitSha:a,createdAt:s=Date.now(),isProductionDeployment:n,loading:r}=e,o=(0,p.useAgo)(s,{long:!0,justNowLabel:"just now"}),c=r||"string"==typeof l,d=a?.substring(0,7);return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-0.5 flex-1 translate-y-[3px] rounded-[10px] border border-solid border-[var(--accents-2)] px-3 py-[7px]",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-1",children:[(0,t.jsx)(h.GitBranch,{color:"gray-900",style:{flexShrink:0}}),(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-1 flex-1",children:r?(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-1 pt-1 pb-1",children:(0,t.jsx)(N.Skeleton,{height:16,width:150})}):(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-1",children:[c?(0,t.jsxs)("div",{className:"text-copy-14-mono truncate",style:{maxWidth:370},children:[l," "]}):(0,t.jsx)("div",{className:"min-w-[180px] max-w-[250px]",children:l}),!0===n&&(0,t.jsx)(w.Badge,{size:"md",variant:"blue-subtle",children:"Production"}),!1===n&&(0,t.jsx)(w.Badge,{size:"md",variant:"gray-subtle",children:"Preview"})]})})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-1",children:[(0,t.jsx)("div",{className:"flex flex-col items-center justify-start flex-initial",children:(0,t.jsx)(v.GitCommit,{color:"gray-900",size:16,style:{flexShrink:0}})}),r?(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-1 pt-1 pb-1",children:[(0,t.jsx)(N.Skeleton,{height:16,width:95}),(0,t.jsx)(N.Skeleton,{height:16,width:"56%"})]}):(0,t.jsxs)("div",{className:"text-copy-14 truncate",children:[(0,t.jsx)("span",{className:"text-copy-14-mono",children:d}),` ${i??""} `,(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:o})]})]})]})}function I(e){return(0,t.jsx)(r.Note,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsxs)("div",{children:["This commit has already been built—",(0,t.jsx)(u.Link,{external:!0,href:e.deploymentId.replace(/dpl_/,""),tab:!0,type:"primary",children:"view here"})]}),e.isProductionDeployment?(0,t.jsx)("div",{children:"It is the current production deployment"}):null]})})}function P(e){let{branchName:l,isProductionDeployment:i}=e;return(0,t.jsx)(r.Note,{fill:!0,type:"warning",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"This commit exists on multiple branches"}),(0,t.jsxs)("p",{className:"text-copy-14 text-inherit",children:["Please verify this deployment should be built from"," ",(0,t.jsx)("span",{className:"text-copy-14-mono text-inherit",children:l}),i?" with Production configuration.":"."]})]})})}function M(e){let{children:l,id:i}=e;return l?(0,t.jsx)(r.Note,{fill:!0,id:i,style:{alignSelf:"start"},type:"error",children:l}):null}var T=e.i(7909933),E=e.i(7966665),$=e.i(277234);let B=RegExp(/[0-9a-f]{7,40}/,"i");function L(e,t){return e.toLowerCase()===t.toLowerCase()}function O(e){let{projectId:t,branchName:l,sha:i,teamId:a}=e,s=new URLSearchParams;l&&s.set("branchName",l),a&&s.set("teamId",a),i&&s.set("sha",i);let n=`/v1/integrations/git-commit-details/${t}?${s.toString()}`;return(0,$.fetchAPI)(n,{throwOnHTTPError:!0})}async function F(e,t,l,i,a,s,n){let r=function(e,t,l,i){let a=e.startsWith("http")?e:`https://${e}`,s=(0,E.default)(a);if(s){if(s.type!==t||!L(s.owner,l)||!L(s.name,i))return{type:"error",message:"The provided link points to a different repository than what is connected to the Vercel project."};if(!s.sha&&!s.branch)return{type:"production"};if(s.branch)return{type:"branch",ref:s.branch};if(s.sha)return{type:"sha",sha:s.sha}}return B.exec(e)?{type:"sha",sha:e}:{type:"branch",ref:e}}(e,a,t,l);switch(r.type){case"production":{if(!s)throw Error("There is no production branch defined for this project");let e=await O({projectId:i,branchName:s,teamId:n});return{branch:s,commitDate:new Date(e.commitDate).getTime(),commitMessage:e.commitMessage,sha:e.commitSha,requestedBy:r.type,recentDeploymentId:e.recentDeploymentId}}case"branch":{let e=await O({projectId:i,branchName:r.ref,teamId:n});return{branch:r.ref,commitDate:new Date(e.commitDate).getTime(),commitMessage:e.commitMessage,sha:e.commitSha,requestedBy:r.type,recentDeploymentId:e.recentDeploymentId}}case"sha":{let e=await O({projectId:i,sha:r.sha,teamId:n}),t=[...new Set(e.branches)].sort(e=>+(e===s));return{branch:t[0],commitDate:new Date(e.commitDate).getTime(),commitMessage:e.commitMessage,multiBranches:t.length>1?t:void 0,sha:e.commitSha,requestedBy:r.type,recentDeploymentId:e.recentDeploymentId}}case"error":throw Error(r.message)}}var _=e.i(4005781),z=e.i(4244280);function W(e){return(!e||"PENDING"!==e.state&&("RUNNING"!==e.state||void 0!==e.deploymentId||void 0!==e.url))&&!0}function H(e,t){let l=(0,f.getGitRepoUrlFromLink)(e);return t&&"github"===e.type?`${l}/tree/${t}`:t&&"gitlab"===e.type?`${l}/-/tree/${t}`:t&&"bitbucket"===e.type?`${l}/src/${t}`:l}function U(e){let{active:l,onCancel:i,projectId:a,projectLink:s,teamId:r}=e;if(!s)return null;let o=(0,y.getOrgAndRepoFromLink)(s);return o?(0,t.jsx)(n.Modal.Modal,{active:l,onClickOutside:i,children:(0,t.jsx)(q,{linkedOrg:o.org,linkedRepo:o.repo,onCancel:i,projectId:a,projectLink:s,teamId:r})}):null}function q(e){let a,{linkedOrg:s,linkedRepo:u,onCancel:m,projectId:h,projectLink:p,teamId:x}=e,f=(0,i.useId)(),b=(0,i.useId)(),[v,k]=(0,i.useState)(""),[w,S]=(0,i.useState)(""),[N,C]=(0,i.useState)(""),[R,E]=(0,i.useState)(!1),B=(0,d.useToasts)(),L=p.updatedAt||0,{isValidating:O,error:U,data:q}=function(e,t){let{linkedOrg:l,linkedRepo:i,productionBranch:a,projectId:s,projectType:n,teamId:r}=t;return(0,T.default)(""===e?null:[e,l,i,s,n,a,r],e=>F(...e),{throwOnError:!1,shouldRetryOnError:!1,revalidateOnFocus:!1})}(v,{linkedOrg:s,linkedRepo:u,productionBranch:p.productionBranch,projectId:h,projectType:p.type,teamId:x}),[,{branches:Y=[]}]=(0,g.useProjectDeployedBranches)({includeProductionBranch:!1,project:{id:h},limit:5,query:""!==w?w:void 0,active:!0}),{error:K,createDeployment:X,isLoading:J,reset:Q}=function(e){var t,l,i;let a,{onSuccess:s,projectId:n,teamId:r}=e,{data:o,isMutating:c,trigger:d,error:u,reset:m}=(t={throwOnError:!1},(0,_.default)(z.API_GIT_TRIGGER,(e,t)=>{let{arg:l}=t;if(!n)throw Error("No projectId passed");let{branch:i,sha:a}=l,s=r?`?${new URLSearchParams({teamId:r}).toString()}`:"",o=`${e}/${n}/sha/${encodeURIComponent(i)}/${a}${s}`;return(0,$.fetchAPI)(o,{method:"POST",body:{},throwOnHTTPError:!0})},t)),{data:h,error:p,isLoading:x}=(l=o?.job,i={onSuccess(e){W(e)&&"ERRORED"!==e.state&&s?.()},refreshInterval:3e3},(0,T.default)(l?`/v1/integrations/job/${l}`:null,e=>(0,$.fetchAPI)(e),i)),f=x||!W(h);return u&&(a=Error(u.message)),p&&(a=Error(p.message)),h?.state==="ERRORED"&&(a=Error(h.error??"Could not create a deployment for this reference.")),{error:a,createDeployment:e=>{m(),d(e)},isLoading:c||f,reset:m}}({onSuccess(){B.success("Deployment created successfully."),m()},projectId:h,teamId:x}),Z=(0,i.useMemo)(()=>(0,l.default)(e=>{k(e),S(e),Q()},500,{leading:!1,trailing:!0}),[k,Q,S]);(0,i.useEffect)(()=>{E(O)},[O]),(0,i.useEffect)(()=>{q?.branch&&C(q.branch)},[q?.branch]);let ee="initial";!R&&q&&(ee="success"),(U||K)&&(ee="error",a=U?.message||K?.message);let et=!R&&"error"===ee,el=N===p.productionBranch;return(0,t.jsxs)("form",{children:[(0,t.jsxs)(n.Modal.Body,{children:[(0,t.jsx)(n.Modal.Header,{children:(0,t.jsx)(n.Modal.Title,{children:"Create Deployment"})}),(0,t.jsx)(G,{connectedAt:L,projectLink:p}),(0,t.jsx)(c.Spacer,{}),(0,t.jsxs)("div",{"aria-labelledby":f,role:"group",children:[(0,t.jsxs)("p",{className:"text-copy-14",id:f,children:["Paste a valid commit reference to create a new deployment in addition to those auto-generated from"," ",(0,t.jsx)("span",{className:"text-copy-14-mono",children:(0,y.getRepoFromLink)(p,{includeOrg:!0})}),"."]}),(0,t.jsx)(c.Spacer,{}),(0,t.jsx)(D,{"aria-errormessage":et?b:void 0,autoCapitalize:"none",bypassCasing:!0,disabled:J,error:et?"yes":null,label:"Commit or Branch Reference",loading:R,onChange:e=>{let{value:t}=e.target,l=t.trim();if(""===l){C(""),E(!1),k(l),S(l);return}v!==l&&(C(""),E(!0),Z(l),S(l))},onPaste:e=>{Z.cancel();let t=e.clipboardData.getData("text");t&&v===t||(C(""),E(!0),Q())},placeholder:H(p),showErrorMessage:!1,size:"small",state:ee,value:w}),(0,t.jsx)(c.Spacer,{y:.5}),"success"===ee||R||0!==w.length?null:(0,t.jsx)(o.Scroller,{height:0===Y.length?"0px":"66px",overflow:"x",scrollerClassName:"mx-[-4px] px-[1px]",width:"100%",children:(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial p-1",children:[p.productionBranch||"main",...Y.filter(e=>e!==p.productionBranch)].map(e=>(0,t.jsx)(V,{label:e,onClick:()=>{k(e),S(H(p,e))}},e))})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[q?.multiBranches&&q.multiBranches.length>0?(0,t.jsx)(P,{branchName:N,isProductionDeployment:el}):null,et?(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start flex-initial min-h-[66px] pt-2",children:(0,t.jsx)(M,{id:b,children:a})}):null,R||!q||"sha"!==q.requestedBy||q.branch?null:(0,t.jsx)(r.Note,{fill:!0,type:"secondary",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"Branch could not be determined."}),(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"Please select the branch you would like to deploy to."})]})}),R||"success"===ee?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A,{branchName:q?.requestedBy!=="sha"||q.branch?q?.branch:(0,t.jsx)(j.BranchSearchCombobox,{comboboxSize:"small",includeProductionBranch:!0,onSelect:e=>{null===e?C(""):C(e)},placeholder:"Select branch…",project:{id:h,link:p},skeletonStyle:{margin:"0.4rem 0",height:"2.0rem"},value:N}),commitMessage:q?.commitMessage,commitSha:q?.sha,createdAt:q?.commitDate,isProductionDeployment:N?el:void 0,loading:R}),q?.recentDeploymentId?(0,t.jsx)(I,{deploymentId:q.recentDeploymentId,isProductionDeployment:el}):null]}):null]})]})]}),(0,t.jsxs)(n.Modal.Actions,{children:[(0,t.jsx)(n.Modal.Action,{onClick:m,type:"secondary",children:"Cancel"}),(0,t.jsx)(n.Modal.Action,{disabled:!["success","error"].includes(ee)||!N||!q?.sha,loading:J,onClick:()=>{q?.sha&&X({sha:q.sha,branch:N||q.branch})},children:"Create Deployment"})]})]})}function G(e){let{connectedAt:l,projectLink:i}=e,a=(0,p.useAgo)(l,{justNowLabel:"just now"});return(0,t.jsx)(s.Entity,{left:(0,t.jsx)(x.default,{gitType:i.type,height:32,width:32}),padding:0,children:(0,t.jsx)(s.Entity.Content,{description:(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Connected ",a]}),title:(0,t.jsxs)(u.Link,{className:"inline-flex max-w-full items-center [&>svg]:min-w-4",href:(0,f.getGitRepoUrlFromLink)(i),tab:!0,variant:"primary",children:[(0,t.jsx)("span",{className:"geist-ellipsis",children:(0,y.getRepoFromLink)(i,{includeOrg:!0})}),(0,t.jsx)(c.Spacer,{inline:!0,x:.2}),(0,t.jsx)(m.ExternalSmall,{})]})})})}function V(e){let{label:l,onClick:i}=e;return(0,t.jsx)(a.Button,{onClick:i,prefix:(0,t.jsx)(h.GitBranch,{size:14,style:{transform:"translateX(2px)"}}),shape:"rounded",size:"small",type:"secondary",typeName:"button",children:(0,t.jsx)("span",{className:"text-copy-14-mono",children:l})})}e.s(["GitDeploymentTriggerModal",()=>U],4095738),e.s([],9204765)},5598924,5442212,e=>{"use strict";var t=e.i(8711407),l=e.i(9338892),i=e.i(1176592),a=e.i(5255926),s=e.i(6881349),n=e.i(119294),r=e.i(6352514),o=e.i(1991452),c=e.i(1875382),d=e.i(9031150),u=e.i(935882);let m=()=>{let e=(0,c.useSearchParams)();return{isReady:(0,o.useRouter)().isReady,filterBranch:e?.get("filterBranch")||void 0}};function h(){let{project:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=m(),[l,a]=(0,i.useState)(t.filterBranch||null);(0,i.useEffect)(()=>{a(t.filterBranch||null)},[t.isReady,t.filterBranch]);let s=(0,o.useRouter)(),n=(0,i.useCallback)(e=>{(0,d.awaitPaint)().then(()=>{a(e),function(e,t){let{teamSlug:l,project:i,slug:a,...s}=e.query;t?s.filterBranch=t:delete s.filterBranch,e.replace({pathname:window.location.pathname,query:s},void 0,{shallow:!0,scroll:!1})}(s,e)})},[s]),r=l?{ref:l}:void 0,c=(0,i.useCallback)(()=>{l&&(a(null),n(null))},[l,n]),h=!e||!t.isReady,p=null!==l,[x,f]=(0,i.useState)(p);return(0,u.default)(()=>{f(p)},[f,h,p]),{showBranchFilterBar:x,filteredBranch:l,setFilteredBranch:n,clearBranch:c,gitSource:r}}e.s(["useProjectFilteredBranch",()=>h,"useRouterFilteredBranch",0,m],5442212);var p=e.i(1947138),x=e.i(7401972);function f(e){let{skeletonStyle:l}=e;return(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)(g,{skeletonStyle:l}),children:(0,t.jsx)(y,{...e})})}let y=(0,i.memo)(e=>{let{loading:a,skeleton:o,onSelect:c,project:d,value:h,includeProductionBranch:f,placeholder:y,skeletonStyle:j,comboboxSize:b,clearable:v}=e,[k,w]=(0,i.useState)(!1),[S,N]=(0,i.useState)(!1),[C,D,{currentValue:R,setValueImmediate:A}]=(0,p.useDebounceState)(h||"",300);(0,i.useEffect)(()=>{h&&A(h)},[A,h]);let[,{branches:I,isValidating:P,fetchedQuery:M}]=(0,x.useProjectDeployedBranches)({project:d,includeProductionBranch:f,query:C},{revalidateOnFocus:!1,revalidateIfStale:!1,revalidateOnReconnect:!1}),T=(M||"")!==C,E=!!S&&!!k&&!!R&&T,{filterBranch:$}=m();(0,i.useEffect)(()=>{$&&A($)},[A,$]),(0,i.useEffect)(()=>{A(h||"")},[A,h]),(0,i.useEffect)(()=>{k||I&&!P&&w(!0)},[k,I,P]);let[B,L]=(0,i.useState)([]);(0,i.useEffect)(()=>{P||void 0===I||(0!==O.current.query.indexOf(R)&&(O.current={values:[],query:R}),L(I||[]))},[JSON.stringify(I),M]);let O=(0,i.useRef)({values:[],query:""}),F=P||R.length>=C.length&&R.length>=1?O.current.values:[],_=[...new Set([...F,...E?B:I||[]])],z=(0,i.useRef)(null);return((0,u.default)(()=>{R&&z.current?.setValue(R)},[R]),(0,u.default)(()=>{h||z.current?.clear()},[h]),o&&!k)?(0,t.jsx)(g,{skeletonStyle:j}):(0,t.jsxs)(s.Combobox,{clearable:v,filter:function(e,t){let i=""===t?e:(0,l.matchSorter)(e,t,{keys:["value","label"]}),a=[];for(let e of F)i.find(t=>t.value===e)&&a.push(e);let s=[...new Set([...a,...i.map(e=>e.value)])],n=s.map(e=>{let t=i.find(t=>t.value===e);if(!t)throw Error("impossible state");return t});return O.current={values:s,query:R},n},loading:E||a,onChange:e=>{e===$?setTimeout(()=>{c?.(null),z.current?.clear(),A("")}):(n.analytics.track(r.AnalyticsEvent.DEPLOYMENT_OVERVIEW_FILTERS_BRANCH,{value:e}),A(e||""),c?.(e))},onChangeOpen:e=>{N(e)},placeholder:y||"All Branches…",ref:z,size:b,children:[(0,t.jsx)(s.Combobox.Input,{loading:E||a,onChange:e=>{""===e.target.value?A(""):D(e.target.value)}}),(0,t.jsx)(s.Combobox.List,{children:_.map((e,l)=>(0,t.jsx)(s.Combobox.Option,{value:e,children:e},R?e:`${e}${l}`))})]})});function g(e){let{skeletonStyle:l}=e;return(0,t.jsx)(a.Skeleton,{style:l||{height:40},width:"100%"})}e.s(["BranchSearchCombobox",()=>f],5598924)},2645806,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),i=e.i(2111701),a=e.i(6891161),s=e.i(455575),n=e.i(277234),r=e.i(4244280),o=e.i(4470704);let c=l.default.memo(e=>{let{active:c,onClose:d,deployment:u,teamId:m}=e,[h,p]=(0,l.useState)(!1),x=(0,s.useToasts)(),f=(0,l.useCallback)(async()=>{if(!u)return;p(!0);let e=m?"?teamId="+m:"",t=await (0,n.fetchAPI)(`${(0,r.API_DEPLOYMENTS)("v12")}/${u.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&x.error(`Could not cancel the deployment, it's ${u.readyState}`),"CANCELED"===t.readyState&&(x.success("The deployment has been successfully canceled."),(0,i.mutate)((0,o.getUrl)(u.id),{...u,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:u.url,isPrivate:!u.public})),p(!1),d()},[u,m,x,d]);return(0,t.jsxs)(a.Modal.Modal,{active:c,onClickOutside:d,width:"500px",children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Header,{children:(0,t.jsx)(a.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)("p",{className:"text-copy-16",children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)("p",{className:"text-copy-16",style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{loading:!1,onClick:d,type:"secondary",children:"Close"}),(0,t.jsx)(a.Modal.Action,{disabled:h,loading:h,onClick:f,children:"Cancel deployment"})]})]})});e.s(["default",0,c])},5229375,e=>{"use strict";var t=e.i(1176592),l=e.i(7909933),i=e.i(3924999),a=e.i(818351),s=e.i(8042625),n=e.i(277234),r=e.i(4244280),o=e.i(5338940);function c(e,t){let{deploymentId:l,teamId:i}=e;return(0,a.useIsomorphicSWR)(l?function(e){let{deploymentId:t,teamId:l}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,s.encode)({teamId:l})}`}({deploymentId:l,teamId:i}):null,t)}function d(e,t){return(0,l.default)(()=>{if(!e)return null;let{team:t,id:l,teamId:i}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${l}/aliases${(0,s.encode)({teamId:i??(t?t.id:null)})}`},e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,l){let{limit:a=20,domains:s,rollbackDeploymentId:c}=e,{isReady:d,team:u}=(0,o.useTeam)(),h=(0,i.default)((e,t)=>{if(!d)return null;let l=`${r.API_ALIASES}`,i=s?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${l}${m({limit:a+1,teamId:u?.id,rollbackDeploymentId:c},i)}`;let n=t?.aliases&&t.aliases.length>a?t.aliases[a-1].createdAt:null;return n?`${l}${m({limit:a+1,teamId:u?.id,until:n},i)}`:null},e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),l),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,a))):[],[h.data,a]),x=!!h.data&&!h.error,f=!!(h.data&&0===p.length),y=!!(h.data&&h.size>h.data.length),g=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=a);return[h,{aliases:p,initialDataLoaded:x,isEmpty:f,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:y,isReachingEnd:g}]}function m(e,t){let l=(0,s.encode)(e,!1),i=t?`&${t}`:"";return l?`?${l}${i}`:`?${i}`}e.s(["useAliases",()=>d,"useAliasesInfinite",()=>u,"useAliasesV2",()=>c],5229375)},7018452,e=>{"use strict";var t=e.i(1176592);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[l,i]=(0,t.useState)(!1),a=window.location.hash,s=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==s||l||i(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[l,s]),a!==s||l||(i(!0),window.history.replaceState(null,""," ")),a!==s&&l&&(window.location.hash=s),[l,i]}e.s(["default",()=>l])},9719784,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),i=e.i(57106),a=e.i(822157),s=e.i(7018452),n=e.i(2405448),r=e.i(542164),o=e.i(1681029),c=e.i(4478191);let d=(0,l.memo)(function(e){let{url:d,truncate:u,defaultRoute:m,...h}=e,[p,x]=(0,s.default)("#wildcard"),[f,y]=(0,l.useState)(null),[g,j]=(0,l.useState)(!1),b=(0,l.useCallback)(()=>{y((0,n.default)(d)),x(!0)},[y,x,d]);return d?(0,r.default)(d)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",onClick:b,...h,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:d}):d}),g||p?(0,t.jsx)(a.default,{active:p,onCancel:()=>{x(!1)},url:f}):null]}):(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,c.withDefaultRoute)((0,o.domainToUrl)(d),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:d}):d}):null});e.s(["default",0,d])},9365163,4904548,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),i=e.i(5338940),a=e.i(1717203),s=e.i(7557283),n=e.i(4670733),r=e.i(588428),o=e.i(4396019),c=e.i(762945),d=e.i(7749291),u=e.i(8735244),m=e.i(2504781),h=e.i(6891161),p=e.i(455575),x=e.i(8522580),f=e.i(8761240),y=e.i(5756088),g=e.i(9386557),j=e.i(4004502),b=e.i(8042625),v=e.i(277234),k=e.i(4244280),w=e.i(5140444),S=e.i(5757634),N=e.i(5802506),C=e.i(6641571);e.i(9623499);var D=e.i(5576066),R=e.i(3924999),A=e.i(5229375);e.i(5394896);var I=e.i(9668517);let P="[teamSlug]";var M=e.i(6060673),T=e.i(930810),E=e.i(7952834),$=e.i(1173672),B=e.i(8227242),L=e.i(9745887),O=e.i(3306538),F=e.i(5468328),_=e.i(9719784);function z(e){let{hidden:l,showIcon:i=!0,linkProps:a,defaultRoute:s}=e;return(0,t.jsx)(t.Fragment,{children:l.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(_.default,{defaultRoute:s,icon:i,title:e,truncate:!0,url:e,...a})},e))})}function W(e){let{hidden:l,linkProps:i}=e;return(0,t.jsx)(F.Tooltip,{text:(0,t.jsx)(z,{hidden:l,linkProps:i}),children:(0,t.jsx)(O.Badge,{size:"sm",variant:"gray-subtle",children:`+${l.length}`})})}let H=function(e){let{className:l,defaultRoute:i,domains:a,firstOnly:s,showIcon:n=!0,style:r,linkProps:o}=e;if(!a)return(0,t.jsx)("span",{className:`text-copy-14 text-gray-900 ${l}`,style:r,children:"-"});let{visible:c,hidden:d}=a.reduce((e,t)=>(0===e.visible.length||!s&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)("span",{className:`text-[14px] leading-[20px] font-medium ${l}`,children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial max-w-full",style:{...r},children:[c.map((e,l)=>{let a=l===c.length-1;return(0,t.jsx)(_.default,{defaultRoute:i,icon:n,style:{marginRight:a?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...o},e)}),d.length?(0,t.jsx)(W,{hidden:d,linkProps:o}):null]})})};e.s(["default",0,H],4904548);var U=e.i(8651268),q=e.i(2547843);function G(){return(0,t.jsx)(h.Modal.Header,{children:(0,t.jsx)(h.Modal.Title,{center:!0,children:"Instant Rollback"})})}function V(e){let{setStage:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{fullWidth:!0,onClick:()=>{l("initial")},type:"secondary",children:"Back"})})]})}function Y(){return(0,t.jsx)("div",{children:(0,t.jsx)(x.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:4},children:[(0,t.jsx)(c.Warning,{style:{flexShrink:0}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function K(e){var a;let s,{hasFloatingAliases:o,onCancel:c,previousDeployment:u,productionAliases:p,productionDeployment:f,project:g,rollbackCandidates:b,setStage:v,selectedDeployment:k,setSelectedDeployment:w,deploymentSwr:S,rollbackReason:N,setRollbackReason:C}=e,R=(a="/[teamSlug]",s=(0,I.useTeamSlug)(),(0,l.useMemo)(()=>a.includes(P)?a.replace(`/${P}`,s?`/${s}`:""):a,[s,a])),[A,M]=(0,l.useState)(!1),{team:E}=(0,i.useTeam)(),$=!E||E.billing?.plan==="hobby",{value:B}=(0,n.useInstantRollbackHobbyRestrictionFlag)(),{value:O}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)();return b.length&&u&&k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-16",children:["Rolling back"," ",(0,t.jsx)(H,{domains:p,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),o?(0,t.jsx)(Y,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(L.DeploymentCardSmall,{deployment:f,isProductionDeployment:!0,selectedDeployment:k,setSelectedDeployment:w})})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"To the following deployment:"}),A?(0,t.jsx)("div",{children:(0,t.jsx)(T.ChooseDeploymentList,{deployments:b,previousDeployment:u,productionDeployment:f,rolledBackDeploymentId:g?.lastAliasRequest?.type==="rollback"?g.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:k,setSelectedDeployment:w,swr:S})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(L.DeploymentCardSmall,{deployment:k,isForm:A,isPreviousDeployment:k.uid===u.uid,selectedDeployment:k,setSelectedDeployment:w})}),(B||O)&&$?(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial mt-6",children:(0,t.jsx)(x.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial p-2",children:[(0,t.jsx)(y.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(D.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===R?"/dashboard?createTeam=instant-rollback":`${R}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)("span",{className:"text-copy-14 text-inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(d.ExternalSmall,{className:"ml-1"}),(0,t.jsx)("span",{className:"text-copy-14 text-inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(m.Button,{onClick:()=>{M(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{htmlFor:"rollback-reason",className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:(0,t.jsx)("span",{className:"text-copy-16",children:"Share a reason for this rollback:"})}),(0,t.jsx)(T.RollbackDescriptionTextarea,{value:N,onChange:C,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","continue-button"),disabled:N.length>=T.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{v("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsx)("p",{className:"text-copy-14",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"})})]})}function X(e){let{selectedDeployment:l,setStage:i,requestRollback:a,project:s,rollbackReason:n,rollbackCandidates:r}=e,{user:o}=(0,w.useUser)();if(!l)return(0,t.jsx)(V,{setStage:i});let c=n.length>=T.REASON_MAX_CHARACTER_LENGTH,u=(0,T.getMostRecentlyPromotedDeployment)(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"Rolling back to:"}),(0,t.jsx)(L.DeploymentCardSmall,{deployment:l,isPreviousDeployment:l.uid===u?.uid,selectedDeployment:l,setSelectedDeployment:()=>null})]}),n.trim()&&(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:(0,t.jsx)(T.RollbackDescriptionCard,{rollbackDescription:{description:n.trim(),userId:o?.uid??"",username:o?.username??"",deploymentId:l.uid,projectId:s?.id??"",createdAt:new Date().getTime()},project:s,preview:!0})}),(0,t.jsxs)(C.UL,{className:"mb-0",children:[(0,t.jsx)(C.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(C.LI,{children:[(0,t.jsxs)(D.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${l.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(d.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(C.LI,{children:"You can update the rollback reason from the project overview."})]}),(s?.autoAssignCustomDomains??!0)||s?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(x.Note,{fill:!0,type:"secondary",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:()=>{i("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","rollback-button"),disabled:c,onClick:()=>{a(l.uid),i("processing")},children:"Confirm Rollback"})]})]})}function J(e){let{jobStatus:i,rollbackDeploymentId:a,rollbackCandidates:s,selectedDeployment:n,setStage:r,onCancel:o,statusSwr:c,requestRollback:d,rollbackReason:p}=e,{user:x}=(0,w.useUser)();if((0,l.useEffect)(()=>{a===n?.uid&&("failed"===i?r("error"):"succeeded"===i&&r("done"))},[a,i,n,r]),!n)return(0,t.jsx)(V,{setStage:r});let y=(0,T.getMostRecentlyPromotedDeployment)(s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Assigning production domains:"}),(0,t.jsx)(L.DeploymentCardSmall,{deployment:n,isPreviousDeployment:n.uid===y?.uid,selectedDeployment:n,setSelectedDeployment:()=>null})]}),""!==p?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["“",(0,t.jsx)(B.LinkParser,{text:p.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.PrincipalAvatar,{size:20,principalId:x.uid,principal:{type:"user",uid:x.uid,username:x.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:x.username})]}):null]})]}):null,(0,t.jsxs)(C.UL,{className:"mx-4 my-0 list-none pt-2",children:[c.aliases.map(e=>{let l="loading";return"completed"===e.status?l="success":"failed"===e.status&&(l="error"),(0,t.jsx)(C.LI,{children:(0,t.jsxs)("div",{className:"h-6 flex items-center gap-2",children:["loading"===l&&(0,t.jsx)(u.Spinner,{className:"shrink-0",size:16}),"error"===l&&(0,t.jsx)(g.WarningFill,{className:"shrink-0",color:"amber-800",size:16}),"success"===l&&(0,t.jsx)(f.CheckCircleFill,{className:"shrink-0",color:"blue-700",size:16}),(0,t.jsx)("span",{className:"text-copy-14 truncate",children:e.alias})]})},e.alias)}),!c.isReachingEnd&&c.initialDataLoaded?(0,t.jsx)(C.LI,{children:(0,t.jsx)(m.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==i&&"succeeded"!==i,onClick:()=>{"failed"===i?d(n.uid):"succeeded"===i&&(r("initial"),o())},children:"failed"===i?"Retry":"Done"})})]})}function Q(e){let{active:a,initialSelectedDeployment:s,onCancel:n,productionBranch:r,productionDeployment:o,projectId:c,rollbackCandidates:d,swr:u,rollbackDescription:m}=e,{mutate:x}=(0,S.useSWRConfig)(),[f,y]=(0,l.useState)("initial"),[g,w]=(0,l.useState)(""),{isReady:C,team:D}=(0,i.useTeam)(),I=(0,p.useToasts)(),P=(0,l.useMemo)(()=>{let e=d.filter(e=>e.uid!==o.id);return(0,T.getMostRecentlyPromotedDeployment)(e)},[d,o]),[B,L]=(0,l.useState)(null),O=B??s??P??null,F=(0,l.useCallback)(y,[y]),_=(0,l.useCallback)(L,[L]),[,{aliases:z}]=(0,A.useAliasesInfinite)({rollbackDeploymentId:o.id}),{data:W}=(0,M.useProject)(c),{lastAliasRequest:H,hasFloatingAliases:U}=W||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:G,jobStatus:V}=H||{toDeploymentId:null,jobStatus:null},[,Y]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:s,team:n}=(0,i.useTeam)(),r=(0,R.default)((t,l)=>{if(!s)return null;let i={teamId:n?.id,limit:a};return t?l?.next?`${(0,k.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)({...i,until:l.next})}`:null:`${(0,k.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)(i)}`},e=>(0,v.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),o=(0,l.useMemo)(()=>r.data?[].concat(...r.data.filter(Boolean).map(e=>e.aliases.slice(0,a))):[],[r.data,a]),c=!!r.data,d=c&&0===o.length,u=c&&r.data&&r.size>r.data.length,m=c&&r.data&&r.data[r.data.length-1]?.aliases.length<a;return[r,{aliases:o,initialDataLoaded:c,isEmpty:d,loadMore:()=>r.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:r.mutate}]}(c,2e3),Q=(0,l.useMemo)(()=>o,[a]),Z=()=>{y("initial"),L(s||P||null),n()},ee=(0,l.useCallback)(async e=>{if(!C)return;let t=`${(0,k.API_DEPLOYMENT_ROLLBACK)(c,e)}${(0,b.encode)({teamId:D?.id,description:g.trim()})}`;try{await (0,v.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),D&&(void 0!==W&&(0,E.revalidateProject)(x,W),await x((0,$.getProjectProductionDeploymentKey)({projectIdOrName:c,teamId:D.slug})),x((0,q.getRollingReleaseEndpoint)(D.slug,c)))}catch(e){I.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,N.captureError)(e)}},[C,c,I,g,x,D,W]),et={rollbackDeploymentId:G,hasFloatingAliases:!!U,jobStatus:V,onCancel:Z,previousDeployment:P,productionBranch:r,productionDeployment:Q,productionAliases:z.map(e=>{let{alias:t}=e;return t}),project:W,rollbackCandidates:d,setStage:F,selectedDeployment:O,setSelectedDeployment:_,deploymentSwr:u,statusSwr:Y,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:g,setRollbackReason:w,rollbackDescription:m};return(0,t.jsxs)(h.Modal.Modal,{active:a,"data-testid":(0,j.tid)("deployment","rollback-modal"),onClickOutside:Z,sticky:!0,width:"500px",children:["initial"===f&&(0,t.jsx)(K,{...et}),"selected"===f&&(0,t.jsx)(X,{...et}),["processing","error","done"].includes(f)&&(0,t.jsx)(J,{...et})]})}var Z=e.i(5771992),ee=e.i(5645345),et=e.i(3981247);e.i(3182268);var el=e.i(7849855);function ei(e){let{team:t}=(0,i.useTeam)(),a=!t||t.billing?.plan==="hobby",{value:s}=(0,n.useInstantRollbackHobbyRestrictionFlag)(),{value:c}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)(),d=s||c,u=e?.name,{deployment:m,isLoading:h}=(0,o.useProjectProductionDeployment)(u);return(0,l.useMemo)(()=>{let t=(0,ee.asListDeployment)(e),l=a&&!t?.isRollbackCandidate;return t?h?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":d?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,a,h,m?.id,d])}function ea(e){let{onClose:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[n,r]=(0,l.useState)(!1),[c,d]=(0,l.useState)(),{teamSlug:u,projectSlug:m}=(0,el.useProjectAndTeamSlug)(),{data:h}=(0,M.useProject)(c?.name),p=m??c?.name,x=e??h,{data:f}=(0,et.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),y=f?.rollingRelease?f?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:g,rollbackDescription:j,mutate:b}=(0,o.useProjectProductionDeployment)(x?.name),{can:v}=(0,a.default)({projectIdOrName:x?.name}),k=v(s.Action.Create,s.Resource.DeploymentRollback),w=x?.link?.productionBranch?x.link.productionBranch:void 0,[S,N]=(0,Z.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:C,initialDataLoaded:D}=N,R=C.filter(e=>!!e.isRollbackCandidate&&e.uid!==y),A=!!(D&&x&&!R.length),I=(0,l.useCallback)(e=>{d((0,ee.asListDeployment)(e)),r(!0)},[]),P=(0,l.useCallback)(()=>{r(!1),b().finally(()=>null),i?.()},[b,i]);return{rollbackModal:(0,l.useMemo)(()=>k&&n&&g&&x?(0,t.jsx)(Q,{active:n,initialSelectedDeployment:c,onCancel:P,productionBranch:w,productionDeployment:g,projectId:x.id,rollbackCandidates:R,rollbackDescription:j,swr:N}):null,[k,n,c,w,g,R,x,N,P,j]),closeRollbackModal:P,openRollbackModal:I,canRollbackDeployment:k,noRollbackCandidates:A}}e.s(["useInstantRollbackModal",()=>ea,"useRollbackTooltip",()=>ei],9365163)}]);

//# debugId=6f9bd975-d11d-7ac3-df7a-94e4cc55b09e
//# sourceMappingURL=f0489c27ace269e5.js.map