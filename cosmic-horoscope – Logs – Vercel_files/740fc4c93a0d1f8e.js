;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="2be14a47-df70-cf6d-c317-b6120ae251f0")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2679877,(e,t,i)=>{"use strict";var n,s="object"==typeof Reflect?Reflect:null,r=s&&"function"==typeof s.apply?s.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function l(){l.init.call(this)}t.exports=l,t.exports.once=function(e,t){return new Promise(function(i,n){var s,r,a;function l(i){e.removeListener(t,o),n(i)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",l),i([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&(s=e,r=l,a={once:!0},"function"==typeof s.on&&g(s,"error",r,a))})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var o=10;function c(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?l.defaultMaxListeners:e._maxListeners}function d(e,t,i,n){if(c(i),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),r=e._events),a=r[t]),void 0===a)a=r[t]=i,++e._eventsCount;else if("function"==typeof a?a=r[t]=n?[i,a]:[a,i]:n?a.unshift(i):a.push(i),(s=u(e))>0&&a.length>s&&!a.warned){a.warned=!0;var s,r,a,l=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,console&&console.warn&&console.warn(l)}return e}function f(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},s=f.bind(n);return s.listener=i,n.wrapFn=s,s}function h(e,t,i){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(e){for(var t=Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(s):x(s,s.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function x(e,t){for(var i=Array(t),n=0;n<t;++n)i[n]=e[n];return i}function g(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else if("function"==typeof e.addEventListener)e.addEventListener(t,function s(r){n.once&&e.removeEventListener(t,s),i(r)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),l.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},l.prototype.getMaxListeners=function(){return u(this)},l.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var a,l=Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var o=s[e];if(void 0===o)return!1;if("function"==typeof o)r(o,this,t);else for(var c=o.length,u=x(o,c),i=0;i<c;++i)r(u[i],this,t);return!0},l.prototype.addListener=function(e,t){return d(this,e,t,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(e,t){return d(this,e,t,!0)},l.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},l.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},l.prototype.removeListener=function(e,t){var i,n,s,r,a;if(c(t),void 0===(n=this._events)||void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,s=r;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0==arguments.length){var s,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},l.prototype.listeners=function(e){return h(this,e,!0)},l.prototype.rawListeners=function(e){return h(this,e,!1)},l.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},l.prototype.listenerCount=m,l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},9943777,e=>{"use strict";var t=e.i(8813284);function i(e){let i=`${e};technicallyasecretbutwejustwanttomakethisharder`;return t.default.createHash("sha1").update(i).digest("hex")}e.s(["getRuleTemplateSignature",()=>i])},9465698,e=>{"use strict";var t=e.i(1176592),i=e.i(7909933),n=e.i(4005781),s=e.i(8042625),r=e.i(277234),a=e.i(4244280),l=e.i(5338940),o=e.i(455575),c=e.i(6060673);function u(e){let{projectId:u}=e,m=(0,o.useToasts)(),{team:x}=(0,l.useTeam)(),{data:g,mutate:v}=(0,c.useProject)(u),y=(0,s.encode)({teamId:x?.id,projectId:u}),{data:j,mutate:w,isLoading:b}=(0,i.default)(x&&u?`${a.API_FIREWALL}/firewall/bypass${y}`:null,r.fetchAPI),L=(0,t.useMemo)(()=>(function(e,t){if(!e&&!t)return null;let i=[];if(e)for(let t of e)i.push(t);if(t){let n=Math.floor(Date.now()/1e3);for(let s of t){let t=s.split("#");if(!["0.0.0.0/0","::/0"].includes(t[0])||t.length<2||Number.parseInt(t[1],10)>n){if(e?.find(e=>e.Ip===t[0]&&"*"===e.Domain))continue;i.push({Ip:t[0],Domain:"*",Note:"",Id:`*#${t[0]}`})}}}return i})(j?.result,g?.security?.firewallBypassIps),[j,g]),{trigger:P,isMutating:N}=(0,n.default)(`${a.API_FIREWALL}/firewall/bypass${y}`,p),{trigger:A,isMutating:I}=(0,n.default)(`${a.API_FIREWALL}/firewall/bypass${y}`,h),{trigger:C,isMutating:M}=(0,n.default)(`${a.API_FIREWALL}/firewall/bypass${y}`,d),{trigger:E,isMutating:R}=(0,n.default)(`${a.API_FIREWALL}/firewall/bypass${y}`,f),T=(0,t.useCallback)(async e=>{let t=e?P:A;try{await t(),m.success(`${e?"Paused":"Resumed"} System Mitigations`)}catch(t){throw m.error(t.message||`Failed to ${e?"Pause":"Resume"} system mitigations. Please try again.`),t}},[P,A,m]);return{bypassRules:L,updateBypass:(0,t.useCallback)(async(e,t)=>{("*"===t.domain||"All hosts"===t.domain)&&(t.projectScope=!0,t.domain=void 0);try{e?(await E(t),m.success(`Removed system bypass for ${t.sourceIp}`)):(await C(t),m.success(`Added system bypass for ${t.sourceIp}`)),await w(),t.projectScope&&await v()}catch(e){throw m.error(e.message||"Failed to update system bypass. Please try again."),e}},[C,E,m,w,v]),updateMitigationsBypassAll:T,isLoading:b||N||I||M||R}}async function d(e,t){let{arg:i}=t,n=JSON.stringify(i);return await (0,r.fetchAPI)(e,{method:"POST",throwOnHTTPError:!0,returnStatus:!0,body:n})}async function f(e,t){let{arg:i}=t,n=JSON.stringify(i);return await (0,r.fetchAPI)(e,{method:"DELETE",throwOnHTTPError:!0,returnStatus:!0,body:n})}async function p(e){let t=JSON.stringify({allSources:!0,projectScope:!0});return await (0,r.fetchAPI)(e,{method:"POST",throwOnHTTPError:!0,returnStatus:!0,body:t})}async function h(e){let t=JSON.stringify({allSources:!0,projectScope:!0});return await (0,r.fetchAPI)(e,{method:"DELETE",throwOnHTTPError:!0,returnStatus:!0,body:t})}e.s(["useFirewallBypass",()=>u],9465698)},6482765,e=>{"use strict";var t=e.i(8711407),i=e.i(3869281),n=e.i(6891161),s=e.i(3500331),r=e.i(57106),a=e.i(1438473),l=e.i(1176592);function o(e){let{open:o,isEnabled:c,isLoading:u,onClose:d,onSubmit:f,confirmText:p}=e,[h,m]=(0,l.useState)(!1),[x,g]=(0,l.useState)(!1),v=u||!c&&(!x||!h);!o&&(h||x)&&(m(!1),g(!1));let y=c?"Resume":"Pause",j=c?(0,t.jsx)("p",{children:"Are you sure you want to resume all system mitigations?"}):(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-14",children:["You are pausing ",(0,t.jsx)("strong",{children:"all DDoS protections"}),". Here's what to expect:"]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial pl-3 pt-3",children:[(0,t.jsxs)("div",{className:"flex flex-row items-start justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-600",children:"•"}),(0,t.jsxs)("p",{className:"text-copy-14",children:["All traffic will be accepted by your project over the"," ",(0,t.jsx)("strong",{children:"next 24 hours"})]})]}),(0,t.jsxs)("div",{className:"flex flex-row items-start justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-600",children:"•"}),(0,t.jsx)("p",{className:"text-copy-14",children:"You will incur usage fees for all malicious traffic, including failed requests"})]}),(0,t.jsxs)("div",{className:"flex flex-row items-start justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-600",children:"•"}),(0,t.jsx)("p",{className:"text-copy-14",children:"Malicious traffic and associated fees will continue until DDoS protection is manually resumed or after 24 hours elapses"})]})]}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial pt-2",children:(0,t.jsxs)("p",{className:"text-copy-14",children:["System mitigations should be paused as a temporary measure. Permanent system bypasses may be applied through the firewall configuration page."," ",(0,t.jsxs)(r.Link,{href:"./firewall/configure",variant:"blend",className:"inline-flex items-center gap-1",children:["Configure ",(0,t.jsx)(a.ArrowRight,{size:12})]})]})})]});return(0,t.jsxs)(n.Modal.Modal,{active:o,onClickOutside:d,children:[(0,t.jsx)(n.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(n.Modal.Title,{children:`${y} System Mitigations`}),(0,t.jsx)(n.Modal.P,{children:j}),c?null:(0,t.jsx)(n.Modal.Inset,{last:!0,children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["To confirm, enter the project name ",(0,t.jsxs)("b",{children:[p," "]})," ","below:"]}),(0,t.jsx)(s.Input,{"aria-label":"Project name",disabled:u,name:"projectName",onChange:e=>g(()=>e.target.value===p)}),(0,t.jsx)(i.Checkbox,{onChange:e=>m(e.target.checked),children:"I understand that pausing system mitigations may result in additional fees due to unmitigated attack traffic."})]})})]})}),(0,t.jsxs)(n.Modal.Actions,{children:[(0,t.jsx)(n.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"}),(0,t.jsx)(n.Modal.Action,{disabled:v,loading:u,onClick:f,children:y})]})]})}e.s(["MitigationsBypassModal",()=>o])},8362250,5793260,e=>{"use strict";var t=e.i(8711407),i=e.i(57106),n=e.i(6891161),s=e.i(2713868),r=e.i(1176592);function a(e){let{open:a,isEnabled:l,onClose:o,onSubmit:c}=e,u=l?"Disable":"Enable",d=(0,r.useRef)(null);return(0,t.jsxs)(n.Modal.Modal,{active:a,onClickOutside:o,children:[(0,t.jsxs)(n.Modal.Body,{children:[(0,t.jsx)(n.Modal.Header,{children:(0,t.jsx)(n.Modal.Title,{children:`${u} Attack Mode`})}),l?(0,t.jsx)(n.Modal.P,{children:"Are you sure you want to disable Attack Mode?"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Modal.P,{children:["When you enable Attack Mode, all traffic, excluding verified bots, will be challenged. This means:",(0,t.jsxs)("ul",{className:"my-2 flex flex-col gap-2 pl-4",children:[(0,t.jsx)("li",{className:"text-copy-14",children:"• Verified bots will still have access"}),(0,t.jsxs)("li",{className:"text-copy-14",children:["• All other traffic will be served a"," ",(0,t.jsx)(i.Link,{external:!0,href:"/docs/vercel-firewall/firewall-concepts#challenge",isDifferentZone:!0,variant:"highlight",children:"challenge"})," ","to verify it is originating from real browsers"]}),(0,t.jsx)("li",{className:"text-copy-14",children:"• Bots that fail challenges will be blocked"}),(0,t.jsx)("li",{className:"text-copy-14",children:"• Human visitors in browsers will continue normally after solving the challenge"})]}),"We recommend enabling this mode only when experiencing a very large and unexpected spike in traffic to stop unwanted automated traffic from accessing your site."]}),(0,t.jsx)(i.Link,{external:!0,href:"/docs/attack-challenge-mode",isDifferentZone:!0,variant:"highlight",children:"Learn More"})]})]}),(0,t.jsx)("div",{ref:d,className:"contents",children:(0,t.jsxs)(n.Modal.Actions,{children:[(0,t.jsx)(n.Modal.Action,{onClick:o,type:"secondary",children:"Cancel"}),l?(0,t.jsx)(n.Modal.Action,{onClick:()=>c(),children:u}):(0,t.jsx)("div",{children:(0,t.jsx)(s.SplitButton,{buttonProps:{onClick:()=>c(36e5)},menuAlignment:"bottom-end",menuButtonLabel:"Select Duration",menuItems:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.SplitButtonMenuItem,{menuItemProps:{onClick:()=>c(216e5)},title:"Enable for 6 Hours"}),(0,t.jsx)(s.SplitButtonMenuItem,{menuItemProps:{onClick:()=>c(864e5)},title:"Enable for 24 Hours"})]}),menuProps:{width:192,containerRef:d},children:"Enable for 1 Hour"})})]})})]})}e.s(["ConfirmationAttackMode",()=>a],8362250);var l=e.i(4005781),o=e.i(8042625),c=e.i(277234),u=e.i(4244280),d=e.i(5338940);async function f(e,t){let{arg:i}=t;return await (0,c.fetchAPI)(e,{method:"POST",throwOnHTTPError:!0,returnStatus:!0,body:JSON.stringify(i)})}function p(){let{team:e}=(0,d.useTeam)(),t=(0,o.encode)({teamId:e?.id});return(0,l.default)(`${u.API_SECURITY}/attack-mode${t}`,f)}e.s(["useUpdateAttackMode",()=>p],5793260)},8122440,e=>{"use strict";var t=e.i(4244280),i=e.i(8042625),n=e.i(7909933),s=e.i(277234);function r(e){let{projectIdOrName:r,teamIdOrSlug:a}=e;return(0,n.default)(`${t.API_FIREWALL}/proxy/status${(0,i.encode)({projectId:r,teamId:a})}`,s.fetchAPI)}function a(e){let{projectIdOrName:r,teamIdOrSlug:a}=e;return(0,n.default)(`${t.API_FIREWALL_PROXY_STATUS_V2}${(0,i.encode)({projectId:r,teamId:a})}`,s.fetchAPI)}e.s(["useReverseProxyStatus",()=>r,"useReverseProxyStatusV2",()=>a])},8114130,e=>{"use strict";function t(e){let t=e?.security?.firewallBypassIps;if(!t)return{enabled:!1};let i={enabled:!1};for(let e of t){let t=e.split("#");if("0.0.0.0/0"===t[0]||"::/0"===t[0]&&t.length>=2){let e=Number.parseInt(t[1],10);!Number.isNaN(e)&&e>Date.now()/1e3&&(i={enabled:!0,ttl:e})}}return i}e.s(["globalBypassStatus",()=>t])},3219719,(e,t,i)=>{var n=e.r(263217),s=e.r(660575),r=e.r(5729582),a=e.r(7791606),l=e.r(2728359);t.exports=function(e,t,i,o){if(!a(e))return e;t=s(t,e);for(var c=-1,u=t.length,d=u-1,f=e;null!=f&&++c<u;){var p=l(t[c]),h=i;if("__proto__"===p||"constructor"===p||"prototype"===p)break;if(c!=d){var m=f[p];void 0===(h=o?o(m,p,f):void 0)&&(h=a(m)?m:r(t[c+1])?[]:{})}n(f,p,h),f=f[p]}return e}},5120311,(e,t,i)=>{var n=e.r(716543);t.exports=function(e){return n(e,5)}},7829532,(e,t,i)=>{var n=e.r(3219719);t.exports=function(e,t,i){return null==e?e:n(e,t,i)}},594750,e=>{"use strict";var t=e.i(1176592),i=e.i(455575),n=e.i(7909933),s=e.i(4005781),r=e.i(5120311),a=e.i(7829532),l=e.i(2793676),o=e.i(1875382),c=e.i(8042625),u=e.i(277234),d=e.i(4244280),f=e.i(5338940),p=e.i(421794);function h(e){if(!e)return;let t=e.draft??e.active;if(!t)return t;let i=new Map,n=Object.keys(t.crs).map(e=>{let{name:n,description:s}=(0,p.crsRuleToConfig)(e),r={id:e,action:t.crs[e].action,active:t.crs[e].active,name:n,description:s};return i.set(r.id,{...r,type:"owas"}),r}).sort((e,t)=>e.name.localeCompare(t.name)),s=t.rules.map(e=>{let t={id:e.id,description:e.description,name:e.name,action:e.action?.mitigate?.action==="rate_limit"?e.action.mitigate.rateLimit?.action||"log":e.action?.mitigate?.action||"log",active:e.active,value:e,isRateLimit:e.action?.mitigate?.action==="rate_limit"};return i.set(t.id,{...t,type:"custom_rule"}),t});t.ips.forEach(e=>{i.set(e.id,{...e,type:"ip_block"})});let r=t.changes.sort((e,t)=>t.createdAt.localeCompare(e.createdAt));return{currentConfig:t,crsRules:n,rules:s,changes:r,ruleMap:i}}async function m(e){let[t]=e;return(await (0,u.fetchAPI)(t,{method:"GET",throwOnHTTPError:!0,returnStatus:!0})).body}function x(e){let{projectId:r,ruleId:a}=e,{team:l}=(0,f.useTeam)(),u=(0,o.useRouter)(),p=(0,c.encode)({teamId:l?.id,projectId:r}),{data:x,mutate:j,isLoading:w}=(0,n.default)(l&&r?[`${d.API_FIREWALL}/firewall/config${p}`,p]:null,async e=>m(e)),b=(0,i.useToasts)(),L=(0,t.useMemo)(()=>h(x?{...x,draft:null}:void 0),[x]),P=(0,t.useMemo)(()=>h(x),[x]),{trigger:N,isMutating:A}=(0,s.default)(`${d.API_FIREWALL}/firewall/config/draft${p}`,g),{trigger:I,isMutating:C}=(0,s.default)([`${d.API_FIREWALL}/firewall/config/`,`/activate${p}`],v),{trigger:M}=(0,s.default)(`${d.API_FIREWALL}/firewall/config${p}`,g),{trigger:E,isMutating:R}=(0,s.default)(`${d.API_FIREWALL}/firewall/config/draft${p}`,y),T=(0,t.useCallback)(async e=>{try{let t=await g(`${d.API_FIREWALL}/firewall/config/draft${p}`,{arg:e});j({...x||{active:null,versions:[t]},draft:t},{revalidate:!1}).then(()=>null,()=>null)}catch(e){throw b.error(e.message||"Failed to update Firewall. Please try again."),e}},[p,b,x,j]),_=(0,t.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2?arguments[2]:void 0;try{await M(e),t&&(await j(),u.refresh(),i?.())}catch(e){throw b.error(e.message||"Failed to update Firewall. Please try again."),e}},[j,b,x,M,u.refresh]),S=(0,t.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2?arguments[2]:void 0;try{let n=await N(e);await j({...x||{active:null,versions:[n]},draft:n},{revalidate:!1}),t&&(i?.(),j().then(()=>null,()=>null))}catch(e){throw b.error(e.message||"Failed to update Firewall. Please try again."),e}},[j,N,b,x]),k=(0,t.useCallback)(async()=>{try{await E(),await j()}catch(e){throw b.error(e.message||"Failed to discard Firewall changes. Please try again."),e}},[j,E,b]),O=(0,t.useCallback)(async(e,t)=>{try{await I(t);let i=e?.toastSuccessMessage??"Your Firewall changes have been applied successfully";b.success(i),u.refresh(),await j().catch(()=>null)}catch(t){throw b.error(e?.toastErrorMessage||t.message||"Failed to publish Firewall changes. Please try again."),t}},[I,j,b,u]),$=(0,t.useCallback)(()=>{j().then(()=>null,()=>null)},[j]),F=(0,t.useMemo)(()=>{if(!a||!P)return;let e=P.rules.find(e=>e.id===a);if(e)return e.value},[a,P]),B=(0,t.useMemo)(()=>!P||!P.rules.some(e=>e.isRateLimit),[P]);return{activeConfig:L,config:P,showRateLimitModal:B,selectedRule:F,forceConfig:_,updateConfig:S,reorderItem:T,discardChanges:k,publishChanges:O,isPublishing:C,isDiscarding:R,isUpdatingConfig:A,isLoadingConfig:w&&!x,refresh:$}}async function g(e,t){let{arg:i}=t,n=(0,r.default)(i);return n.value&&"object"==typeof n.value&&("valid"in n.value&&delete n.value.valid,"validationErrors"in n.value&&delete n.value.validationErrors),(await (0,u.fetchAPI)(e,{method:"PATCH",throwOnHTTPError:!0,returnStatus:!0,body:JSON.stringify(n)})).body}async function v(e,t){let[i,n]=e,{arg:s="draft"}=t;return await (0,u.fetchAPI)(`${i}${s}${n}`,{method:"POST",throwOnHTTPError:!0,returnStatus:!0,body:JSON.stringify({})})}async function y(e){return await (0,u.fetchAPI)(e,{method:"DELETE",throwOnHTTPError:!0,returnStatus:!0})}function j(e,t){if(Object.hasOwn(e,"value")){let i=(0,r.default)(e);return i=(0,l.default)(i,"value.id"),"action"===t.type?i.isRateLimit?(0,a.default)(i,"value.action.mitigate.rateLimit.action",t.value):(0,a.default)(i,"value.action.mitigate.action",t.value):(0,a.default)(i,"value.active",t.value),{id:e.id,action:"rules.update",value:i.value}}let i="action"===t.type?{action:t.value,active:e.active}:{action:"disable"===e.action?"log":e.action,active:t.value};return{id:e.id,action:"crs.update",value:i}}e.s(["formatPatchRule",()=>j,"useFirewallConfig",()=>x],594750)},3774835,e=>{"use strict";var t=e.i(277234),i=e.i(7909933);function n(e){let{projectIdOrName:n,teamIdOrSlug:s}=e;return(0,i.default)(["/v1/security/firewall/managed-rules",new URLSearchParams({projectId:n,teamId:s}).toString()],e=>{let[i,n]=e;return(0,t.default)(`${i}?${n}`)})}e.s(["useManagedRulesets",()=>n])},681099,e=>{"use strict";var t=e.i(7909933),i=e.i(8042625),n=e.i(277234),s=e.i(5338940);function r(e){let{isReady:r,team:a}=(0,s.useTeam)();return(0,t.default)(()=>e&&r?`/api/v1/microfrontends/groups/${e}/projects${(0,i.encode)({teamId:a?.id})}`:null,e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),{fallbackData:{projects:[]}})}e.s(["useMicrofrontendsGroupProjects",()=>r])},9148191,e=>{"use strict";var t=e.i(1176592),i=e.i(1875382),n=e.i(5338940),s=e.i(6161994),r=e.i(681099),a=e.i(6060673);function l(){let e=(0,i.useParams)(),{data:l}=(0,a.useProject)(e?.project),o=l?.microfrontends?.groupIds[0],{isReady:c,team:u}=(0,n.useTeam)(),{data:d,isLoading:f}=(0,s.useMicrofrontendsGroups)(),{data:p,isLoading:h}=(0,r.useMicrofrontendsGroupProjects)(o),m=p?.projects.find(e=>e.microfrontends?.isDefaultApp),x=l?.microfrontends!==void 0&&!l.microfrontends.isDefaultApp;return(0,t.useMemo)(()=>({defaultProjectName:m?.name,defaultProjectBaseUrl:m?`/${u?.slug}/${m.name}`:null,groupName:d?.groups.find(e=>e.group.id===o)?.group.name??m?.name,isChildMicrofrontend:x,isLoading:!c||!u||h||f,isMicrofrontend:(l?.microfrontends?.groupIds?.length??0)>0}),[m,o,x,f,h,c,l?.microfrontends?.groupIds?.length,u,d])}e.s(["useMicrofrontendsProjectInfo",()=>l])},9367781,e=>{"use strict";var t=e.i(8711407),i=e.i(9148191),n=e.i(7132425);function s(e){let{childHelp:s,parentHelp:r}=e,{isChildMicrofrontend:a,isMicrofrontend:l}=(0,i.useMicrofrontendsProjectInfo)();if(!l)return null;let o=a?s:r;return o?(0,t.jsx)(n.MicrofrontendsBadge,{pageContext:o}):null}e.s(["MicrofrontendsHelpBadge",()=>s])},6319736,e=>{"use strict";var t=e.i(8711407),i=e.i(1176592);let n=!1;function s(e){let{fallback:s,data:r,children:a}=e;return!function(){let e=(0,i.useRef)(n),[,t]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{e.current||(n=!0,e.current=!0,t())},[]),n}()||r.includes(void 0)?(0,t.jsx)(t.Fragment,{children:s}):(0,t.jsx)(t.Fragment,{children:a})}e.s(["EnsureSWRData",()=>s],6319736)},523386,e=>{"use strict";var t=e.i(8711407),i=e.i(421794);function n(e){let{change:n,isCurrentUser:s,managedRulesets:r}=e,{principal:a,rule:l,actionTaken:o}=(0,i.createActionConfig)(n,r,s);return"ip.insert"===n.action||"ip.remove"===n.action?"ip.insert"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]}),"for host"," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[n.value.hostname," "]}),"on IP"," ",(0,t.jsx)("span",{className:"text-[14px] leading-[20px] font-medium",children:n.value.ip})]}):(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]})]}):"firewallEnabled"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," to "]}),n.value?"enabled":"disabled"]}):"crs.update"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]}),"configuration"]}):"rules.insert"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o,n.value.active?" and enabled ":" ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]})]}):"rules.remove"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]})]}):"rules.update"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]}),"configuration"]}):"managedRules.update"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]}),n.value.active?(0,t.jsxs)(t.Fragment,{children:["in"," ",(0,t.jsx)("span",{className:"text-[14px] leading-[20px] font-medium",children:n.value.action})," ","mode"]}):null]}):"botId.toggle"===n.action?(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[o," "]}),(0,t.jsx)("span",{className:"text-copy-14",children:l})]}):(0,t.jsxs)("p",{className:"text-copy-14",children:[(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[a," "]}),o," ",(0,t.jsxs)("span",{className:"text-[14px] leading-[20px] font-medium",children:[l," "]}),"configuration"]})}e.s(["ChangeLineItem",()=>n])},3420813,e=>{"use strict";var t=e.i(8711407),i=e.i(1176592),n=e.i(2504781),s=e.i(455575),r=e.i(1717203),a=e.i(7557283),l=e.i(594750),o=e.i(3774835),c=e.i(6891161),u=e.i(8522580),d=e.i(57106),f=e.i(7917902),p=e.i(7218483),h=e.i(9148191),m=e.i(523386),x=e.i(8651268);function g(e){let{changes:i=[],disabled:n,isDiscarding:s,isPublishing:r,managedRulesets:a,onClose:l,onDiscard:o,onPublish:p,open:x}=e,{user:g}=(0,f.useAccount)(),y=s||r||n,{defaultProjectBaseUrl:j,defaultProjectName:w,groupName:b,isChildMicrofrontend:L,isMicrofrontend:P}=(0,h.useMicrofrontendsProjectInfo)();return(0,t.jsxs)(c.Modal.Modal,{active:x,drawerClassname:"z-[5002]",onClickOutside:l,children:[(0,t.jsxs)(c.Modal.Body,{className:"tailwind-preflight",children:[(0,t.jsx)(c.Modal.Header,{children:(0,t.jsx)(c.Modal.Title,{children:1===i.length?"Review Change":`Review ${i.length} Changes`})}),(0,t.jsx)("div",{className:"flex w-full flex-col rounded-md border divide-y",children:i.map(e=>(0,t.jsx)(v,{change:e,viewerId:g?.uid,children:(0,t.jsx)(m.ChangeLineItem,{change:e,isCurrentUser:e.userId===g?.uid,managedRulesets:a})},`${e.createdAt}-${e.id}`))}),L?(0,t.jsxs)(u.Note,{className:"mt-4",children:["These changes will only be applied to paths routed to this microfrontend. Firewall rules for the entire domain should be added to"," ",(0,t.jsx)(d.Link,{href:`${j}/firewall/configure`,icon:!1,children:w}),"."]}):null,P&&!L?(0,t.jsxs)(u.Note,{className:"mt-4",children:["These rules will apply to all microfrontends in the"," ",(0,t.jsx)(d.Link,{href:`${j}/settings/microfrontends`,children:b})," ","group."]}):null]}),(0,t.jsxs)(c.Modal.Actions,{children:[(0,t.jsx)(c.Modal.Action,{onClick:l,type:"secondary",children:"Cancel"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Modal.Action,{disabled:y,loading:s,onClick:()=>o().then(l,()=>null),type:"secondary",children:"Discard All Changes"}),(0,t.jsx)(c.Modal.Action,{disabled:y,loading:r,onClick:()=>p().then(l,()=>null),children:"Publish"})]})]})]})}function v(e){let{change:i,children:n,viewerId:s}=e;return(0,t.jsxs)("div",{className:"flex h-[72px] items-center justify-between gap-x-4 p-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-4",children:[(0,t.jsx)(x.PrincipalAvatar,{principalId:i.userId,principal:{type:"user",uid:i.userId,username:i.username},viewerId:s}),n]}),(0,t.jsx)("p",{className:"text-copy-14 whitespace-nowrap text-gray-900",children:(0,p.useAgo)(new Date(i.createdAt).getTime())})]})}let y=(0,i.createContext)({open:!1,setOpen:()=>{}});y.displayName="ReviewChangeContext";let j="review-firewall-changes-key";function w(e){let{children:c,projectIdOrName:u,teamIdOrSlug:d}=e,f=(0,s.useToasts)(),{can:p}=(0,r.default)(),[h,m]=(0,i.useState)(!1),x=(0,i.useRef)(null),v=(0,i.useMemo)(()=>({open:h,setOpen:m}),[h,m]),{config:w,isDiscarding:b,isPublishing:L,publishChanges:P,discardChanges:N}=(0,l.useFirewallConfig)({projectId:u}),{data:A}=(0,o.useManagedRulesets)({projectIdOrName:u,teamIdOrSlug:d}),I=p(a.Action.All,a.Resource.SeawallConfig),C=(0,i.useCallback)(()=>{f.removeToastByKey(j),x.current=null},[f]);return(0,i.useEffect)(()=>{h&&C()},[h,C]),(0,i.useEffect)(()=>{if(!h)return w?.changes&&w.changes.length>0&&null===x.current?(x.current=j,f.message({key:j,text:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Review changes to publish the updated Firewall configuration to production"}),(0,t.jsx)("div",{className:"flex w-full items-center justify-end",children:(0,t.jsx)(n.Button,{onClick:()=>{setTimeout(()=>m(!0),30)},size:"small",children:"Review Changes"})})]}),hideX:!0,preserve:!0})):null===x.current||w?.changes&&0!==w.changes.length||(f.removeToastByKey(x.current),x.current=null),()=>{x.current&&(f.removeToastByKey(x.current),x.current=null)}},[w,f,h]),(0,t.jsxs)(y.Provider,{value:v,children:[c,(0,t.jsx)(g,{changes:w?.changes||[],disabled:!I,isDiscarding:b,isPublishing:L,managedRulesets:A??{},onClose:()=>m(!1),onDiscard:N,onPublish:P,open:h&&w?.changes&&w.changes.length>0||!1})]})}function b(){return(0,i.useContext)(y)}e.s(["ReviewChangeProvider",()=>w,"useReviewChangeContext",()=>b],3420813)},2801134,e=>{"use strict";var t=e.i(8711407),i=e.i(7557283),n=e.i(1717203),s=e.i(3306538),r=e.i(2504781),a=e.i(972022),l=e.i(6319736),o=e.i(3420813);function c(e){let{currentConfig:c}=e,{setOpen:u}=(0,o.useReviewChangeContext)(),d=(0,n.useCanAct)(i.Resource.SeawallConfig,[i.Action.Read,i.Action.List]);return(0,t.jsx)(l.EnsureSWRData,{data:[c],fallback:null,children:c?.changes&&c.changes.length>0&&d?(0,t.jsx)(r.Button,{onClick:()=>u(!0),prefix:(0,t.jsx)(a.CloudUpload,{size:16}),suffix:(0,t.jsx)(s.Badge,{className:"min-w-[28px]",size:"sm",variant:"blue",children:c.changes.length}),variant:"secondary",children:"Review Changes"}):null})}e.s(["ReviewChangesButton",()=>c])}]);

//# debugId=2be14a47-df70-cf6d-c317-b6120ae251f0
//# sourceMappingURL=f520238fda9d3287.js.map