;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="5f551c12-21e8-8015-da1a-fe15fd77b2cd")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4047087,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M1 2H1.75H14.25H15V3.5H14.25H1.75H1V2ZM1 12.5H1.75H14.25H15V14H14.25H1.75H1V12.5ZM1.75 7.25H1V8.75H1.75H14.25H15V7.25H14.25H1.75Z" fill="currentColor"/>');e.s(["MenuAlt",0,t])},4998750,e=>{"use strict";var t=e.i(2749380);function l(e){return null==e?"Please retry later":`${e.message??e}`}let r="$time";function a(e){let{variables:l,widgets:r,...a}=e;return{...a,variables:function(e){if(e)return{...e,time:e.time?(0,t.parseTime)(e.time):void 0}}(l),widgets:r?.map(e=>{let{query:{time:l,...r},...a}=e;return{type:"query-visualization",...a,query:{...r,time:(0,t.parseTime)(l)}}})}}function n(e){if(!e)return;let{time:t,...l}=e;return{...l,time:t?"string"==typeof t?t:{from:t.from.toISOString(),to:t.to.toISOString()}:void 0}}function i(e,t){return t?{...e,time:e.time===r&&t.time?t.time:e.time}:e}e.s(["DEFAULT_TIME_VALUE",0,"12h","TIME_VARIABLE",0,r,"extractError",()=>l,"parseNotebook",()=>a,"replaceVariables",()=>i,"serializeVariables",()=>n])},8673480,e=>{"use strict";function t(e,t){let{id:l,teamSlug:r}=t;return`${e.replace("{id}",l??"")}?${new URLSearchParams({slug:r}).toString()}`}function l(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return l=>{let r=l??{hasAccess:!0,notebooks:[]},a=r.notebooks.findIndex(t=>{let{id:l}=t;return l===e.id});return -1!==a?t?r.notebooks[a]=e:r.notebooks.splice(a,1):t&&r.notebooks.push(e),r}}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return r=>{if(!r)return{...e,widgets:t?[t]:void 0};let a={...r,...e};if(l&&(a.widgets=a.widgets?.filter(e=>{let{id:t}=e;return t!==l})),t){a.widgets||(a.widgets=[]);let e=a.widgets.findIndex(e=>{let{id:l}=e;return l===t.id});a.widgets=[...a.widgets.slice(0,e),t,...a.widgets.slice(e+1)]}return a}}e.s(["buildSWRKey",()=>t,"updateCachedList",()=>l,"updateCachedNotebook",()=>r])},9372366,e=>{"use strict";var t=e.i(4337458),l=e.i(854682),r=e.i(9667097),a=e.i(1283928),n=e.i(1233856),i=e.i(1176592),s=e.i(8690335),o=e.i(4919835),u=e.i(9486194),d=e.i(9429462),c=e.i(7722264),m=e.i(2107254),p=e.i(9668517),g=e.i(747275);let f=e=>{let{observabilityConfiguration:t}=(0,l.useHasObservabilityPlus)(),r=(0,p.useTeamSlug)(),{data:a,updateSearch:n,search:s}=(0,m.default)({limit:10,latestDeployments:null},{},r??void 0);return{decorate:(0,i.useCallback)(async e=>[...e,...a?.projects.map(e=>{let{id:t,name:l}=e;return{id:t,value:t,label:l}})??[]].map(e=>t?.observabilityPlus.excludedProjects?.some(t=>t.id===e.id)?{...e,disabled:!0,tooltip:"Excluded from Observability Plus"}:e),[t,a]),triggerMutation:async e=>{s!==e.text&&n(e.text)},dimensionId:"projectId"}},v=e=>{let{trigger:t}=(0,d.useDeploymentBadgeResolverMutation)(e);return{decorate:(0,i.useCallback)(async e=>{try{let l=await t();return(0,o.applyBadgesToDeploymentIds)(e,l)}catch{return e}},[t]),triggerMutation:()=>t().catch(()=>{}),dimensionId:"deploymentId"}},h=e=>{let{event:r,measure:a}=(0,s.splitEventAndMeasure)(e),n=(0,t.useSonarQueryScope)(),{hasObservabilityPlusAccess:i}=(0,l.useHasObservabilityPlus)();return{decorate:async(e,t)=>{let{dimension:l,text:s}=t;return n?[...e,...await x({event:r,measure:a,column:l.id,reason:i?"observability_query_builder_plus":"observability_query_builder_free",text:s,...n})]:[]},dimensionId:null}};async function x(e){let{event:t,measure:l,column:i,ownerId:o,reason:d,text:c}=e,m={minutes:5},p=(0,n.startOfDuration)(new Date(Date.now()-36e5),m),g=(0,n.endOfDuration)(new Date,m),f=s.labelColumnByColumn.get(i),v=u.staticDimensionValues.find(e=>e.dimensions.includes(i))?.values,h="number"===a.AllDimensions[i].type;if(v)return v.map(e=>({id:e.id.toString(),value:e.id,..."label"in e?{label:e.label}:{}})).sort((e,t)=>String(e.id).localeCompare(String(t.id)));let x=c?`contains(${f||i},'${c}')`:void 0;return(await (0,r.getSonarData)({event:t,scope:{type:"owner",ownerId:o},reason:d,startTime:p,endTime:g,rollups:{value:{measure:l,aggregation:"sum"}},filter:x,granularity:m,groupBy:f?[i,f]:[i],limit:10,tailRollup:"truncate",summaryOnly:!0})).summary.map(e=>{let t=h?Number.parseFloat(e[i]):e[i];return{id:t.toString(),label:f?e[f]:void 0,value:t}})}e.s(["getDimensionValues",()=>x,"useValuesResolver",0,e=>{let t,l,r,{decorate:a,triggerMutation:n}=(t=[h,f,v].map(t=>t(e)),(l=(0,i.useRef)(t)).current=t,r=e=>l.current.filter(t=>null===t.dimensionId||t.dimensionId===e.dimension.id),{decorate:async(e,t)=>{let l=e;for(let e of r(t))l=await e.decorate(l,t);return l},triggerMutation:e=>Promise.all(r(e).map(t=>t.triggerMutation?.(e)))});return async e=>{let{dimension:t,text:l}=e;try{n({dimension:t,text:l});let e=await a([],{dimension:t,text:l});return(0,g.default)(e,"id")}catch(e){return console.error(`Error fetching dimension values. ${(0,c.isError)(e)?e.message:""}`,e),[]}}}])},7867910,e=>{"use strict";var t=e.i(1176592);function l(e,l){(0,t.useEffect)(()=>{let t=t=>{let r=document.activeElement,a=r&&["input","select","textarea"].includes(r.tagName.toLowerCase());t.key.toLowerCase()!==l||a||t.ctrlKey||t.metaKey||(t.preventDefault(),e())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,l])}e.s(["useHotkey",()=>l])},5627633,e=>{"use strict";var t=e.i(8238153),l=e.i(8492421);let r=["years","months","weeks","days","hours","minutes","seconds"];function a(e,a){let n=(0,l.getDefaultOptions)(),i=a?.locale??n.locale??t.defaultLocale,s=a?.format??r,o=a?.zero??!1,u=a?.delimiter??" ";return i.formatDistance?s.reduce((t,l)=>{let r=`x${l.replace(/(^.)/,e=>e.toUpperCase())}`,a=e[l];return void 0!==a&&(o||e[l])?t.concat(i.formatDistance(r,a)):t},[]).join(u):""}e.s(["formatDuration",()=>a])},3675495,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M11.4749 1.33217L11.1964 2.02853L6.19636 14.5285L5.91781 15.2249L4.5251 14.6678L4.80364 13.9714L9.80364 1.47144L10.0822 0.775085L11.4749 1.33217ZM4 5.49999C4.82843 5.49999 5.5 4.82841 5.5 3.99999C5.5 3.17156 4.82843 2.49999 4 2.49999C3.17157 2.49999 2.5 3.17156 2.5 3.99999C2.5 4.82841 3.17157 5.49999 4 5.49999ZM7 3.99999C7 5.65684 5.65685 6.99999 4 6.99999C2.34315 6.99999 1 5.65684 1 3.99999C1 2.34313 2.34315 0.999986 4 0.999986C5.65685 0.999986 7 2.34313 7 3.99999ZM13.5 12C13.5 12.8284 12.8284 13.5 12 13.5C11.1716 13.5 10.5 12.8284 10.5 12C10.5 11.1716 11.1716 10.5 12 10.5C12.8284 10.5 13.5 11.1716 13.5 12ZM12 15C13.6569 15 15 13.6568 15 12C15 10.3431 13.6569 8.99999 12 8.99999C10.3431 8.99999 9 10.3431 9 12C9 13.6568 10.3431 15 12 15Z" fill="currentColor"/>');e.s(["Percentage",0,t])},9192216,e=>{"use strict";var t=e.i(8711407),l=e.i(4004502),r=e.i(9376050),a=e.i(9689002),n=e.i(5255926),i=e.i(8735244),s=e.i(5883567),o=e.i(6143247),u=e.i(1176592);function d(e){let{label:s,options:d,isLoading:p,isSelected:g,onChange:f,onSearch:v,parseNewValue:h,getId:x,getValue:b,value:y,open:C,reverse:j,allowEmptyAdd:w=!1,addLabel:N="Add",...S}=e,[V,k]=(0,u.useState)(""),[O,D]=(0,u.useState)(!1),[I,A]=(0,u.useState)(!1),F=(0,u.useRef)(null),M=(0,u.useRef)(null),P=(0,u.useRef)(0);(0,u.useEffect)(()=>{y&&C&&setTimeout(()=>{let e=M.current?.querySelector(`[data-value="${b(y)}"]`);e?.scrollIntoView({block:"start"})},50)},[C]);let B=(0,u.useMemo)(()=>d?.length?`Find ${s}...`:`Enter ${s}`,[d,s]),{selected:L,groups:$}=(0,u.useMemo)(()=>{let e={selected:[],groups:{}};for(let t of d??[])if(g?.(t))e.selected.push(t);else{let l=t.group??"";l in e.groups||(e.groups[l]=[]),e.groups[l].push(t)}return e},[d,g]),E=(0,u.useMemo)(()=>h&&(V.length>0?(d??[]).every(e=>x(e)!==V):w),[V,d,x,h,w]),T=(0,u.useCallback)(e=>{if(h){let t=h(e);null===t?D(!0):(f(t),k(""),F.current?.focus())}},[f,h]),H=(0,u.useCallback)(e=>{k(e),D(!1),clearTimeout(P.current),v&&(P.current=setTimeout(()=>{A(!0),v(e).finally(()=>A(!1))},250))},[v]),R=(0,u.useCallback)(e=>{if("Tab"===e.key)e.key=e.shiftKey?"ArrowUp":"ArrowDown";else if(" "===e.key&&0===V.trim().length){e.preventDefault();let t=M.current?.querySelector('[aria-selected="true"] input[type="checkbox"]');t?.click()}},[V]);return(0,t.jsxs)(r.Command,{className:(0,o.cn)("w-100 rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu flex",j?"flex-col-reverse":"flex-col"),loop:!0,onKeyDown:R,children:[(0,t.jsxs)("div",{className:(0,o.cn)("flex w-full items-center justify-between px-4 py-3",d?.length!==0&&"border-b"),children:[(0,t.jsx)(r.Command.Input,{className:(0,o.cn)("w-full border-none bg-transparent text-sm outline-none",O&&"text-[--geist-error]"),onValueChange:H,placeholder:B,ref:F,value:V}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-[14px] flex justify-center",children:I&&(0,t.jsx)(i.Spinner,{size:14})}),(0,t.jsx)(a.Kbd,{small:!0,children:"Esc"})]})]}),(0,t.jsxs)(r.Command.List,{className:"flex max-h-[288px] w-full flex-col overflow-y-auto",ref:M,children:[d&&!p?(0,t.jsxs)(t.Fragment,{children:[L.length?(0,t.jsx)(c,{addBorder:!0,getId:x,getValue:b,items:L,onChange:f,setSearch:k,...S}):null,Object.entries($).map(e=>{let[l,r]=e;return(0,t.jsx)(c,{getId:x,getValue:b,heading:l,items:r,onChange:f,setSearch:k,...S},l)})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 p-2","data-testid":(0,l.tid)("command-menu","loading"),children:[(0,t.jsx)(n.Skeleton,{className:"h-4",width:"100%"}),(0,t.jsx)(n.Skeleton,{className:"h-4",width:"100%"}),(0,t.jsx)(n.Skeleton,{className:"h-4",width:"100%"})]}),!p&&!I&&d&&(0,t.jsxs)(r.Command.Empty,{className:"px-4 py-3 text-center text-sm text-gray-900",children:["No matching ",s.toLowerCase()]}),E?(0,t.jsx)(m,{onAddNew:T,search:V,addLabel:N,allowEmptyAdd:w,label:s}):null]})]})}function c(e){let{heading:l,items:a,setSearch:n,renderItem:i,getId:s,getValue:u,onChange:d,addBorder:c}=e;return a.length?(0,t.jsx)(r.Command.Group,{className:(0,o.cn)("h-full p-1.5  [&>[cmdk-group-heading]]:px-2 [&>[cmdk-group-heading]]:pb-1 [&>[cmdk-group-heading]]:pt-0.5 [&>[cmdk-group-heading]]:text-xs [&>[cmdk-group-heading]]:text-gray-800",c&&"border-b"),heading:l,children:a.map(e=>(0,t.jsx)(r.Command.Item,{className:"w-full cursor-pointer rounded-md text-sm *:aria-selected:rounded  *:aria-selected:bg-gray-100 focus-visible:bg-gray-100 active:bg-gray-100",onSelect:()=>{d(e),n("")},value:u(e),children:i(e)},s(e)))}):null}function m(e){let{search:l,onAddNew:a,addLabel:n,allowEmptyAdd:i,label:o}=e,u=l.length>0?`${n} "${l}"`:i?`${n} new ${o}`:"",d=l.length>0?l:"new-item";return(0,t.jsx)(r.Command.Group,{className:"sticky bottom-0 z-10 rounded-b-lg border-t outline-none -mt-px",children:(0,t.jsx)(r.Command.Item,{"aria-label":u,className:"flex w-full cursor-pointer bg-white items-center p-1 text-gray-900 *:aria-selected:rounded *:aria-selected:bg-gray-100 focus-visible:bg-gray-100 active:bg-gray-100",onSelect:()=>a(l||""),value:d,children:(0,t.jsxs)("div",{className:"flex w-full items-center gap-2 p-1.5",children:[(0,t.jsx)(s.PlusCircle,{size:14}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:u})]})})})}e.s(["CommandMenu",()=>d])},5376857,8569407,e=>{"use strict";let t=(0,e.i(1176592).createContext)(null);t.displayName="FilterBarContext",e.s(["FilterBarContext",0,t],5376857);var l=e.i(8711407),r=e.i(2504781),a=e.i(1971436),n=e.i(6143247);function i(e){let{iconOnly:t,...i}=e;return(0,l.jsx)(r.Button,{"aria-label":"Add filter",prefix:t?void 0:(0,l.jsx)(a.FilterSmall,{}),shape:t?"square":void 0,size:"small",...i,className:(0,n.cn)("!text-gray-900 hover:!text-gray-1000 data-[state='open']:!bg-gray-100",!t&&"!pl-2",i.className),type:"tertiary",typeName:"button",children:t?(0,l.jsx)(a.FilterSmall,{}):"Add filter"})}e.s(["AddFilter",()=>i],8569407)},1482596,8815885,2789287,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),r=e.i(5376857),a=e.i(8569407),n=e.i(2504781),i=e.i(9096446),s=e.i(6143247),o=e.i(4004502),u=e.i(1821888),d=e.i(9722978),c=e.i(3869281),m=e.i(5468328),p=e.i(3306538),g=e.i(9192216),f=e.i(5778089);let v=e=>{let{label:t,id:l}=e;return`${l}${t?`
${t}`:""}`};function h(e){let{values:r,options:a,label:i,rounded:s=!1,size:o="small",onOpenChange:m,onChange:h,onSearch:b,open:y,className:C,parseNewValue:j,children:w,disabled:N,availableOperators:S}=e,V=(0,l.useCallback)(e=>r.some(t=>{let{id:l}=t;return l===e.id}),[r]),k=(0,l.useCallback)(e=>{let l="string"==typeof e.label&&e.label.length>0,r=l?e.label:e.id;return(0,t.jsx)(x,{text:e.tooltip,children:(0,t.jsxs)("div",{className:(0,d.clsx)("flex w-full items-center gap-2 px-2 py-1.5",e.disabled&&"cursor-not-allowed opacity-75"),onClick:t=>{let l=document.getSelection();if(l?.isCollapsed===!1){t.preventDefault(),t.stopPropagation();return}t.target.closest("label")&&(t.preventDefault(),t.stopPropagation(),h(e,!0))},children:[!S||S.some(e=>"multiple"===e.type||"array"===e.type)?(0,t.jsx)(c.Checkbox,{checked:V(e),disabled:e.disabled,onChange:()=>void 0,tabIndex:-1}):null,(0,t.jsx)("div",{className:"flex min-w-0 flex-1 max-w-[min(32rem,75vw)] flex-col items-start",children:l&&e.label!==e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"w-full truncate font-medium leading-tight",title:e.label,children:e.label}),(0,t.jsx)("span",{className:"w-full truncate text-sm text-gray-800 leading-tight",title:e.id,children:e.id})]}):""===r?(0,t.jsx)("span",{className:"text-sm text-gray-800",children:f.emptyStringReplacement}):(0,t.jsx)("span",{className:"w-full truncate",title:r,children:r})}),e.badge?(0,t.jsx)("div",{className:"ml-2 shrink-0",children:(0,t.jsx)(x,{text:e.badge.tooltip,children:(0,t.jsx)(p.Badge,{size:"sm",...e.badge})})}):null]})})},[h,V,S]);return(0,t.jsxs)(u.Root,{modal:!0,onOpenChange:m,open:y,children:[(0,t.jsx)(u.Anchor,{className:"flex",children:(0,t.jsx)(u.Trigger,{asChild:!0,children:w||(0,t.jsx)(n.Button,{className:(0,d.clsx)("!ring-1 ring-gray-400 focus:z-10 focus:ring-gray-500",!s&&"rounded-[0!important]","left"===s&&"rounded-r-[0!important]","right"===s&&"rounded-l-[0!important]",N&&"bg-[var(--themed-bg)!important]",C),disabled:N,size:o,type:"secondary",typeName:"button",children:(0,f.getValueLabel)(r,i)})})}),(0,t.jsx)(u.Portal,{children:(0,t.jsx)(u.Content,{align:"start",className:"tailwind-preflight",onCloseAutoFocus:()=>m(!1),sideOffset:8,children:(0,t.jsx)(g.CommandMenu,{getId:f.getValueId,getValue:v,isSelected:V,label:i,onChange:h,onSearch:b,options:a,parseNewValue:j,renderItem:k})})})]})}function x(e){let{text:l,children:r}=e;return l?(0,t.jsx)(m.Tooltip,{className:"w-full",text:l,children:r}):r}var b=e.i(6198010);let y=e=>{let{id:t}=e;return t},C=e=>{let{label:t,group:l}=e;return`${t}${l?` ${l}`:""}`},j=e=>(0,t.jsxs)("div",{className:"flex w-full items-center gap-2 rounded px-2 py-1.5",children:["icon"in e&&e.icon?(0,t.jsx)(e.icon,{className:"size-4"}):null,e.label]});function w(e){let{label:l,value:r,options:a,onOpenChange:i,open:s,onChange:o,isLoading:c,rounded:m=!1,size:p="small",className:f,children:v,disabled:h,prefix:x,suffix:w,id:N}=e;return(0,t.jsxs)(u.Root,{modal:!0,onOpenChange:i,open:s,children:[(0,t.jsx)(u.Anchor,{className:"flex",children:(0,t.jsx)(u.Trigger,{asChild:!0,children:v||(0,t.jsx)(n.Button,{id:N,"aria-label":`Select ${l}`,className:(0,d.clsx)("!px-1",!m&&"rounded-[0!important]","left"===m&&"rounded-r-[0!important]","right"===m&&"rounded-l-[0!important]",h&&"bg-[var(--themed-bg)!important]",f),disabled:h,prefix:r&&"icon"in r&&r.icon?(0,t.jsx)(r.icon,{className:"size-4"}):x,size:p,suffix:w,type:"secondary",typeName:"button",children:r?r.label:(0,t.jsx)(b.Plus,{"aria-label":`Select ${l}`})})})}),(0,t.jsx)(u.Portal,{children:(0,t.jsx)(u.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsx)(g.CommandMenu,{getId:y,getValue:C,isLoading:c,label:l,onChange:o,open:s,options:a,renderItem:j,value:r})})})]})}e.s(["SingleFilterPopoverBox",()=>w],8815885);var N=e.i(8914449);function S(e){let t=(0,l.useContext)(r.FilterBarContext);if(!t)throw Error("Missing FilterBarContext.Provider in the React tree");return(0,N.useStore)(t,e)}function V(e){let{value:{value:r}={id:"",value:""},onChange:a,onToggle:n,disabled:i,ref:s}=e,[o,u]=(0,l.useState)(r);return(0,t.jsx)("div",{className:"focus:border-rounded -my-px flex items-center border bg-background-100 px-2",children:(0,t.jsx)("input",{"aria-label":"input value",className:(0,d.clsx)("block w-full bg-background-100 focus:outline-none focus:ring-transparent sm:text-sm",i&&"bg-[--themed-bg] text-gray-700"),disabled:i,onBlur:()=>{o!==r&&a((0,f.toValueObj)(o)),n(!1)},onChange:e=>u(e.target.value),onFocus:()=>n(!0),ref:s,type:"text",value:o.toString()})})}function k(e){let{index:r}=e,a=S(e=>e.filters),u=S(e=>e.removeFilter),d=S(e=>e.chooseValue),c=S(e=>e.chooseOperator),m=S(e=>e.searchValues),p=S(e=>e.toggleFilter),g=S(e=>e.edited),v=S(e=>e.config.dimensions),x=S(e=>e.disabled),b=(0,l.useRef)(null),{open:y,dimension:C,values:j,operator:N,availableValues:k,availableOperators:O,parseValue:D}=(0,l.useMemo)(()=>({open:null,availableValues:void 0,availableOperators:void 0,parseValue:void 0,values:a[r]?.values??[],operator:a[r]?.operator,...g?.index===r?g:{},dimension:v.find(e=>{let{id:t}=e;return t===a[r]?.dimension})??v[0]}),[g,a,r,v]),I=(0,l.useCallback)(e=>{e&&"value"===y||p(e?"value":null,r)},[r,p,y]),A=(0,l.useCallback)(e=>void p(e?"operator":null,r),[r,p]);return(0,l.useEffect)(()=>{"match"===N.type&&"value"===y&&setTimeout(()=>b.current?.focus(),100)},[y,N.type]),(0,t.jsxs)("div",{className:"flex h-8 items-stretch","data-testid":(0,o.tid)("filter-bar","cascading-filter"),children:[(0,t.jsx)("div",{className:"rounded-l-md bg-background-100 px-2 py-1.5 text-sm font-normal shadow-border",children:(0,f.renderItem)(C,!0)}),(0,t.jsx)(w,{className:"!font-normal !ring-1 ring-gray-400 focus:ring-gray-500",disabled:x,label:"operator",onChange:c,onOpenChange:A,open:"operator"===y,options:O,value:N}),"match"===N.type&&(0,t.jsx)(V,{disabled:x,onChange:d,onToggle:I,ref:b,value:j[0]}),"match"!==N.type&&"valueless"!==N.type&&(0,t.jsx)(h,{disabled:x,label:C.label,onChange:d,onOpenChange:I,onSearch:m,open:"value"===y,options:k,parseNewValue:D,values:j,availableOperators:O}),(0,t.jsx)(n.Button,{"aria-label":"Remove filter",className:(0,s.cn)("!px-0.5 !ring-1 ring-gray-400 hover:!text-gray-1000 focus:ring-gray-500",x?"bg-[var(--themed-bg)!important]":"!text-gray-900"),disabled:x,onClick:()=>u(r),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(i.CrossSmall,{size:"small"})})]})}function O(){let{dimension:e,operator:l,availableValues:r,availableOperators:n,values:i,parseValue:s}=S(e=>e.edited??{dimension:null,operator:null,availableValues:[],availableOperators:[],values:[],parseValue:void 0}),o=S(e=>e.config.dimensions),u=S(e=>e.edited?.index===null?e.edited.open:null),d=S(e=>e.startNewFilter),c=S(e=>e.chooseDimension),m=S(e=>e.chooseOperator),p=S(e=>e.chooseValue),g=S(e=>e.searchValues),f=S(e=>e.disabled);return e?l?(0,t.jsx)(h,{label:e.label,onChange:p,onOpenChange:d,onSearch:g,open:"value"===u,options:r,parseNewValue:s,values:i,availableOperators:n,children:(0,t.jsx)(a.AddFilter,{disabled:f})}):(0,t.jsx)(w,{label:"operator",onChange:m,onOpenChange:d,open:"value"===u,options:n,children:(0,t.jsx)(a.AddFilter,{disabled:f})}):(0,t.jsx)(w,{label:"dimension",onChange:e=>void c(e),onOpenChange:d,open:"operator"===u,options:o,children:(0,t.jsx)(a.AddFilter,{disabled:f})})}function D(e){let{renderFilter:r,addFilter:a}=e,n=S(e=>e.filters);return(0,t.jsxs)("div",{className:"items-top tailwind-preflight flex flex-wrap gap-2",children:[n.map((e,a)=>(0,t.jsx)(l.Fragment,{children:(r||(e=>e))((0,t.jsx)(k,{index:a}),e,a)},a)),a||(0,t.jsx)(O,{})]})}e.s(["useStore",()=>S],2789287);var I=e.i(1154851);function A(e,t,l){let{edited:r}=l();t({edited:r?.index===e?null:r})}function F(e,t,l,r){let{filters:a,edited:n,onChange:i}=r(),s=t?.operator?.type==="valueless",o=void 0===t||s||t.values?.length?[...a.slice(0,e),t?{...a[e],...t}:void 0,...a.slice(e+1)].filter(e=>void 0!==e):a;l({filters:o,edited:t&&n?{...n,operator:t.operator??n.operator,values:t.values??n.values}:null}),i(o)}function M(e,t){let{dimensions:l}=t;return l.find(t=>{let{id:l}=t;return e?.dimension===l})}function P(e,t,l,r){let{valuesByDimension:a,edited:n}=r(),i=[...a[e.id]??[]],s=new Set(i.map(e=>{let{id:t}=e;return t})),o=!(e.id in a);for(let e of t)s.has(e.id)||(s.add(e.id),i.push(e),o=!0);o&&(n?.dimension?.id===e.id&&l({edited:{...n,availableValues:i}}),l({valuesByDimension:{...a,[e.id]:i}}))}function B(e){return"stringArray"===e.type?e=>{let{type:t}=e;return"array"===t||"valueless"===t}:"boolean"===e.type?e=>{let{type:t}=e;return"single"===t||"valueless"===t}:"number"===e.type?e=>{let{type:t}=e;return"multiple"===t||"single"===t||"numerical"===t||"valueless"===t}:e=>{let{type:t}=e;return"multiple"===t||"single"===t||"match"===t||"valueless"===t}}async function L(e,t){let{filters:l,config:r}=t(),a=new Set;for(let e of l){let l=M(e,r);!l||l.id in t().valuesByDimension||a.add(l)}for(let n of(await Promise.allSettled([...a].map(async l=>{P(l,await $({dimension:l},r.resolveValues),e,t)})),l)){let l=M(n,r);"match"!==n.operator.type&&l&&P(l,n.values,e,t)}e({filters:l.map(e=>({...e,values:e.values.map(l=>t().valuesByDimension[e.dimension]?.find(e=>e.id===l.id)??l)}))})}async function $(e,t){let l=t?.(e);return l instanceof Object&&"then"in l?await l??[]:l??[]}function E(e,t){return JSON.stringify(e)===JSON.stringify(t)}function T(e){let{renderFilter:a,addFilter:n,...i}=e,s=(0,l.useRef)((0,I.createStore)()((e,t)=>({config:{dimensions:[],operators:[]},filters:[],onChange:()=>void 0,disabled:!1,operatorUponCreation:!1,autoSelectSingleDimension:!1,edited:null,valuesByDimension:{},setProps:async l=>{let{onChange:r,disabled:a,config:n,filters:i,operatorUponCreation:s,autoSelectSingleDimension:o}=l,u=t();if(a!==u.disabled&&e({disabled:a}),r!==u.onChange&&e({onChange:r}),s!==u.operatorUponCreation&&e({operatorUponCreation:s}),o!==u.autoSelectSingleDimension&&e({autoSelectSingleDimension:o}),E(u.config,n)&&n.resolveValues===u.config.resolveValues&&n.createValue===u.config.createValue&&n.resolveOperators===u.config.resolveOperators)E(u.filters,i)||(e({filters:i}),await L(e,t));else{e({config:n,filters:i,edited:null});let l=i.filter(e=>{let{dimension:t}=e;return n.dimensions.some(e=>{let{id:l}=e;return l===t})});E(i,l)||(e({filters:l}),r(l)),await L(e,t)}},toggleFilter:async(l,r)=>{let{config:a,disabled:n,edited:i,filters:s,valuesByDimension:o}=t(),u=s[r],d=M(u,a);!n&&u&&d&&(l||i?.index===null||i?.values.length!==0||F(i.index,void 0,e,t),e({edited:l?{index:r,operator:u.operator,values:u.values,open:l,dimension:d,availableOperators:a.operators.filter(B(d)),availableValues:o[d.id],parseValue:(0,f.makeParseValue)(d)}:null}),P(d,await $({dimension:d},a.resolveValues),e,t))},startNewFilter:l=>{let{config:r,disabled:a,edited:n,filters:i,operatorUponCreation:s,autoSelectSingleDimension:o,valuesByDimension:u}=t();if(!a){if(l&&o&&1===r.dimensions.length){let l=r.dimensions[0],a="stringArray"===l.type?r.defaultArrayOperator:r.defaultSingleOperator;e({edited:{index:null,open:"value",dimension:l,operator:s?void 0:a,values:[],availableOperators:r.operators.filter(B(l)),availableValues:u[l.id],parseValue:(0,f.makeParseValue)(l)}}),$({dimension:l},r.resolveValues).then(r=>P(l,r,e,t));return}if(e({edited:l?{index:null,open:"operator",operator:s?void 0:r.defaultSingleOperator,values:[],availableOperators:r.operators}:null}),n?.dimension&&(n.operator?.type==="multiple"||n.operator?.type==="array")){let{values:l,operator:r,dimension:{id:a}}=n;l.length&&F(i.length,{values:l,operator:r,dimension:a},e,t)}}},chooseDimension:async l=>{let{config:r,edited:a,valuesByDimension:n,operatorUponCreation:i}=t();if(!a)return;let s="stringArray"===l.type?r.defaultArrayOperator:r.defaultSingleOperator;e({edited:{...a,open:"value",dimension:l,operator:i?void 0:s,parseValue:(0,f.makeParseValue)(l),availableValues:n[l.id],availableOperators:r.operators.filter(B(l))}}),P(l,await $({dimension:l},r.resolveValues),e,t)},chooseOperator:async l=>{let{edited:r,filters:a}=t();if(!r)return;if(null===r.index)return void("valueless"===l.type&&r.dimension?(e({edited:null}),F(a.length,{dimension:r.dimension.id,operator:l,values:[]},e,t)):e({edited:{...r,open:"value",operator:l}}));if(r.operator?.type==="valueless"&&"valueless"!==l.type){let t={...r,operator:l,open:null};return e({edited:t}),await new Promise(e=>{setTimeout(e,50)}),e({edited:{...t,open:"value"}})}let n=r.values;"multiple"!==l.type&&r.values.length>1&&(n=r.values.slice(0,1)),"valueless"===l.type&&(n=[]),F(r.index,{...a[r.index],operator:l,values:n},e,t),A(r.index,e,t)},chooseValue:(l,r)=>{let{config:a,filters:n,edited:i}=t();if(!i||!i.dimension||!i.operator)return;let{dimension:s,operator:o,values:u}=i;if(function(e,t){let{value:l}=e;return"number"===t.type&&("number"!=typeof l||Number.isNaN(l))||"boolean"===t.type&&!0!==l&&!1!==l}(l,s))return;let d={values:u,operator:o},c=!1;"match"===o.type?d.values=[l]:(u.every(e=>{let{id:t}=e;return t!==l.id})?(P(s,[l],e,t),"multiple"===o.type||"array"===o.type?d.values=[...u,l]:r?(d.values=[...u,l],d.operator=a.defaultMultiOperator):d.values=[l]):(d.values=u.filter(e=>{let{id:t}=e;return t!==l.id}),r&&"multiple"===o.type&&d.values.length<2&&(d.operator=a.defaultSingleOperator)),c=!r),null===i.index?r?e({edited:{...i,...d}}):(d.values.length&&F(n.length,{dimension:i.dimension.id,...d},e,t),e({edited:null})):(0===d.values.length&&c?F(i.index,void 0,e,t):F(i.index,d,e,t),c&&A(i.index,e,t))},searchValues:async l=>{let{config:r,edited:a}=t();if(!a?.dimension)return;let{dimension:n}=a,i=await $({dimension:n,text:l},r.resolveValues);P(n,i,e,t)},removeFilter:l=>{let{disabled:r,filters:a}=t();!r&&a[l]&&F(l,void 0,e,t)},resetOperator:()=>{let{disabled:l,edited:r}=t();!l&&r&&r.dimension&&e({edited:{...r,operator:void 0,values:[],open:"operator"}})},resetDimension:()=>{let{disabled:l,edited:r,config:a}=t();!l&&r&&e({edited:{index:null,values:[],open:"operator",availableOperators:a.operators}})}}))),o=(0,l.useMemo)(()=>i,[i]);return(0,l.useEffect)(()=>{s.current.getState().setProps(o)},[o]),(0,t.jsx)(r.FilterBarContext.Provider,{value:s.current,children:(0,t.jsx)(D,{renderFilter:a,addFilter:n})})}e.s(["FilterBar",()=>T],1482596)}]);

//# debugId=5f551c12-21e8-8015-da1a-fe15fd77b2cd
//# sourceMappingURL=32c5e495de7dbf6c.js.map