;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="318bdaad-d929-d532-3131-e0795a8690fc")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2128692,e=>{"use strict";var t=e.i(4998750),r=e.i(4244280),i=e.i(9668517),n=e.i(5338940),l=e.i(9979783),a=e.i(119294),s=e.i(6352514),o=e.i(1176592),u=e.i(5757634),c=e.i(4005781),d=e.i(8673480),m=e.i(2749380);function g(e){let{mutate:g}=(0,u.useSWRConfig)(),p=(0,i.useTeamSlug)()??"",{team:f}=(0,n.useTeam)(),b=f?.id,x=f?.billing?.plan??"hobby",h=(0,d.buildSWRKey)(r.API_NOTEBOOK,{id:e?.id,teamSlug:p}),y=(0,d.buildSWRKey)(r.API_NOTEBOOKS,{teamSlug:p}),{trigger:v,isMutating:w}=(0,c.default)(h,async(i,n)=>{let{arg:a}=n,s=a.id??e?.id;if(!s)throw Error("Notebook ID is required to save a notebook");return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK,"put",{id:s,slug:p},{title:a.title,variables:(0,t.serializeVariables)(a.variables)},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:j,isMutating:N}=(0,c.default)(h,async(t,i)=>{let{arg:n}=i,a=n?.id??e?.id;if(!a)throw Error("Notebook ID is required to delete a notebook");return(0,l.typedFetchData)(r.API_NOTEBOOK,"delete",{id:a,slug:p},{throwOnHTTPError:!0})},{revalidate:!1}),{trigger:E,isMutating:k}=(0,c.default)(h,async(i,n)=>{let{arg:a}=n,s=a?.id??e?.id;if(!s)throw Error("Notebook ID is required to share a notebook");return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK_SHARE,"put",{id:s,slug:p},{},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:R,isMutating:S}=(0,c.default)(h,async(i,n)=>{let{arg:a}=n,s=a.notebookId??e?.id;if(!s)throw Error("Notebook ID is required to save a notebook widget");let{id:o,query:u,...c}=a.widget;return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK_WIDGET,"put",{id:s,slug:p,widgetId:o},{query:(0,m.serializeQuery)(u),...c},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:M,isMutating:C}=(0,c.default)(h,async(i,n)=>{let{arg:a}=n,s=a.notebookId??e?.id;if(!s)throw Error("Notebook ID is required to remove a notebook widget");return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK_WIDGET,"delete",{id:s,slug:p,widgetId:a.id},{throwOnHTTPError:!0}))},{revalidate:!1}),O=(0,o.useCallback)(async e=>(await Promise.all([g((0,d.buildSWRKey)(r.API_NOTEBOOK,{id:e.id,teamSlug:p}),e),g((0,d.buildSWRKey)(r.API_NOTEBOOKS,{teamSlug:p}),(0,d.updateCachedList)(e))]),e),[p,g]);return{saveNotebook:async e=>{let t=await O(await v(e,{optimisticData:(0,d.updateCachedNotebook)(e),rollbackOnError:!0}));return a.analytics.track(s.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"title_edited",source:"notebook-details-page"}),t},deleteNotebook:async t=>{await j(t),a.analytics.track(s.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_DELETED,{teamId:b,plan:x,source:"notebook-details-page"});let r=t?.id??e?.id;return await g(y,(0,d.updateCachedList)({id:r},!1)),null},shareNotebook:async e=>{let t=O(await E(e));return a.analytics.track(s.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"notebook_shared",source:"notebook-details-page"}),t},saveWidget:async(e,t)=>{let r=await O(await R(e,{optimisticData:(0,d.updateCachedNotebook)({},e.widget),rollbackOnError:!0}));return a.analytics.track(s.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"new"===e.widget.id?"widget_added":"widget_edited",source:t??"notebook-details-page"}),r},removeWidget:async e=>{let t=await O(await M(e,{optimisticData:(0,d.updateCachedNotebook)({},null,e.id),rollbackOnError:!0}));return a.analytics.track(s.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"widget_removed",source:"notebook-details-page"}),t},isSaving:w||N||k||S||C}}e.s(["useNotebookOperations",()=>g])},3886311,e=>{"use strict";var t=e.i(1176592),r=e.i(9179929),i=e.i(6029070),n=e.i(2923544),l=e.i(1283928),a=e.i(5115727),s=e.i(4950960),o=e.i(8690335),u=e.i(9935315),c=e.i(2655172),d=e.i(5778089);function m(e){return e.replace(/[^a-zA-Z0-9\s]/g,"").trim().split(/\s+/).map((e,t)=>0===t?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("")}function g(e,t){let r=e[t];return null==r||""===r?d.emptyStringReplacement:String(r)}var p=e.i(5338940),f=e.i(119294),b=e.i(6352514);let x={metric:"",aggregation:"sum",by:[],time:"1h",filter:""};function h(e){let{query:d,title:h}=e,y=d??x,{team:v}=(0,p.useTeam)(),w=(0,a.useDefaultQueryTitle)(y),j=h??w,N=(0,t.useMemo)(()=>d?(0,o.toSonarQuery)(d):void 0,[d]),{data:E}=(0,u.useSonarQuery)(N),k=(0,t.useMemo)(()=>({meta:{timeseries:{by:y.by,lowGranularity:!0}}}),[y.by]),R=(0,r.useTableData)(E,k),{accessibleDimensions:S}=(0,i.useAccessibleDimensions)(y),{event:M,measure:C}=(0,t.useMemo)(()=>(0,o.splitEventAndMeasure)(y),[y]),O=l.AllMeasures[C],T=(0,n.labelForMeasure)(M,C),I=(0,t.useMemo)(()=>{let e=O?.unit??"count";return(0,o.getFormatter)(y.aggregation,e)},[O?.unit,y.aggregation]),A=s.aggregationMappings[y.aggregation].label,D=`${T} ${A}`,B=(0,t.useMemo)(()=>y.by.map(e=>o.labelColumnByColumn.get(e)??e),[y.by]),F=(0,t.useMemo)(()=>y.by.map(e=>{let t=S.find(t=>t.id===e);return t?.label??e}),[S,y.by]),P=y.by.length>0,q=!!R?.length,_=!!E?.data?.length;return{handleExport:(0,t.useCallback)(e=>{var t,r;let i,n,l,a,s;if(!E||!d)return;if(P){if(!R||0===R.length)return;"csv"===e?(i=function(e){let{rows:t,dimensionAccessors:r,dimensionLabels:i,valueHeader:n,measureFormatter:l}=e,a=[...i,n,`${n} (formatted)`],s=t.map(e=>{let t=r.map(t=>g(e,t)),i=e.value??null,n=null===i?"":l(i??0);return[...t,null===i?"":String(i),n]});return(0,c.csvFormatRows)([a,...s])}({rows:R,dimensionAccessors:B,dimensionLabels:F,valueHeader:D,measureFormatter:I}),n="text/csv",l="csv"):(i=function(e){let{rows:t,dimensionAccessors:r,dimensionLabels:i,valueHeader:n,measureFormatter:l}=e;return JSON.stringify(t.map(e=>{let t={};r.forEach((r,n)=>{t[m(i[n])]=g(e,r)});let a=e.value??null;return t[m(n)]=a,t[`${m(n)}Formatted`]=null===a?null:l(a??0),t}),null,2)}({rows:R,dimensionAccessors:B,dimensionLabels:F,valueHeader:D,measureFormatter:I}),n="application/json",l="json")}else{if(!E.data||0===E.data.length)return;if("csv"===e){let e,t,r;e=E.data||[],t=["timestamp",j,...d.by],r=e.map(e=>{let t=[e.timestamp.toISOString(),e.value?.toString()??""];for(let r of d.by){let i=e[r];t.push(i?.toString()??"")}return t}),i=(0,c.csvFormatRows)([t,...r]),n="text/csv",l="csv"}else i=JSON.stringify((E.data||[]).map(e=>{let{timestamp:t,value:r,...i}=e;return{timestamp:t.toISOString(),value:r??null,...i}}),null,2),n="application/json",l="json"}let o=function(e){let{title:t,results:r,extension:i}=e,n=r.data||[];if(0===n.length)return`${t}.${i}`;let l=[t,"-",new Date(Math.min(...n.map(e=>e.timestamp.getTime()))).toISOString().slice(0,10),"to",new Date(Math.max(...n.map(e=>e.timestamp.getTime()))).toISOString().slice(0,10)].filter(Boolean);return`${l.join(" ")}.${i}`}({title:j,results:E,extension:l});t=i,r=n,a=`data:${r},${encodeURIComponent(t)}`,(s=document.createElement("a")).setAttribute("href",a),s.setAttribute("download",o),document.body.appendChild(s),s.click(),document.body.removeChild(s),f.analytics.track(b.AnalyticsEvent.QUERY_BUILDER_EXPORTED,{teamId:v?.id,plan:v?.billing?.plan??"hobby",format:e,hasGroupBy:P})},[E,d,P,R,B,F,D,I,j,v?.id,v?.billing?.plan]),disabled:!d||(P?!q:!_)}}e.s(["useExportSonarData",()=>h],3886311)},2863467,e=>{"use strict";var t=e.i(8711407),r=e.i(4998750),i=e.i(2749380),n=e.i(3551360),l=e.i(8119470),a=e.i(1794286),s=e.i(7432042);function o(e){let{value:o,onChange:u,disabled:c,trackEvents:d,variables:m}=e,{start:g,end:p}=(0,i.fromTimeToRange)(o),f=(0,l.subDays)(new Date,90),b=(0,i.getTimeRangePresets)(!0,m?.time?{[r.TIME_VARIABLE]:{start:new Date,end:new Date,text:`Notebook (${(0,i.printTime)(m.time)})`}}:void 0),x=Object.keys(b).findIndex(e=>e===o);return(0,t.jsx)(a.Calendar,{allowClear:!1,compact:!0,minValue:f,disabled:c,onChange:(e,t)=>{let r=new Date(e.start),i=new Date(e.end),l=t||(0,s.default)(i.getTime()-r.getTime());d&&(0,n.track)("Query Builder Changed Date Range Period",{period:l}),t?u(t):u({from:r,to:i})},popoverAlignment:"center",presetIndex:x,presets:b,size:"small",value:{start:g,end:p},width:"210px"},"date-range-select-query-builder")}e.s(["DateRangeSelect",()=>o])},1135066,e=>{"use strict";var t=e.i(8711407),r=e.i(5467025),i=e.i(1482596),n=e.i(8815885),l=e.i(854682),a=e.i(4998750),s=e.i(2504781),o=e.i(3500331),u=e.i(5255926),c=e.i(8923565),d=e.i(5468328),m=e.i(1663964),g=e.i(244424),p=e.i(1918911),f=e.i(7749365),b=e.i(9096446),x=e.i(218692),h=e.i(4047087),y=e.i(3675495),v=e.i(2006677),w=e.i(6143247),j=e.i(1176592),N=e.i(2713400),E=e.i(2863467),k=e.i(1821888),R=e.i(9689002),S=e.i(7087273),M=e.i(2942788),C=e.i(3228096),O=e.i(4333930),T=e.i(4796642),I=e.i(787358),A=e.i(8004707),D=e.i(1898517),B=e.i(1379708),F=e.i(6401841),P=e.i(4141852),q=e.i(762945),_=e.i(7807066),L=e.i(2712781),z=e.i(2923544),Q=e.i(1813317);function U(e){let[r,i]=function(){let[e,t]=(0,j.useState)({x:0,y:0});return(0,j.useEffect)(()=>{let e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},[]),[e.x,e.y]}(),[n,l]=(0,j.useState)({button:null,container:null,metrics:null,firstMetric:null});(0,j.useEffect)(()=>{let t=()=>{if(!e.containerRef.current||!e.metricsRef.current)return void l({button:null,container:null,metrics:null,firstMetric:null});let t=e.metricsRef.current.querySelectorAll("button");0===t.length?l({button:null,container:null,metrics:null,firstMetric:null}):l({button:e.buttonRef.current?.getBoundingClientRect()||null,container:e.containerRef.current.getBoundingClientRect(),metrics:e.metricsRef.current.getBoundingClientRect(),firstMetric:t[0].getBoundingClientRect()})};t();let r=new ResizeObserver(t);return e.buttonRef.current&&r.observe(e.buttonRef.current),e.containerRef.current&&r.observe(e.containerRef.current),e.metricsRef.current&&r.observe(e.metricsRef.current),()=>r.disconnect()},[e.buttonRef,e.containerRef,e.metricsRef]);let[a,s]=(0,j.useState)({x:r,y:i});(0,j.useEffect)(()=>{let e=setTimeout(()=>{s({x:r,y:i})},16);return()=>clearTimeout(e)},[r,i]);let o=(0,j.useMemo)(()=>{if(!n.container||!n.metrics||!n.firstMetric)return null;let e=Math.min(n.metrics.bottom,n.container.bottom),t=a.x-n.container.left,r=n.button?n.button.right-n.container.left:260,i=Math.min(1,Math.max(0,(t-.5*r)/(.5*r))),l=a.y-n.container.top,s=Math.max(260,r),o=Math.max(n.button?n.button.left-n.container.left:0,Math.min(t-(8+18*i),s-10)),u=s-o,c=l;if(n.button){let e=n.button.top-n.container.top,t=n.button.bottom-n.container.top;if(l>=e-10&&l<=t+10){let t=Math.max(0,Math.min(n.button.height,l-e));c=e+t}}let d=n.firstMetric.top-n.container.top,m=e-n.container.top,g=Math.max(50,c),p=Math.min(g,Math.max(50,d)),f=m-p;if(f<=0||u<=0||!Number.isFinite(p)||!Number.isFinite(c)||!Number.isFinite(o))return null;let b=Math.max(0,Math.min(100,(g-p)/f*100));return{position:"absolute",left:`${o}px`,top:`${p}px`,width:`${u}px`,height:`${f}px`,clipPath:`polygon(0 ${b}%, 100% 0, 100% 100%, 0 ${b}%)`,pointerEvents:"auto",zIndex:1,cursor:"pointer"}},[a.x,a.y,n]);return o?(0,t.jsx)("div",{className:"group-hover:block hidden",style:o,onMouseEnter:e.onMouseEnter,onWheel:t=>{e.eventsScrollerRef.current&&(e.eventsScrollerRef.current.scrollTop+=t.deltaY)},onClick:e=>{let t=document.elementsFromPoint(e.clientX,e.clientY).find(t=>t!==e.currentTarget&&("BUTTON"===t.tagName||t.closest("button")));if(t){let e="BUTTON"===t.tagName?t:t.closest("button");e&&e.click()}}}):null}let $={incomingRequest:C.Globe,serverlessFunctionInvocation:O.FunctionSquare,edgeFunctionInvocation:T.FunctionEdge,middlewareInvocation:I.FunctionMiddleware,edgeMiddlewareInvocation:I.FunctionMiddleware,outgoingRequest:A.ArrowGlobe,imageTransformation:D.Image,imageTransformationFailure:D.Image,isrOperation:B.Isr,blockedConnection:F.Stop,firewallAction:P.FirewallFlame,botIdCheck:q.Warning,aiGatewayRequest:L.Sparkles};function K(e){return $[e]||M.Database}let G=["count","durationMs","functionDurationMs","functionWallTimeMs","functionCpuTimeMs","functionDurationGbhr","ttfbMs","coldStartDurationMs","initDurationMs","fotInBytes","fotOutBytes","fotTotalBytes","isrReadBytes","isrWriteBytes","isrReadUnits","isrWriteUnits","vdcReadUnits","invokedMemoryMb","maxMemoryUsedMb","billedMemoryMb"];function W(e){return(0,Q.getAggregableMeasures)(e).map(t=>({id:t,label:(0,z.labelForMeasure)(e,t)})).toSorted((e,t)=>{let r=G.indexOf(e.id),i=G.indexOf(t.id);return -1!==r&&-1!==i?r-i:-1!==r?-1:-1!==i?1:e.label.localeCompare(t.label)})}function V(e){let{disabled:r,selectedEventId:i,selectedMetricId:n,events:l,onSelect:a}=e,[o,u]=(0,j.useState)(!1),[c,d]=(0,j.useState)(""),[m,g]=(0,j.useState)(null),[f,b]=(0,j.useState)(null),[x,h]=(0,j.useState)(!1),[y,v]=(0,j.useState)(!1),[N,E]=(0,j.useState)("events"),[C,O]=(0,j.useState)(null),T=(0,j.useRef)(null),I=(0,j.useRef)(null),A=(0,j.useRef)(null),D=(0,j.useRef)(null),B=(0,j.useRef)(new Map),F=(0,j.useRef)(null),P=(0,j.useMemo)(()=>l.find(e=>e.id===i),[l,i]),q=(0,j.useMemo)(()=>{if(!c.trim())return{events:l,metrics:[],firstMatchingEventId:null};let e=c.toLowerCase(),t=new Set,r=null;return l.forEach(i=>{i.label.toLowerCase().includes(e)&&(t.add(i.id),r||(r=i.id))}),l.forEach(i=>{(0,Q.getAggregableMeasures)(i.id).map(e=>({id:e,label:(0,z.labelForMeasure)(i.id,e)})).some(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))&&(t.add(i.id),r||(r=i.id))}),{events:l.filter(e=>t.has(e.id)),firstMatchingEventId:r}},[l,c]),L=y&&"metrics"===N&&C?C:m||(c.trim()&&q.firstMatchingEventId?q.firstMatchingEventId:i)||q.events[0]?.id,$=(0,j.useMemo)(()=>l.find(e=>e.id===L),[l,L]),G=(0,j.useMemo)(()=>L?W(L):[],[L]),V=(0,j.useMemo)(()=>{if(!c.trim())return G;let e=c.toLowerCase(),t=G.filter(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e));return 0===t.length&&L?G:t},[G,c,L]),Y=(0,j.useMemo)(()=>{let e={};return q.events.forEach(t=>{let r=t.group||"Other";e[r]||(e[r]=[]),e[r].push(t)}),Object.entries(e).sort((e,t)=>{let[r]=e,[i]=t;return"Deprecated"===r&&"Deprecated"!==i?1:"Deprecated"!==r&&"Deprecated"===i?-1:0})},[q.events]),H=(0,j.useMemo)(()=>{let e=Y.flatMap(e=>{let[,t]=e;return t});return m&&!e.some(e=>e.id===m),e},[Y,m]),J=(0,j.useCallback)((e,t)=>{a(e,t),u(!1),d("")},[a]),X=(0,j.useCallback)(e=>{if(y)O(e),E("metrics");else{let t=W(e)[0];t&&J(e,t.id)}},[y,J]),Z=(0,j.useCallback)(e=>{let t=y&&C?C:L;t&&J(t,e)},[y,C,L,J]),ee=(0,j.useCallback)(e=>{if("ArrowDown"===e.key)if(e.preventDefault(),h(!0),m||f){if(m&&!f){let e=H.findIndex(e=>e.id===m);if(-1===e){let e=H[0];e&&g(e.id)}else{let t=H[e+1];t&&g(t.id)}}else if(f){let e=V.findIndex(e=>e.id===f),t=V[e+1];t&&b(t.id)}}else{let e=H[0];e&&g(e.id)}else if("ArrowUp"===e.key){if(e.preventDefault(),h(!0),m&&!f){let e=H.findIndex(e=>e.id===m);if(-1===e){let e=H[H.length-1];e&&g(e.id)}else e>0&&g(H[e-1].id)}else if(f){let e=V.findIndex(e=>e.id===f);e>0?b(V[e-1].id):b(null)}}else if("ArrowRight"===e.key)e.preventDefault(),h(!0),m&&V.length>0&&b(V[0].id);else if("ArrowLeft"===e.key)e.preventDefault(),h(!0),f&&b(null);else if("Enter"===e.key){if(m&&f)J(m,f);else if(m)if(c.trim()&&V.length>0)J(m,V[0].id);else{let e=l.find(e=>e.id===m);e&&X(e.id)}}else"Escape"===e.key&&u(!1)},[H,V,m,f,J,l,X,c]);(0,j.useEffect)(()=>{o&&(g(null),b(null),i&&I.current&&setTimeout(()=>{let e=I.current?.querySelector(`[data-event-id="${i}"]`);e?.scrollIntoView({block:"nearest",behavior:"auto"})},50))},[o,i]),(0,j.useEffect)(()=>{!m||H.some(e=>e.id===m)||c.trim()&&m===q.firstMatchingEventId||g(null)},[m,H,c,q.firstMatchingEventId]),(0,j.useEffect)(()=>{c.trim()&&q.firstMatchingEventId&&!x?(g(q.firstMatchingEventId),l.some(e=>e.id===q.firstMatchingEventId&&e.label.toLowerCase().includes(c.toLowerCase()))||V.length):c.trim()||i||g(null)},[c,q.firstMatchingEventId,V.length,i,l,x]),(0,j.useEffect)(()=>{if(x&&m&&I.current){let e=I.current.querySelector(`[data-event-id="${m}"]`);e&&e.scrollIntoView({block:"center",behavior:"smooth"})}},[m,x]),(0,j.useEffect)(()=>{let e=()=>{v(window.innerWidth<640)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,j.useEffect)(()=>{o||(E("events"),O(null))},[o]);let et=(0,j.useMemo)(()=>(function(e,t){if(!t||!e)return null;let r=(0,Q.getAggregableMeasures)(e).find(e=>e===t);return r?{id:r,label:(0,z.labelForMeasure)(e,r)}:null})(i,n),[i,n]),er=P&&et?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("span",{children:[P.label," "]}),(0,t.jsx)("span",{className:"text-gray-900 inline-block ml-1",children:et.label})]}):"Select Metric";return(0,t.jsxs)(k.Root,{modal:!0,onOpenChange:u,open:o,children:[(0,t.jsx)(k.Anchor,{className:"flex",children:(0,t.jsx)(k.Trigger,{asChild:!0,children:(0,t.jsx)(s.Button,{"aria-label":"Select event and metric",className:(0,w.cn)("!px-2 !py-4",r&&"!bg-white"),disabled:r,prefix:P?j.default.createElement(K(P.id),{color:"gray-900"}):(0,t.jsx)(M.Database,{color:"gray-900"}),size:"small",suffix:(0,t.jsx)(p.ChevronUpDown,{color:"gray-800"}),type:"secondary",typeName:"button",children:er})})}),(0,t.jsx)(k.Portal,{children:(0,t.jsx)(k.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsxs)("div",{ref:D,className:(0,w.cn)("flex rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu overflow-hidden font-sans relative isolate group",y?"w-[320px]":"w-[520px]"),children:[m&&!y&&(0,t.jsx)(U,{buttonRef:m&&B.current.get(m)?{current:B.current.get(m)||null}:{current:null},containerRef:D,metricsRef:A,eventsScrollerRef:F,onMouseEnter:()=>{g(m)}}),(0,t.jsxs)("div",{className:"flex flex-1 flex-col",children:[y&&"metrics"===N&&(0,t.jsx)("div",{className:"flex items-center border-b px-2 py-3",children:(0,t.jsxs)("button",{onClick:()=>E("events"),className:"flex items-center gap-1 bg-transparent text-sm text-gray-800 hover:text-gray-900",type:"button",children:[(0,t.jsx)(_.ChevronRight,{className:"size-3 rotate-180"}),"Back to Events"]})}),!(y&&"metrics"===N)&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,t.jsx)("input",{className:"w-full border-none bg-transparent text-sm outline-none",onChange:e=>d(e.target.value),placeholder:"Find metric…",ref:T,value:c,onKeyDown:ee}),(0,t.jsx)(R.Kbd,{small:!0,style:{paddingRight:"0.5rem"},children:"Esc"})]}),(0,t.jsx)("div",{className:(0,w.cn)("flex h-[340px]",y&&"flex-col"),children:c.trim()&&0===q.events.length?(0,t.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-sm text-gray-800",children:[(0,t.jsx)("div",{className:"mb-2",children:"No events or metrics found"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Try adjusting your search terms"})]})}):(0,t.jsxs)(t.Fragment,{children:[(!y||"events"===N)&&(0,t.jsx)("div",{className:(0,w.cn)(y?"flex-1":"w-[260px] border-r"),children:(0,t.jsx)(S.Scroller,{className:"h-[340px]",overflow:"y",setContainerRef:e=>{F.current=e},children:(0,t.jsx)("div",{className:"px-2 py-2",ref:I,children:Y.map(e=>{let[r,n]=e;return(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("p",{className:"text-copy-14 mb-1 px-2 text-xs text-gray-800",children:r}),n.map(e=>{let r=K(e.id),n=function(e){let{eventId:t,selectedEventId:r,activeEventId:i,activeMetricId:n,displayEventId:l}=e,a=t===r,s=t===l;return{isSelected:a,isActive:t===i,isDisplayed:s,showSelectedBg:a&&!i,isIndirectlyActive:s&&n}}({eventId:e.id,selectedEventId:i,activeEventId:m,activeMetricId:f,displayEventId:L});return(0,t.jsxs)("button",{ref:t=>{t?B.current.set(e.id,t):B.current.delete(e.id)},"data-event-id":e.id,className:(0,w.cn)("flex w-full items-center gap-2 rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!x&&"hover:bg-gray-100",(n.showSelectedBg||n.isIndirectlyActive)&&"bg-gray-100",n.isActive&&!f&&"bg-gray-100"),onMouseEnter:()=>{x||g(e.id)},onMouseMove:()=>h(!1),onFocus:()=>g(e.id),onClick:()=>X(e.id),type:"button",children:[(0,t.jsx)(r,{className:"size-4",color:"gray-900"}),(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label}),(0,t.jsx)(_.ChevronRight,{className:(0,w.cn)("size-3 text-gray-800 ",n.isDisplayed?"opacity-100":"opacity-0")})]},e.id)})]},r)})})})}),(!y||"metrics"===N)&&(0,t.jsx)("div",{className:(0,w.cn)("flex-1"),ref:A,children:(0,t.jsx)(S.Scroller,{className:"h-[340px]",overflow:"y",children:(0,t.jsxs)("div",{className:"px-2 py-2",children:[$&&(0,t.jsxs)("p",{className:"text-copy-14 mb-1 px-2 text-xs text-gray-800",children:["Metrics for ",$.label]}),V.length>0?V.map((e,r)=>{let l=function(e){let{metricId:t,metricIndex:r,selectedMetricId:i,activeEventId:n,activeMetricId:l,displayEventId:a,selectedEventId:s,isMobile:o,mobileStep:u}=e,c=t===i&&a===s;return{isSelected:c,isActive:(!o||"metrics"!==u)&&t===l,isFirstAndActive:(!o||"metrics"!==u)&&0===r&&n&&!l&&!c,showSelectedBg:c&&!l}}({metricId:e.id,metricIndex:r,selectedMetricId:n,activeEventId:m,activeMetricId:f,displayEventId:L,selectedEventId:i,isMobile:y,mobileStep:N});return(0,t.jsx)("button",{className:(0,w.cn)("flex w-full items-center rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!x&&"hover:bg-gray-100",(l.isFirstAndActive||l.showSelectedBg)&&"bg-gray-100",l.isActive&&"bg-gray-100"),onMouseEnter:()=>{x||y&&"metrics"===N||b(e.id)},onMouseLeave:()=>{x||y&&"metrics"===N||b(null)},onMouseMove:()=>h(!1),onClick:()=>Z(e.id),type:"button",children:(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label})},e.id)}):(0,t.jsx)("div",{className:"px-2 py-4 text-center text-sm text-gray-800",children:c?"No metrics match your search":"No metrics available"})]})})})]})})]})]})})})]})}var Y=e.i(8284460),H=e.i(455575),J=e.i(8735244),X=e.i(2924363),Z=e.i(4244280),ee=e.i(7867910),et=e.i(1438473),er=e.i(5338940),ei=e.i(119294),en=e.i(6352514);function el(e){let{onGeneratedQuery:r,query:i,disabled:n,className:l}=e,a=(0,H.useToasts)(),{team:u}=(0,er.useTeam)(),c=(0,j.useRef)(null),[d,m]=(0,j.useState)(!1),[g,p]=(0,j.useState)(""),{isGenerating:f,generate:b,error:x}=(e=>{let{onSuccess:t,query:r}=e,[i,n]=(0,j.useState)(!1),[l,a]=(0,j.useState)(null),{team:s}=(0,er.useTeam)(),o=(0,H.useToasts)();return{isGenerating:i,generate:(0,j.useCallback)(async e=>{if(!e.trim())return;n(!0);let i=new URLSearchParams({previousQuery:JSON.stringify(r),prompt:e}).toString();try{let e=await fetch(`${Z.API_OBSERVABILITY_QUERY_GENERATION}?${i}`),r=await e.json(),n=r.rollups.value,l=(0,Q.getGroupableDimensions)(r.event),s=r.groupBy?.filter(e=>l.includes(e))??[];a(null),t({metric:`${r.event}.${n.measure}`,by:s,filter:r.filter??"",aggregation:n.aggregation,time:r.range??{from:new Date(r.startTime),to:new Date(r.endTime)}})}catch{let e="Error generating query";o.error(e),a(e)}finally{n(!1),ei.analytics.track(en.AnalyticsEvent.QUERY_BUILDER_GENERATED_QUERY,{prompt:e,plan:s?.billing?.plan??"hobby"})}},[t,r,s,o]),error:l}})({query:i,onSuccess:e=>{r(e),c.current={query:JSON.stringify(e),prompt:g},p("")}}),h=(0,j.useRef)(null),[y,v]=(0,j.useState)(!1),N=y&&!f&&!x,E=async e=>{e.preventDefault(),g.trim()&&(v(!0),await b(g))},k="query-builder-input";return(0,ee.useHotkey)(()=>{m(!0),setTimeout(()=>h.current?.focus(),0)},"/"),(0,t.jsx)(Y.Root,{className:(0,w.cn)("border-t border-gray-400 px-4 bg-background-100",l),collapsible:!0,value:d?"query-assistant":"",type:"single",children:(0,t.jsxs)(Y.Item,{value:"query-assistant",children:[(0,t.jsxs)(Y.Trigger,{className:"group flex items-center w-full bg-transparent text-label-14 text-gray-800 font-medium p-0 py-3 gap-3 cursor-pointer",onClick:()=>{m(!d),d||setTimeout(()=>h.current?.focus(),0)},children:[(0,t.jsx)(_.ChevronRight,{className:"transition-transform group-[[data-state=open]]:rotate-90"}),(0,t.jsx)("span",{className:"mr-auto",children:"Query Assistant"}),(0,t.jsx)(R.Kbd,{className:(0,w.cn)("transition-opacity",0!==g.trim().length&&"hidden"),small:!0,children:"/"})]}),(0,t.jsx)(Y.Content,{className:"pb-4",children:(0,t.jsxs)("form",{onSubmit:E,children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:k,children:"Prompt"}),(0,t.jsx)(o.Input,{className:"h-12 rounded-lg",id:k,innerWrapperClassName:(0,w.cn)("bg-background-100 shadow h-12 font-sans text-[14px] relative z-10 border-gray-200 focus:border-gray-600 rounded-lg overflow-hidden m-1","h-10 shadow-border rounded-md",{"bg-gray-100":f}),name:k,disabled:f||n,onChange:e=>{p(e.target.value),v(!1)},placeholder:"Show me requests by host…",prefix:(0,t.jsx)(L.Sparkles,{size:14}),prefixStyling:!1,ref:h,suffix:(0,t.jsxs)("div",{className:"flex h-full gap-2 !pr-1",children:[N?(0,t.jsx)(s.Button,{"aria-label":"Not what I expected",className:"!px-0",size:"small",type:"secondary",onClickCapture:e=>{e.preventDefault()},onClick:()=>{v(!1),ei.analytics.track(en.AnalyticsEvent.QUERY_BUILDER_FEEDBACK,{feedback:"badly-generated-query",plan:u?.billing?.plan??"hobby",prompt:c.current?.prompt??"",generatedQuery:c.current?.query??""}),a.success("Thank you for the feedback!")},children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Not what I expected"}),(0,t.jsx)(X.ThumbDown,{})]})}):null,f&&(0,t.jsx)("div",{className:"flex items-center justify-center px-2",children:(0,t.jsx)(J.Spinner,{size:14})}),(0,t.jsx)(s.Button,{"aria-label":"Build It",className:"!px-0 disabled:hidden",disabled:0===g.trim().length||f,size:"small",typeName:"submit",children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Generate Query"}),(0,t.jsx)(et.ArrowRight,{})]})})]}),suffixContainer:!1,suffixStyling:!1,typeName:"text",value:g})]})})]})})}var ea=e.i(962099),es=e.i(6029070),eo=e.i(2749380),eu=e.i(5627633),ec=e.i(268049);function ed(e){return{granularity:e,id:(0,ec.milliseconds)(e).toString(),label:(0,eu.formatDuration)(e),type:"string"}}var em=e.i(6190059),eg=e.i(1283928),ep=e.i(1717203),ef=e.i(9486194),eb=e.i(8690335),ex=e.i(9372366),eh=e.i(1111237),ey=e.i(6198010);let ev="!ring-1 ring-gray-400 outline-offset-2 outline-[var(--ds-focus-color)] outline-2 overflow-visible focus:outline";function ew(e){let{addButtonLabel:r,className:i,dimensions:l,values:a,onChange:o,isLoading:u,disabled:c,id:d}=e,[m,g]=(0,j.useReducer)(eN,{values:a,dimensions:l},ej);(0,j.useEffect)(()=>{g({type:"updateProps",dimensions:l,values:a})},[l,a]);let p=m.values.length>0;return(0,t.jsxs)("fieldset",{id:d,className:(0,w.cn)("flex flex-row flex-wrap items-center gap-2",i),children:[m.values.map((e,r)=>(0,t.jsxs)("span",{className:"flex flex-row",children:[(0,t.jsx)(n.SingleFilterPopoverBox,{className:(0,w.cn)("!p-1",ev,!c&&"!rounded-l"),disabled:c,label:"dimension",onChange:e=>g({type:"change",value:e,index:r,onChange:o}),onOpenChange:e=>g({type:"toggle",open:e,index:r}),open:m.open[r],options:m.remaining,rounded:c,value:e}),c?null:(0,t.jsx)(s.Button,{"aria-label":`Remove ${e.label}`,className:(0,w.cn)("!px-0.5 !text-gray-900 hover:!text-gray-1000",ev),onClick:()=>g({type:"remove",index:r,onChange:o}),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(b.CrossSmall,{size:"small"})})]},e.id)),(0,t.jsx)(n.SingleFilterPopoverBox,{className:"border !p-1",isLoading:u,label:"dimension",onChange:e=>g({type:"add",value:e,onChange:o}),onOpenChange:e=>g({type:"toggle",open:e}),open:m.openAdd,options:m.remaining,rounded:!0,children:(0,t.jsx)(s.Button,{"aria-label":"Add dimension",className:"!text-gray-900 data-[state='open']:!bg-gray-100 hover:!text-gray-1000",disabled:c,size:"small",type:"tertiary",...p?{shape:"square",svgOnly:!0,children:(0,t.jsx)(ey.Plus,{})}:{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(ey.Plus,{}),r]})}})})]})}function ej(e){let{values:t,dimensions:r}=e;return{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:eE(r,t),allDimensions:r}}function eN(e,t){switch(t.type){case"toggle":if(void 0===t.index)return{...e,openAdd:t.open};return t.index<0||t.index>=e.values.length?{...e}:{...e,open:[...e.open.slice(0,t.index),t.open,...e.open.slice(t.index+1)]};case"updateProps":{let{dimensions:r}=t,i=t.values.filter(e=>{let{id:t}=e;return r.some(e=>e.id===t)});return{...e,remaining:eE(r,i),values:i,allDimensions:r}}case"add":return{...e,...ek(e.allDimensions,[...e.values,t.value],t.onChange)};case"change":{let{index:r,value:i,onChange:n}=t;if(r<0||r>=e.values.length)return e;return{...e,...ek(e.allDimensions,[...e.values.slice(0,r),i,...e.values.slice(r+1)],n)}}case"remove":{let{index:r,onChange:i}=t;return{...e,...ek(e.allDimensions,[...e.values.slice(0,r),...e.values.slice(r+1)],i)}}default:return e}}function eE(e,t){return e.filter(e=>{let{id:r}=e;return!t.some(e=>e.id===r)})}function ek(e,t,r){return setTimeout(()=>r?.(t),0),{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:eE(e,t)}}var eR=e.i(8522580),eS=e.i(6982071);e.i(6728635);var eM=e.i(2630141),eC=e.i(5348482);function eO(){let{team:e}=(0,er.useTeam)(),r=(0,eM.useOpenEnableModal)(),[,i]=(0,eC.useQueryBuilderQueryState)(),n=e?.billing?.plan==="hobby"?"Upgrade to Pro":"Get Observability Plus";return(0,t.jsx)(eR.Note,{action:(0,t.jsx)(s.Button,{size:"small",onClick:()=>{ei.analytics.track(en.AnalyticsEvent.OBSERVE_FEATURE_SEPARATION,{plan:e?.billing?.plan??"hobby",page:"query-builder",type:"modal_opened"}),r({from:"observability",via:"query-builder",upgradeUseCase:"query-builder"}),i({builder:!1})},children:n}),variant:"contrast",fill:!0,icon:(0,t.jsx)(eS.LockClosedSmall,{}),type:"secondary",className:"!rounded-md !pr-1.5",size:"small",children:(0,t.jsxs)("p",{children:["Read-only mode."," ",(0,t.jsx)("span",{className:"font-medium",children:"Unlock custom queries"})," by upgrading to"," ",e?.billing?.plan==="hobby"?"Pro and Observability Plus":"Observability Plus","."]})})}function eT(e){let{query:i,setQuery:n,Actions:o,Title:u,variables:c,children:d,embedded:g=!0}=e,[p,f]=(0,j.useState)(!1),{hasObservabilityPlusAccess:b}=(0,l.useHasObservabilityPlus)(),x=(0,j.useMemo)(()=>(0,a.replaceVariables)(i,c),[i,c]),{isReady:h}=(0,em.useAccessibleMetrics)(),y=!h||!b,v=(0,j.useRef)(null),N=(0,j.useCallback)(()=>{v.current&&f(v.current.scrollTop>40)},[]),E=(0,j.useCallback)(()=>{v.current&&v.current.scrollTo({top:0,behavior:"smooth"})},[]);return(0,t.jsx)(r.ObservabilityChartContextProvider,{children:g?(0,t.jsxs)("div",{ref:v,className:"relative flex flex-1 flex-col overflow-y-auto m-4",onScroll:N,children:[(0,t.jsxs)("div",{className:"sticky left-0 top-0 z-10 pb-3 flex items-center justify-between gap-3 bg-background-100",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center justify-start gap-2",children:u}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Button,{"aria-label":"Scroll to top",onClick:E,type:"tertiary",svgOnly:!0,"aria-hidden":!p,shape:"square",className:(0,w.cn)("transition-all duration-200",p?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),tabIndex:p?0:-1,children:(0,t.jsx)(m.ArrowUp,{size:16})}),o]})]}),(0,t.jsx)(eD,{className:"sticky inset-x-0 pt-px",disabled:y,embedded:g,query:i,setQuery:n,variables:c}),(0,t.jsx)(eq,{className:"p-px sticky inset-x-0",disabled:y,query:i,setQuery:n}),(0,t.jsx)(eh.ResultsChart,{query:x,readOnly:y,scrollerRef:g?v:void 0,setQuery:n,showTable:i.by.length>0,sticky:g,variant:"minimal"}),d]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eD,{disabled:y,embedded:g,query:i,setQuery:n,variables:c}),(0,t.jsxs)("div",{className:"p-4 flex flex-col gap-3 border-1 rounded-md shadow-border bg-background-100",children:[(0,t.jsx)(eq,{disabled:y,query:i,setQuery:n}),(0,t.jsx)(eh.ResultsChart,{query:x,readOnly:y,scrollerRef:g?v:void 0,setQuery:n,showTable:i.by.length>0,sticky:g,variant:"minimal"}),d]})]})})}function eI(e){let{query:r,setQuery:i,embedded:n}=e,{hasObservabilityPlusAccess:a,ready:s}=(0,l.useHasObservabilityPlus)(),o=(0,j.useMemo)(()=>(0,eb.toSonarQuery)(r),[r]);return!s||a?(0,t.jsx)(el,{className:n?"bg-background-200 border-0 rounded-md":"rounded-b-md",onGeneratedQuery:i,query:o}):(0,t.jsx)("div",{className:n?"pl-2":"p-4 pt-0",children:(0,t.jsx)(eO,{})})}let eA="flex flex-col md:flex-row gap-3 align-center";function eD(e){let{disabled:r,embedded:l,query:a,setQuery:s,variables:o,className:c}=e,[d,m]=(0,j.useState)(!1),{isReady:g,accessibleDimensions:f,by:b}=(0,es.useAccessibleDimensions)(a),{accessibleEvents:x}=(()=>{let{can:e}=(0,ep.default)(),{team:t}=(0,er.useTeam)();return t?{isReady:!0,accessibleEvents:ef.queryBuilderEvents.filter(r=>(0,Q.canAccessEvent)({event:r,team:t,can:e})).map(e=>({id:e,label:"label"in eg.AllEvents[e]?eg.AllEvents[e].label:e,type:"string",group:(e=>{switch(e){case"serverlessFunctionInvocation":case"middlewareInvocation":case"outgoingRequest":return"Compute";case"incomingRequest":case"imageTransformation":case"isrOperation":return"Edge Network";case"blockedConnection":case"firewallAction":case"botIdCheck":return"Security";case"aiGatewayRequest":return"AI";case"edgeFunctionInvocation":return"Deprecated";default:return"Other"}})(e)})).toSorted((e,t)=>"Deprecated"===e.group&&"Deprecated"!==t.group?1:"Deprecated"!==e.group&&"Deprecated"===t.group?-1:0)}:{isReady:!1,accessibleEvents:[]}})(),{event:h,measure:y}=(0,eb.splitEventAndMeasure)(a),{accessibleAggregations:v,aggregation:k}=(0,ea.useAccessibleAggregations)(a),R=(0,ex.useValuesResolver)(a);((e,t)=>{let{event:r}=(0,eb.splitEventAndMeasure)(e),i=(0,j.useCallback)((e,t)=>{let r=(0,Q.getGroupableDimensions)(e);return t.filter(e=>r.includes(e))},[]);(0,j.useEffect)(()=>{if(e.by.length>0){let n=i(r,e.by);n.length!==e.by.length&&t({by:n})}},[e.by,t,r,i])})(a,s);let S=(0,j.useMemo)(()=>f.toSorted((e,t)=>e.label.localeCompare(t.label)),[f]),M=(0,j.useMemo)(()=>({dimensions:S,operators:N.operators,resolveValues:R,defaultSingleOperator:N.defaultSingleOperator,defaultMultiOperator:N.defaultMultiOperator,defaultArrayOperator:N.defaultArrayOperator}),[S,R]),C=(0,j.useMemo)(()=>(0,eb.parseFilters)(a.filter),[a.filter]),O=0===C.length&&a.filter,T=(0,j.useCallback)(e=>s({filter:(0,eb.serializeFilters)(e)}),[s]),I=(0,j.useCallback)(e=>{let t=a.view;0===e.length&&t?.type==="table"?t={type:"big-number"}:e.length>0&&t?.type==="big-number"&&(t={type:"table"}),s({by:e.map(e=>{let{id:t}=e;return t}),view:t})},[s,a.view]);return(0,t.jsxs)("div",{className:(0,w.cn)("flex flex-col bg-background-100 mb-3",!l&&"shadow-border rounded-md",c),children:[(0,t.jsxs)("div",{className:(0,w.cn)("flex flex-col flex-1 gap-3",l?"p-2 pt-0 pb-4":"p-4 pb-3"),children:[(0,t.jsxs)("div",{className:eA,children:[(0,t.jsx)(eF,{htmlFor:"event-metric",className:eB,children:"Metric"}),(0,t.jsxs)("div",{className:"flex flex-col flex-wrap md:flex-row gap-2 flex-1 [&>:nth-child(2)]:mr-auto",children:[(0,t.jsx)(V,{disabled:r,selectedEventId:h,selectedMetricId:y,events:x,onSelect:(e,t)=>{s({metric:`${e}.${t}`,aggregation:function(e){let t=eg.AllMeasures[e];if(!t)return"sum";let{unit:r,aggregations:i}=t;switch(r){case"count":return i.includes("sum")?"sum":i[0];case"milliseconds":case"seconds":case"bytes":case"megabytes":case"gigabyte_hour":case"ratio":case"percent":return i.includes("avg")?"avg":i[0];default:return i[0]}}(t)})}}),(0,t.jsx)(n.SingleFilterPopoverBox,{id:"aggregation",className:"!px-2 !py-4",disabled:r,label:"aggregation",onChange:e=>{s({aggregation:e.id}),m(!1)},onOpenChange:m,open:d,options:v,rounded:!0,suffix:(0,t.jsx)(p.ChevronUpDown,{color:"gray-800"}),value:k}),(0,t.jsx)(E.DateRangeSelect,{disabled:r,value:a.time,onChange:e=>s({time:e}),trackEvents:!0,variables:o})]})]}),(0,t.jsxs)("div",{className:eA,children:[(0,t.jsx)(eF,{htmlFor:"by",className:eB,children:"Group By"}),(0,t.jsx)("div",{className:"flex-1",children:g?(0,t.jsx)(ew,{addButtonLabel:"Add",id:"by",dimensions:S,disabled:r,isLoading:!g,onChange:I,values:b}):(0,t.jsx)(u.Skeleton,{height:32,width:100})})]}),O?(0,t.jsx)(eP,{setQuery:s,query:a}):(0,t.jsxs)("div",{className:eA,children:[(0,t.jsx)(eF,{htmlFor:"filter",className:eB,children:"Filter"}),(0,t.jsx)("div",{className:"flex-1",children:g?(0,t.jsx)(i.FilterBar,{config:M,disabled:r,filters:C,onChange:T}):(0,t.jsx)(u.Skeleton,{height:32,width:200})})]})]}),(0,t.jsx)(eI,{embedded:l,query:a,setQuery:s})]})}let eB="md:w-16 md:shrink-0 md:pt-1.5";function eF(e){let{children:r,className:i,htmlFor:n,...l}=e;return(0,t.jsx)("label",{className:(0,w.cn)("text-sm font-medium text-gray-800",i),htmlFor:n,...l,children:r})}function eP(e){let{setQuery:r,query:i}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-row items-center gap-2 py-2 col-span-2",children:[(0,t.jsx)(d.Tooltip,{text:"Invalid or unsupported filter saved",children:(0,t.jsx)(v.Question,{size:16})}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center",children:[(0,t.jsx)(d.Tooltip,{className:"w-full",text:i.filter,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(o.Input,{"aria-label":"Invalid or unsupported filter saved",className:"w-full overflow-visible outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0},value:i.filter})})}),(0,t.jsx)(s.Button,{"aria-label":"Clear filter",className:"overflow-visible !border-l-0 outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",onClick:()=>r({filter:""}),size:"medium",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",children:(0,t.jsx)(b.CrossSmall,{size:20})})]})]})}function eq(e){let r,i,l,a,{className:s,query:o,setQuery:u,disabled:c}=e,[d,m]=(0,j.useState)(!1),{accessibleGranularities:g,granularity:b}=(r=(0,j.useMemo)(()=>{let{start:e,end:t}=(0,eo.fromTimeToRange)(o.time);return Math.round(t.getTime()-e.getTime())},[o.time]),i=(0,j.useMemo)(()=>(0,eo.getGranularityFromDuration)(r),[r]),l=(0,j.useMemo)(()=>{let e=[],t=(0,ec.milliseconds)(i);for(let i of eo.preferredGranularities){let n=(0,ec.milliseconds)(i);n>=t&&n<=r&&e.push(ed(i))}return e},[i,r]),a=(0,j.useMemo)(()=>l.find(e=>{let{id:t}=e;return t===(0,ec.milliseconds)(o.granularity??{}).toString()})??ed(i),[i,l,o.granularity]),{accessibleGranularities:l,granularity:a});return(0,t.jsxs)("div",{className:(0,w.cn)("flex flex-wrap gap-2 items-center justify-end",s),children:[(0,t.jsx)(n.SingleFilterPopoverBox,{id:"granularity",disabled:c,label:"granularity",onChange:e=>{let{granularity:t}=e;u({granularity:t}),m(!1)},onOpenChange:m,open:d,options:g,prefix:(0,t.jsx)(f.Clock,{color:"gray-900"}),rounded:!0,suffix:(0,t.jsx)(p.ChevronUpDown,{color:"gray-800"}),value:b}),(0,t.jsx)(eL,{query:o,onChange:e=>u({view:e})})]})}let e_=[{type:"line",icon:(0,t.jsx)(x.LineChart,{})},{type:"area",icon:(0,t.jsx)(g.BarChart,{})},{type:"table",icon:(0,t.jsx)(h.MenuAlt,{}),isDisabled:e=>(e?.by.length??0)===0?"Add a Group By clause to view results in a Table.":null},{type:"big-number",icon:(0,t.jsx)(y.Percentage,{}),isDisabled:e=>(e?.by.length??0)>=1?"Remove your Group By clause to view results as a number.":null}];function eL(e){let{query:r,onChange:i}=e,n=e_.filter(e=>{let{isDisabled:t}=e;return!t?.(r)});return(0,t.jsx)(c.Switch,{name:"view",size:"small",children:n.map(e=>{let{type:n,icon:l}=e;return(0,t.jsx)(c.Switch.Control,{checked:(r?.view?.type??"line")===n,icon:l,value:n,onChange:()=>i({type:n})},n)})})}e.s(["QueryBuilder",()=>eT],1135066)}]);

//# debugId=318bdaad-d929-d532-3131-e0795a8690fc
//# sourceMappingURL=7f858746b7b6eb2a.js.map