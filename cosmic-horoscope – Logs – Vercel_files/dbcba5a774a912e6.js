;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="a07fd93c-b252-7ced-11dd-538e041ad387")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,492520,9172735,e=>{"use strict";var t=e.i(7909933),l=e.i(5802506);function i(e){let{data:i,isLoading:s}=(0,t.default)(e?"/api/feature-flags/deployment-outage-banner":null,e=>fetch(e).then(e=>e.json()),{async onError(e){await (0,l.captureError)(e)}}),a="github-limited"===e?"github":e,n=a?i?.providers?.[a]:void 0;return a&&n?.enabled?{data:{link:n.learnMoreLink||"https://www.vercel-status.com",customMessage:n.customMessage||void 0,isVercelOnly:i?.showToVercelianOnly??!1},isLoading:s}:{data:null,isLoading:s}}function s(e){let i=e.length>0,{data:s,isLoading:a}=(0,t.default)(i?"/api/feature-flags/deployment-outage-banner":null,e=>fetch(e).then(e=>e.json()),{async onError(e){await (0,l.captureError)(e)}}),n=s?.providers?.marketplace;if(n?.enabled&&n.affectedSlugs?.length){let t=new Set(n.affectedSlugs);if(e.some(e=>t.has(e)))return{data:{link:n.learnMoreLink||void 0,customMessage:n.customMessage||void 0,showRedeployCta:n.showRedeployCta,isVercelOnly:s?.showToVercelianOnly??!1},isLoading:a}}return{data:null,isLoading:a}}e.s(["useDeploymentOutageBanner",()=>i,"useMarketplaceOutageBanner",()=>s],492520);var a=e.i(8711407),n=e.i(762945),r=e.i(57106),o=e.i(1335111);function c(e){let{actionOnClick:t,gitType:l,link:i,customMessage:s,hideAction:c=!1,isVercelOnly:d=!1}=e;if(!l&&!s)return null;let u=l?function(e){switch(e){case"github":return"GitHub";case"gitlab":return"GitLab";case"bitbucket":return"Bitbucket";default:return""}}(l):"",m=u?`Automatic deployments from ${u} are temporarily unavailable. You can manually create a new deployment.`:"",h=s||m,p=d?`[Vercel-only] ${h}`:h,x=(0,a.jsxs)(a.Fragment,{children:[p,i?(0,a.jsxs)(a.Fragment,{children:[" ",(0,a.jsx)(r.Link,{external:!0,href:i,children:"Learn more"})]}):null]});return(0,a.jsx)(o.CompatBanner,{callToAction:!c&&t?{label:"Create Deployment",onClick:t}:void 0,icon:(0,a.jsx)(n.Warning,{className:"shrink-0"}),label:x,variant:"warning",sticky:!1})}e.s(["OutageBanner",()=>c],9172735)},9204765,4095738,e=>{"use strict";var t=e.i(8711407),l=e.i(1987325),i=e.i(1176592),s=e.i(2504781),a=e.i(2064047),n=e.i(6891161),r=e.i(8522580),o=e.i(7087273),c=e.i(9318197),d=e.i(455575),u=e.i(57106),m=e.i(7749291),h=e.i(4345845),p=e.i(7218483),x=e.i(5614970),f=e.i(913614),y=e.i(3023251),g=e.i(7401972),j=e.i(5598924),b=e.i(5761705),v=e.i(5479400),k=e.i(6401841),w=e.i(3306538),N=e.i(3500331),S=e.i(5255926),D=e.i(8735244);function C(e){let{loading:l,onChange:s,onPaste:a,size:n,state:r,...o}=e;return(0,t.jsx)(N.Input,{...o,id:(0,i.useId)(),onChange:s,onPaste:a,size:n,suffix:(0,t.jsx)(A,{loading:l,size:"small"===n?16:void 0,state:r}),suffixStyling:!1})}function A(e){let{loading:l,state:i,size:s}=e;return l?(0,t.jsx)(D.Spinner,{size:s}):"success"===i?(0,t.jsx)(b.CheckCircle,{color:"blue-700",size:s}):"error"===i?(0,t.jsx)(k.Stop,{color:"red-900",size:s}):null}function R(e){let{branchName:l,commitMessage:i,commitSha:s,createdAt:a=Date.now(),isProductionDeployment:n,loading:r}=e,o=(0,p.useAgo)(a,{long:!0,justNowLabel:"just now"}),c=r||"string"==typeof l,d=s?.substring(0,7);return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-0.5 flex-1 translate-y-[3px] rounded-[10px] border border-solid border-[var(--accents-2)] px-3 py-[7px]",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-1",children:[(0,t.jsx)(h.GitBranch,{color:"gray-900",style:{flexShrink:0}}),(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-1 flex-1",children:r?(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-1 pt-1 pb-1",children:(0,t.jsx)(S.Skeleton,{height:16,width:150})}):(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-1",children:[c?(0,t.jsxs)("div",{className:"text-copy-14-mono truncate",style:{maxWidth:370},children:[l," "]}):(0,t.jsx)("div",{className:"min-w-[180px] max-w-[250px]",children:l}),!0===n&&(0,t.jsx)(w.Badge,{size:"md",variant:"blue-subtle",children:"Production"}),!1===n&&(0,t.jsx)(w.Badge,{size:"md",variant:"gray-subtle",children:"Preview"})]})})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-1",children:[(0,t.jsx)("div",{className:"flex flex-col items-center justify-start flex-initial",children:(0,t.jsx)(v.GitCommit,{color:"gray-900",size:16,style:{flexShrink:0}})}),r?(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-1 pt-1 pb-1",children:[(0,t.jsx)(S.Skeleton,{height:16,width:95}),(0,t.jsx)(S.Skeleton,{height:16,width:"56%"})]}):(0,t.jsxs)("div",{className:"text-copy-14 truncate",children:[(0,t.jsx)("span",{className:"text-copy-14-mono",children:d}),` ${i??""} `,(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:o})]})]})]})}function I(e){return(0,t.jsx)(r.Note,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsxs)("div",{children:["This commit has already been built—",(0,t.jsx)(u.Link,{external:!0,href:e.deploymentId.replace(/dpl_/,""),tab:!0,type:"primary",children:"view here"})]}),e.isProductionDeployment?(0,t.jsx)("div",{children:"It is the current production deployment"}):null]})})}function M(e){let{branchName:l,isProductionDeployment:i}=e;return(0,t.jsx)(r.Note,{fill:!0,type:"warning",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"This commit exists on multiple branches"}),(0,t.jsxs)("p",{className:"text-copy-14 text-inherit",children:["Please verify this deployment should be built from"," ",(0,t.jsx)("span",{className:"text-copy-14-mono text-inherit",children:l}),i?" with Production configuration.":"."]})]})})}function P(e){let{children:l,id:i}=e;return l?(0,t.jsx)(r.Note,{fill:!0,id:i,style:{alignSelf:"start"},type:"error",children:l}):null}var T=e.i(7909933),$=e.i(7966665),E=e.i(277234);let L=RegExp(/[0-9a-f]{7,40}/,"i");function O(e,t){return e.toLowerCase()===t.toLowerCase()}function B(e){let{projectId:t,branchName:l,sha:i,teamId:s}=e,a=new URLSearchParams;l&&a.set("branchName",l),s&&a.set("teamId",s),i&&a.set("sha",i);let n=`/v1/integrations/git-commit-details/${t}?${a.toString()}`;return(0,E.fetchAPI)(n,{throwOnHTTPError:!0})}async function F(e,t,l,i,s,a,n){let r=function(e,t,l,i){let s=e.startsWith("http")?e:`https://${e}`,a=(0,$.default)(s);if(a){if(a.type!==t||!O(a.owner,l)||!O(a.name,i))return{type:"error",message:"The provided link points to a different repository than what is connected to the Vercel project."};if(!a.sha&&!a.branch)return{type:"production"};if(a.branch)return{type:"branch",ref:a.branch};if(a.sha)return{type:"sha",sha:a.sha}}return L.exec(e)?{type:"sha",sha:e}:{type:"branch",ref:e}}(e,s,t,l);switch(r.type){case"production":{if(!a)throw Error("There is no production branch defined for this project");let e=await B({projectId:i,branchName:a,teamId:n});return{branch:a,commitDate:new Date(e.commitDate).getTime(),commitMessage:e.commitMessage,sha:e.commitSha,requestedBy:r.type,recentDeploymentId:e.recentDeploymentId}}case"branch":{let e=await B({projectId:i,branchName:r.ref,teamId:n});return{branch:r.ref,commitDate:new Date(e.commitDate).getTime(),commitMessage:e.commitMessage,sha:e.commitSha,requestedBy:r.type,recentDeploymentId:e.recentDeploymentId}}case"sha":{let e=await B({projectId:i,sha:r.sha,teamId:n}),t=[...new Set(e.branches)].sort(e=>+(e===a));return{branch:t[0],commitDate:new Date(e.commitDate).getTime(),commitMessage:e.commitMessage,multiBranches:t.length>1?t:void 0,sha:e.commitSha,requestedBy:r.type,recentDeploymentId:e.recentDeploymentId}}case"error":throw Error(r.message)}}var _=e.i(4005781),z=e.i(4244280);function W(e){return(!e||"PENDING"!==e.state&&("RUNNING"!==e.state||void 0!==e.deploymentId||void 0!==e.url))&&!0}function H(e,t){let l=(0,f.getGitRepoUrlFromLink)(e);return t&&"github"===e.type?`${l}/tree/${t}`:t&&"gitlab"===e.type?`${l}/-/tree/${t}`:t&&"bitbucket"===e.type?`${l}/src/${t}`:l}function U(e){let{active:l,onCancel:i,projectId:s,projectLink:a,teamId:r}=e;if(!a)return null;let o=(0,y.getOrgAndRepoFromLink)(a);return o?(0,t.jsx)(n.Modal.Modal,{active:l,onClickOutside:i,children:(0,t.jsx)(G,{linkedOrg:o.org,linkedRepo:o.repo,onCancel:i,projectId:s,projectLink:a,teamId:r})}):null}function G(e){let s,{linkedOrg:a,linkedRepo:u,onCancel:m,projectId:h,projectLink:p,teamId:x}=e,f=(0,i.useId)(),b=(0,i.useId)(),[v,k]=(0,i.useState)(""),[w,N]=(0,i.useState)(""),[S,D]=(0,i.useState)(""),[A,$]=(0,i.useState)(!1),L=(0,d.useToasts)(),O=p.updatedAt||0,{isValidating:B,error:U,data:G}=function(e,t){let{linkedOrg:l,linkedRepo:i,productionBranch:s,projectId:a,projectType:n,teamId:r}=t;return(0,T.default)(""===e?null:[e,l,i,a,n,s,r],e=>F(...e),{throwOnError:!1,shouldRetryOnError:!1,revalidateOnFocus:!1})}(v,{linkedOrg:a,linkedRepo:u,productionBranch:p.productionBranch,projectId:h,projectType:p.type,teamId:x}),[,{branches:Y=[]}]=(0,g.useProjectDeployedBranches)({includeProductionBranch:!1,project:{id:h},limit:5,query:""!==w?w:void 0,active:!0}),{error:K,createDeployment:X,isLoading:J,reset:Q}=function(e){var t,l,i;let s,{onSuccess:a,projectId:n,teamId:r}=e,{data:o,isMutating:c,trigger:d,error:u,reset:m}=(t={throwOnError:!1},(0,_.default)(z.API_GIT_TRIGGER,(e,t)=>{let{arg:l}=t;if(!n)throw Error("No projectId passed");let{branch:i,sha:s}=l,a=r?`?${new URLSearchParams({teamId:r}).toString()}`:"",o=`${e}/${n}/sha/${encodeURIComponent(i)}/${s}${a}`;return(0,E.fetchAPI)(o,{method:"POST",body:{},throwOnHTTPError:!0})},t)),{data:h,error:p,isLoading:x}=(l=o?.job,i={onSuccess(e){W(e)&&"ERRORED"!==e.state&&a?.()},refreshInterval:3e3},(0,T.default)(l?`/v1/integrations/job/${l}`:null,e=>(0,E.fetchAPI)(e),i)),f=x||!W(h);return u&&(s=Error(u.message)),p&&(s=Error(p.message)),h?.state==="ERRORED"&&(s=Error(h.error??"Could not create a deployment for this reference.")),{error:s,createDeployment:e=>{m(),d(e)},isLoading:c||f,reset:m}}({onSuccess(){L.success("Deployment created successfully."),m()},projectId:h,teamId:x}),Z=(0,i.useMemo)(()=>(0,l.default)(e=>{k(e),N(e),Q()},500,{leading:!1,trailing:!0}),[k,Q,N]);(0,i.useEffect)(()=>{$(B)},[B]),(0,i.useEffect)(()=>{G?.branch&&D(G.branch)},[G?.branch]);let ee="initial";!A&&G&&(ee="success"),(U||K)&&(ee="error",s=U?.message||K?.message);let et=!A&&"error"===ee,el=S===p.productionBranch;return(0,t.jsxs)("form",{children:[(0,t.jsxs)(n.Modal.Body,{children:[(0,t.jsx)(n.Modal.Header,{children:(0,t.jsx)(n.Modal.Title,{children:"Create Deployment"})}),(0,t.jsx)(q,{connectedAt:O,projectLink:p}),(0,t.jsx)(c.Spacer,{}),(0,t.jsxs)("div",{"aria-labelledby":f,role:"group",children:[(0,t.jsxs)("p",{className:"text-copy-14",id:f,children:["Paste a valid commit reference to create a new deployment in addition to those auto-generated from"," ",(0,t.jsx)("span",{className:"text-copy-14-mono",children:(0,y.getRepoFromLink)(p,{includeOrg:!0})}),"."]}),(0,t.jsx)(c.Spacer,{}),(0,t.jsx)(C,{"aria-errormessage":et?b:void 0,autoCapitalize:"none",bypassCasing:!0,disabled:J,error:et?"yes":null,label:"Commit or Branch Reference",loading:A,onChange:e=>{let{value:t}=e.target,l=t.trim();if(""===l){D(""),$(!1),k(l),N(l);return}v!==l&&(D(""),$(!0),Z(l),N(l))},onPaste:e=>{Z.cancel();let t=e.clipboardData.getData("text");t&&v===t||(D(""),$(!0),Q())},placeholder:H(p),showErrorMessage:!1,size:"small",state:ee,value:w}),(0,t.jsx)(c.Spacer,{y:.5}),"success"===ee||A||0!==w.length?null:(0,t.jsx)(o.Scroller,{height:0===Y.length?"0px":"66px",overflow:"x",scrollerClassName:"mx-[-4px] px-[1px]",width:"100%",children:(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial p-1",children:[p.productionBranch||"main",...Y.filter(e=>e!==p.productionBranch)].map(e=>(0,t.jsx)(V,{label:e,onClick:()=>{k(e),N(H(p,e))}},e))})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[G?.multiBranches&&G.multiBranches.length>0?(0,t.jsx)(M,{branchName:S,isProductionDeployment:el}):null,et?(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-start flex-initial min-h-[66px] pt-2",children:(0,t.jsx)(P,{id:b,children:s})}):null,A||!G||"sha"!==G.requestedBy||G.branch?null:(0,t.jsx)(r.Note,{fill:!0,type:"secondary",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"Branch could not be determined."}),(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"Please select the branch you would like to deploy to."})]})}),A||"success"===ee?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R,{branchName:G?.requestedBy!=="sha"||G.branch?G?.branch:(0,t.jsx)(j.BranchSearchCombobox,{comboboxSize:"small",includeProductionBranch:!0,onSelect:e=>{null===e?D(""):D(e)},placeholder:"Select branch…",project:{id:h,link:p},skeletonStyle:{margin:"0.4rem 0",height:"2.0rem"},value:S}),commitMessage:G?.commitMessage,commitSha:G?.sha,createdAt:G?.commitDate,isProductionDeployment:S?el:void 0,loading:A}),G?.recentDeploymentId?(0,t.jsx)(I,{deploymentId:G.recentDeploymentId,isProductionDeployment:el}):null]}):null]})]})]}),(0,t.jsxs)(n.Modal.Actions,{children:[(0,t.jsx)(n.Modal.Action,{onClick:m,type:"secondary",children:"Cancel"}),(0,t.jsx)(n.Modal.Action,{disabled:!["success","error"].includes(ee)||!S||!G?.sha,loading:J,onClick:()=>{G?.sha&&X({sha:G.sha,branch:S||G.branch})},children:"Create Deployment"})]})]})}function q(e){let{connectedAt:l,projectLink:i}=e,s=(0,p.useAgo)(l,{justNowLabel:"just now"});return(0,t.jsx)(a.Entity,{left:(0,t.jsx)(x.default,{gitType:i.type,height:32,width:32}),padding:0,children:(0,t.jsx)(a.Entity.Content,{description:(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Connected ",s]}),title:(0,t.jsxs)(u.Link,{className:"inline-flex max-w-full items-center [&>svg]:min-w-4",href:(0,f.getGitRepoUrlFromLink)(i),tab:!0,variant:"primary",children:[(0,t.jsx)("span",{className:"geist-ellipsis",children:(0,y.getRepoFromLink)(i,{includeOrg:!0})}),(0,t.jsx)(c.Spacer,{inline:!0,x:.2}),(0,t.jsx)(m.ExternalSmall,{})]})})})}function V(e){let{label:l,onClick:i}=e;return(0,t.jsx)(s.Button,{onClick:i,prefix:(0,t.jsx)(h.GitBranch,{size:14,style:{transform:"translateX(2px)"}}),shape:"rounded",size:"small",type:"secondary",typeName:"button",children:(0,t.jsx)("span",{className:"text-copy-14-mono",children:l})})}e.s(["GitDeploymentTriggerModal",()=>U],4095738),e.s([],9204765)},7966665,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});let i=e.r(2795167);function s(e){return/^[a-f0-9]{40}$/i.test(e)}l.default=function(e,t){let l,a;if("string"!=typeof e||!e.length)return null;if(e.startsWith("git@"))switch(!0){case e.startsWith("git@github.com:"):l="github",a=e.replace("git@github.com:","");break;case t&&e.startsWith(`git@${t}:`):l="ghes",a=e.replace(`git@${t}:`,"");break;case e.startsWith("git@gitlab.com:"):l="gitlab",a=e.replace("git@gitlab.com:","");break;case e.startsWith("git@bitbucket.org:"):l="bitbucket",a=e.replace("git@bitbucket.org:","");break;default:return null}else{let s=i.parse(e);if(!s.pathname)return null;switch(s.hostname){case"github.com":case"www.github.com":l="github";break;case t:l="ghes";break;case"gitlab.com":case"www.gitlab.com":l="gitlab";break;case"bitbucket.org":case"www.bitbucket.org":l="bitbucket";break;default:return null}a=s.pathname.replace(/(^\/|\/$)/g,"")}let n=(a=a.replace(/\.git$/,"")).split("/").filter(Boolean);if(n.length<2)return null;if(2===n.length)return{type:l,owner:n[0],name:n[1],branch:"",sha:"",subdir:""};let r="",o="",c="",d=n[0],u=n[1];if("github"===l)if("blob"!==n[2]&&"tree"!==n[2]&&"commit"!==n[2])return null;else s(n[3])?o=n[3]:r=n[3],c=n.slice(4).join("/");else if("ghes"===l)if("blob"!==n[2]&&"tree"!==n[2]&&"commit"!==n[2])return null;else s(n[3])?o=n[3]:r=n[3],c=n.slice(4).join("/");else if("gitlab"===l)if("-"===n[2])("blob"===n[3]||"tree"===n[3]||"commit"===n[3])&&(s(n[4])?o=n[4]:r=n[4],c=n.slice(5).join("/"));else{let e=n.indexOf("-");-1===e?u=n.slice(1).join("/"):(u=n.slice(1,e).join("/"),("blob"===n[e+1]||"tree"===n[e+1]||"commit"===n[e+1])&&(s(n[e+2])?o=n[e+2]:r=n[e+2],c=n.slice(e+3).join("/")))}else if("bitbucket"===l)if("src"!==n[2]&&"commits"!==n[2])return null;else s(n[3])?o=n[3]:r=n[3],c=n.slice(4).join("/");return{type:l,owner:d,name:u,branch:r,sha:o,subdir:c}}},3023251,e=>{"use strict";var t=e.i(7966665);function l(e){if(!e||"error"in e)return null;switch(e.type){case"github-limited":case"github":return{org:e.org||"",repo:e.repo};case"gitlab":if("projectUrl"in e){let l=(0,t.default)(e.projectUrl);if(l)return{org:l.owner,repo:l.name}}break;case"bitbucket":if("slug"in e)return{org:e.owner,repo:e.slug}}return null}function i(e){let{includeOrg:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=l(e);return i?t?`${i.org}/${i.repo}`:i.repo:""}e.s(["getOrgAndRepoFromLink",()=>l,"getRepoFromLink",()=>i])},913614,e=>{"use strict";var t=e.i(7966665);function l(e){let{type:l,org:i,repo:s,projectUrl:a,owner:n,slug:r,host:o}=e;switch(l){case"github-limited":case"github":return`https://github.com/${i}/${s}`;case"gitlab":{let e=(0,t.default)(a||"");return`https://gitlab.com/${e?.owner}/${e?.name}`}case"bitbucket":return`https://bitbucket.org/${n}/${r}`;case"github-custom-host":if(!o)throw Error("Custom host is required for github-custom-host");return`https://${o}/${i}/${s}`;default:return""}}e.s(["getGitRepoUrlFromLink",()=>l])},2645806,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),i=e.i(2111701),s=e.i(6891161),a=e.i(455575),n=e.i(277234),r=e.i(4244280),o=e.i(4470704);let c=l.default.memo(e=>{let{active:c,onClose:d,deployment:u,teamId:m}=e,[h,p]=(0,l.useState)(!1),x=(0,a.useToasts)(),f=(0,l.useCallback)(async()=>{if(!u)return;p(!0);let e=m?"?teamId="+m:"",t=await (0,n.fetchAPI)(`${(0,r.API_DEPLOYMENTS)("v12")}/${u.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&x.error(`Could not cancel the deployment, it's ${u.readyState}`),"CANCELED"===t.readyState&&(x.success("The deployment has been successfully canceled."),(0,i.mutate)((0,o.getUrl)(u.id),{...u,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:u.url,isPrivate:!u.public})),p(!1),d()},[u,m,x,d]);return(0,t.jsxs)(s.Modal.Modal,{active:c,onClickOutside:d,width:"500px",children:[(0,t.jsxs)(s.Modal.Body,{children:[(0,t.jsx)(s.Modal.Header,{children:(0,t.jsx)(s.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)("p",{className:"text-copy-16",children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)("p",{className:"text-copy-16",style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(s.Modal.Actions,{children:[(0,t.jsx)(s.Modal.Action,{loading:!1,onClick:d,type:"secondary",children:"Close"}),(0,t.jsx)(s.Modal.Action,{disabled:h,loading:h,onClick:f,children:"Cancel deployment"})]})]})});e.s(["default",0,c])},5229375,e=>{"use strict";var t=e.i(1176592),l=e.i(7909933),i=e.i(3924999),s=e.i(818351),a=e.i(8042625),n=e.i(277234),r=e.i(4244280),o=e.i(5338940);function c(e,t){let{deploymentId:l,teamId:i}=e;return(0,s.useIsomorphicSWR)(l?function(e){let{deploymentId:t,teamId:l}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,a.encode)({teamId:l})}`}({deploymentId:l,teamId:i}):null,t)}function d(e,t){return(0,l.default)(()=>{if(!e)return null;let{team:t,id:l,teamId:i}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${l}/aliases${(0,a.encode)({teamId:i??(t?t.id:null)})}`},e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,l){let{limit:s=20,domains:a,rollbackDeploymentId:c}=e,{isReady:d,team:u}=(0,o.useTeam)(),h=(0,i.default)((e,t)=>{if(!d)return null;let l=`${r.API_ALIASES}`,i=a?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${l}${m({limit:s+1,teamId:u?.id,rollbackDeploymentId:c},i)}`;let n=t?.aliases&&t.aliases.length>s?t.aliases[s-1].createdAt:null;return n?`${l}${m({limit:s+1,teamId:u?.id,until:n},i)}`:null},e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),l),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,s))):[],[h.data,s]),x=!!h.data&&!h.error,f=!!(h.data&&0===p.length),y=!!(h.data&&h.size>h.data.length),g=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=s);return[h,{aliases:p,initialDataLoaded:x,isEmpty:f,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:y,isReachingEnd:g}]}function m(e,t){let l=(0,a.encode)(e,!1),i=t?`&${t}`:"";return l?`?${l}${i}`:`?${i}`}e.s(["useAliases",()=>d,"useAliasesInfinite",()=>u,"useAliasesV2",()=>c],5229375)},7018452,e=>{"use strict";var t=e.i(1176592);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[l,i]=(0,t.useState)(!1),s=window.location.hash,a=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==a||l||i(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[l,a]),s!==a||l||(i(!0),window.history.replaceState(null,""," ")),s!==a&&l&&(window.location.hash=a),[l,i]}e.s(["default",()=>l])},9719784,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),i=e.i(57106),s=e.i(822157),a=e.i(7018452),n=e.i(2405448),r=e.i(542164),o=e.i(1681029),c=e.i(4478191);let d=(0,l.memo)(function(e){let{url:d,truncate:u,defaultRoute:m,...h}=e,[p,x]=(0,a.default)("#wildcard"),[f,y]=(0,l.useState)(null),[g,j]=(0,l.useState)(!1),b=(0,l.useCallback)(()=>{y((0,n.default)(d)),x(!0)},[y,x,d]);return d?(0,r.default)(d)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",onClick:b,...h,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:d}):d}),g||p?(0,t.jsx)(s.default,{active:p,onCancel:()=>{x(!1)},url:f}):null]}):(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,c.withDefaultRoute)((0,o.domainToUrl)(d),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:d}):d}):null});e.s(["default",0,d])},9365163,4904548,e=>{"use strict";var t=e.i(8711407),l=e.i(1176592),i=e.i(5338940),s=e.i(1717203),a=e.i(7557283),n=e.i(4670733),r=e.i(588428),o=e.i(4396019),c=e.i(762945),d=e.i(7749291),u=e.i(8735244),m=e.i(2504781),h=e.i(6891161),p=e.i(455575),x=e.i(8522580),f=e.i(8761240),y=e.i(5756088),g=e.i(9386557),j=e.i(4004502),b=e.i(8042625),v=e.i(277234),k=e.i(4244280),w=e.i(5140444),N=e.i(5757634),S=e.i(5802506),D=e.i(6641571);e.i(9623499);var C=e.i(5576066),A=e.i(3924999),R=e.i(5229375);e.i(5394896);var I=e.i(9668517);let M="[teamSlug]";var P=e.i(6060673),T=e.i(930810),$=e.i(7952834),E=e.i(1173672),L=e.i(8227242),O=e.i(9745887),B=e.i(3306538),F=e.i(5468328),_=e.i(9719784);function z(e){let{hidden:l,showIcon:i=!0,linkProps:s,defaultRoute:a}=e;return(0,t.jsx)(t.Fragment,{children:l.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(_.default,{defaultRoute:a,icon:i,title:e,truncate:!0,url:e,...s})},e))})}function W(e){let{hidden:l,linkProps:i}=e;return(0,t.jsx)(F.Tooltip,{text:(0,t.jsx)(z,{hidden:l,linkProps:i}),children:(0,t.jsx)(B.Badge,{size:"sm",variant:"gray-subtle",children:`+${l.length}`})})}let H=function(e){let{className:l,defaultRoute:i,domains:s,firstOnly:a,showIcon:n=!0,style:r,linkProps:o}=e;if(!s)return(0,t.jsx)("span",{className:`text-copy-14 text-gray-900 ${l}`,style:r,children:"-"});let{visible:c,hidden:d}=s.reduce((e,t)=>(0===e.visible.length||!a&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)("span",{className:`text-[14px] leading-[20px] font-medium ${l}`,children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial max-w-full",style:{...r},children:[c.map((e,l)=>{let s=l===c.length-1;return(0,t.jsx)(_.default,{defaultRoute:i,icon:n,style:{marginRight:s?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...o},e)}),d.length?(0,t.jsx)(W,{hidden:d,linkProps:o}):null]})})};e.s(["default",0,H],4904548);var U=e.i(8651268),G=e.i(2547843);function q(){return(0,t.jsx)(h.Modal.Header,{children:(0,t.jsx)(h.Modal.Title,{center:!0,children:"Instant Rollback"})})}function V(e){let{setStage:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{fullWidth:!0,onClick:()=>{l("initial")},type:"secondary",children:"Back"})})]})}function Y(){return(0,t.jsx)("div",{children:(0,t.jsx)(x.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:4},children:[(0,t.jsx)(c.Warning,{style:{flexShrink:0}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function K(e){var s;let a,{hasFloatingAliases:o,onCancel:c,previousDeployment:u,productionAliases:p,productionDeployment:f,project:g,rollbackCandidates:b,setStage:v,selectedDeployment:k,setSelectedDeployment:w,deploymentSwr:N,rollbackReason:S,setRollbackReason:D}=e,A=(s="/[teamSlug]",a=(0,I.useTeamSlug)(),(0,l.useMemo)(()=>s.includes(M)?s.replace(`/${M}`,a?`/${a}`:""):s,[a,s])),[R,P]=(0,l.useState)(!1),{team:$}=(0,i.useTeam)(),E=!$||$.billing?.plan==="hobby",{value:L}=(0,n.useInstantRollbackHobbyRestrictionFlag)(),{value:B}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)();return b.length&&u&&k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-16",children:["Rolling back"," ",(0,t.jsx)(H,{domains:p,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),o?(0,t.jsx)(Y,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(O.DeploymentCardSmall,{deployment:f,isProductionDeployment:!0,selectedDeployment:k,setSelectedDeployment:w})})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"To the following deployment:"}),R?(0,t.jsx)("div",{children:(0,t.jsx)(T.ChooseDeploymentList,{deployments:b,previousDeployment:u,productionDeployment:f,rolledBackDeploymentId:g?.lastAliasRequest?.type==="rollback"?g.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:k,setSelectedDeployment:w,swr:N})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(O.DeploymentCardSmall,{deployment:k,isForm:R,isPreviousDeployment:k.uid===u.uid,selectedDeployment:k,setSelectedDeployment:w})}),(L||B)&&E?(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial mt-6",children:(0,t.jsx)(x.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial p-2",children:[(0,t.jsx)(y.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===A?"/dashboard?createTeam=instant-rollback":`${A}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)("span",{className:"text-copy-14 text-inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(d.ExternalSmall,{className:"ml-1"}),(0,t.jsx)("span",{className:"text-copy-14 text-inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(m.Button,{onClick:()=>{P(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{htmlFor:"rollback-reason",className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:(0,t.jsx)("span",{className:"text-copy-16",children:"Share a reason for this rollback:"})}),(0,t.jsx)(T.RollbackDescriptionTextarea,{value:S,onChange:D,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","continue-button"),disabled:S.length>=T.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{v("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)("p",{className:"text-copy-14",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"})})]})}function X(e){let{selectedDeployment:l,setStage:i,requestRollback:s,project:a,rollbackReason:n,rollbackCandidates:r}=e,{user:o}=(0,w.useUser)();if(!l)return(0,t.jsx)(V,{setStage:i});let c=n.length>=T.REASON_MAX_CHARACTER_LENGTH,u=(0,T.getMostRecentlyPromotedDeployment)(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"Rolling back to:"}),(0,t.jsx)(O.DeploymentCardSmall,{deployment:l,isPreviousDeployment:l.uid===u?.uid,selectedDeployment:l,setSelectedDeployment:()=>null})]}),n.trim()&&(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:(0,t.jsx)(T.RollbackDescriptionCard,{rollbackDescription:{description:n.trim(),userId:o?.uid??"",username:o?.username??"",deploymentId:l.uid,projectId:a?.id??"",createdAt:new Date().getTime()},project:a,preview:!0})}),(0,t.jsxs)(D.UL,{className:"mb-0",children:[(0,t.jsx)(D.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(D.LI,{children:[(0,t.jsxs)(C.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${l.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(d.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(D.LI,{children:"You can update the rollback reason from the project overview."})]}),(a?.autoAssignCustomDomains??!0)||a?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(x.Note,{fill:!0,type:"secondary",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:()=>{i("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","rollback-button"),disabled:c,onClick:()=>{s(l.uid),i("processing")},children:"Confirm Rollback"})]})]})}function J(e){let{jobStatus:i,rollbackDeploymentId:s,rollbackCandidates:a,selectedDeployment:n,setStage:r,onCancel:o,statusSwr:c,requestRollback:d,rollbackReason:p}=e,{user:x}=(0,w.useUser)();if((0,l.useEffect)(()=>{s===n?.uid&&("failed"===i?r("error"):"succeeded"===i&&r("done"))},[s,i,n,r]),!n)return(0,t.jsx)(V,{setStage:r});let y=(0,T.getMostRecentlyPromotedDeployment)(a);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Assigning production domains:"}),(0,t.jsx)(O.DeploymentCardSmall,{deployment:n,isPreviousDeployment:n.uid===y?.uid,selectedDeployment:n,setSelectedDeployment:()=>null})]}),""!==p?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["“",(0,t.jsx)(L.LinkParser,{text:p.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.PrincipalAvatar,{size:20,principalId:x.uid,principal:{type:"user",uid:x.uid,username:x.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:x.username})]}):null]})]}):null,(0,t.jsxs)(D.UL,{className:"mx-4 my-0 list-none pt-2",children:[c.aliases.map(e=>{let l="loading";return"completed"===e.status?l="success":"failed"===e.status&&(l="error"),(0,t.jsx)(D.LI,{children:(0,t.jsxs)("div",{className:"h-6 flex items-center gap-2",children:["loading"===l&&(0,t.jsx)(u.Spinner,{className:"shrink-0",size:16}),"error"===l&&(0,t.jsx)(g.WarningFill,{className:"shrink-0",color:"amber-800",size:16}),"success"===l&&(0,t.jsx)(f.CheckCircleFill,{className:"shrink-0",color:"blue-700",size:16}),(0,t.jsx)("span",{className:"text-copy-14 truncate",children:e.alias})]})},e.alias)}),!c.isReachingEnd&&c.initialDataLoaded?(0,t.jsx)(D.LI,{children:(0,t.jsx)(m.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{"data-testid":(0,j.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==i&&"succeeded"!==i,onClick:()=>{"failed"===i?d(n.uid):"succeeded"===i&&(r("initial"),o())},children:"failed"===i?"Retry":"Done"})})]})}function Q(e){let{active:s,initialSelectedDeployment:a,onCancel:n,productionBranch:r,productionDeployment:o,projectId:c,rollbackCandidates:d,swr:u,rollbackDescription:m}=e,{mutate:x}=(0,N.useSWRConfig)(),[f,y]=(0,l.useState)("initial"),[g,w]=(0,l.useState)(""),{isReady:D,team:C}=(0,i.useTeam)(),I=(0,p.useToasts)(),M=(0,l.useMemo)(()=>{let e=d.filter(e=>e.uid!==o.id);return(0,T.getMostRecentlyPromotedDeployment)(e)},[d,o]),[L,O]=(0,l.useState)(null),B=L??a??M??null,F=(0,l.useCallback)(y,[y]),_=(0,l.useCallback)(O,[O]),[,{aliases:z}]=(0,R.useAliasesInfinite)({rollbackDeploymentId:o.id}),{data:W}=(0,P.useProject)(c),{lastAliasRequest:H,hasFloatingAliases:U}=W||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:q,jobStatus:V}=H||{toDeploymentId:null,jobStatus:null},[,Y]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:a,team:n}=(0,i.useTeam)(),r=(0,A.default)((t,l)=>{if(!a)return null;let i={teamId:n?.id,limit:s};return t?l?.next?`${(0,k.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)({...i,until:l.next})}`:null:`${(0,k.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)(i)}`},e=>(0,v.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),o=(0,l.useMemo)(()=>r.data?[].concat(...r.data.filter(Boolean).map(e=>e.aliases.slice(0,s))):[],[r.data,s]),c=!!r.data,d=c&&0===o.length,u=c&&r.data&&r.size>r.data.length,m=c&&r.data&&r.data[r.data.length-1]?.aliases.length<s;return[r,{aliases:o,initialDataLoaded:c,isEmpty:d,loadMore:()=>r.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:r.mutate}]}(c,2e3),Q=(0,l.useMemo)(()=>o,[s]),Z=()=>{y("initial"),O(a||M||null),n()},ee=(0,l.useCallback)(async e=>{if(!D)return;let t=`${(0,k.API_DEPLOYMENT_ROLLBACK)(c,e)}${(0,b.encode)({teamId:C?.id,description:g.trim()})}`;try{await (0,v.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),C&&(void 0!==W&&(0,$.revalidateProject)(x,W),await x((0,E.getProjectProductionDeploymentKey)({projectIdOrName:c,teamId:C.slug})),x((0,G.getRollingReleaseEndpoint)(C.slug,c)))}catch(e){I.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,S.captureError)(e)}},[D,c,I,g,x,C,W]),et={rollbackDeploymentId:q,hasFloatingAliases:!!U,jobStatus:V,onCancel:Z,previousDeployment:M,productionBranch:r,productionDeployment:Q,productionAliases:z.map(e=>{let{alias:t}=e;return t}),project:W,rollbackCandidates:d,setStage:F,selectedDeployment:B,setSelectedDeployment:_,deploymentSwr:u,statusSwr:Y,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:g,setRollbackReason:w,rollbackDescription:m};return(0,t.jsxs)(h.Modal.Modal,{active:s,"data-testid":(0,j.tid)("deployment","rollback-modal"),onClickOutside:Z,sticky:!0,width:"500px",children:["initial"===f&&(0,t.jsx)(K,{...et}),"selected"===f&&(0,t.jsx)(X,{...et}),["processing","error","done"].includes(f)&&(0,t.jsx)(J,{...et})]})}var Z=e.i(5771992),ee=e.i(5645345),et=e.i(3981247);e.i(3182268);var el=e.i(7849855);function ei(e){let{team:t}=(0,i.useTeam)(),s=!t||t.billing?.plan==="hobby",{value:a}=(0,n.useInstantRollbackHobbyRestrictionFlag)(),{value:c}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)(),d=a||c,u=e?.name,{deployment:m,isLoading:h}=(0,o.useProjectProductionDeployment)(u);return(0,l.useMemo)(()=>{let t=(0,ee.asListDeployment)(e),l=s&&!t?.isRollbackCandidate;return t?h?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":d?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,s,h,m?.id,d])}function es(e){let{onClose:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[n,r]=(0,l.useState)(!1),[c,d]=(0,l.useState)(),{teamSlug:u,projectSlug:m}=(0,el.useProjectAndTeamSlug)(),{data:h}=(0,P.useProject)(c?.name),p=m??c?.name,x=e??h,{data:f}=(0,et.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),y=f?.rollingRelease?f?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:g,rollbackDescription:j,mutate:b}=(0,o.useProjectProductionDeployment)(x?.name),{can:v}=(0,s.default)({projectIdOrName:x?.name}),k=v(a.Action.Create,a.Resource.DeploymentRollback),w=x?.link?.productionBranch?x.link.productionBranch:void 0,[N,S]=(0,Z.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:D,initialDataLoaded:C}=S,A=D.filter(e=>!!e.isRollbackCandidate&&e.uid!==y),R=!!(C&&x&&!A.length),I=(0,l.useCallback)(e=>{d((0,ee.asListDeployment)(e)),r(!0)},[]),M=(0,l.useCallback)(()=>{r(!1),b().finally(()=>null),i?.()},[b,i]);return{rollbackModal:(0,l.useMemo)(()=>k&&n&&g&&x?(0,t.jsx)(Q,{active:n,initialSelectedDeployment:c,onCancel:M,productionBranch:w,productionDeployment:g,projectId:x.id,rollbackCandidates:A,rollbackDescription:j,swr:S}):null,[k,n,c,w,g,A,x,S,M,j]),closeRollbackModal:M,openRollbackModal:I,canRollbackDeployment:k,noRollbackCandidates:R}}e.s(["useInstantRollbackModal",()=>es,"useRollbackTooltip",()=>ei],9365163)}]);

//# debugId=a07fd93c-b252-7ced-11dd-538e041ad387
//# sourceMappingURL=b23ce4ed015fee17.js.map